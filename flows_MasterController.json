[
    {
        "id": "eee3c0c3.7c7bd",
        "type": "tab",
        "label": "Lighting",
        "disabled": false,
        "info": ""
    },
    {
        "id": "38894af.7ca61b6",
        "type": "tab",
        "label": "Safety/Security",
        "disabled": false,
        "info": ""
    },
    {
        "id": "cb6f2b8f.2124b8",
        "type": "tab",
        "label": "Presence",
        "disabled": false,
        "info": ""
    },
    {
        "id": "3e9522c6.d11e1e",
        "type": "tab",
        "label": "Cameras",
        "disabled": false,
        "info": ""
    },
    {
        "id": "30c7e5fd.18228a",
        "type": "tab",
        "label": "Comfort",
        "disabled": false,
        "info": ""
    },
    {
        "id": "b55ab74c.698a88",
        "type": "tab",
        "label": "Kids",
        "disabled": false,
        "info": ""
    },
    {
        "id": "90be6c3f.6407",
        "type": "tab",
        "label": "Notifications",
        "disabled": false,
        "info": ""
    },
    {
        "id": "51c810f0.59ce1",
        "type": "tab",
        "label": "iOS Push Actions",
        "disabled": false,
        "info": ""
    },
    {
        "id": "47267ef8.fca6f",
        "type": "tab",
        "label": "Media",
        "disabled": false,
        "info": ""
    },
    {
        "id": "76250bd8.6dba94",
        "type": "tab",
        "label": "Alexa Flows",
        "disabled": false,
        "info": ""
    },
    {
        "id": "97047d3e.e8278",
        "type": "tab",
        "label": "Moccupancy",
        "disabled": false,
        "info": ""
    },
    {
        "id": "2061740e.e5207c",
        "type": "tab",
        "label": "Playground",
        "disabled": false,
        "info": ""
    },
    {
        "id": "8d45d5f6.f088e8",
        "type": "tab",
        "label": "Christmas Lights",
        "disabled": true,
        "info": ""
    },
    {
        "id": "f5c459c0.3bf568",
        "type": "tab",
        "label": "Privacy",
        "disabled": false,
        "info": "> "
    },
    {
        "id": "5e603fa3.deb16",
        "type": "tab",
        "label": "StreamDeck",
        "disabled": false,
        "info": ""
    },
    {
        "id": "820ee3ba.213ee",
        "type": "tab",
        "label": "HDMI Matrix",
        "disabled": false,
        "info": ""
    },
    {
        "id": "144427d5.6c9f18",
        "type": "server",
        "name": "Home Assistant",
        "legacy": false,
        "hassio": false,
        "rejectUnauthorizedCerts": true,
        "ha_boolean": "y|yes|true|on|home|open",
        "connectionDelay": true
    },
    {
        "id": "1f84a57d.10775b",
        "type": "mqtt-broker",
        "name": "",
        "broker": "10.7.7.100",
        "port": "1883",
        "clientid": "NodeRed",
        "usetls": false,
        "compatmode": true,
        "keepalive": "60",
        "cleansession": true,
        "birthTopic": "",
        "birthQos": "0",
        "birthPayload": "",
        "closeTopic": "",
        "closePayload": "",
        "willTopic": "",
        "willQos": "0",
        "willPayload": ""
    },
    {
        "id": "9dba4206.297ed",
        "type": "light-scheduler-settings",
        "name": "Scheduler Settings",
        "latitude": "35.6946918",
        "longitude": "-88.8753785"
    },
    {
        "id": "b903277.dd21ad8",
        "type": "map-config",
        "name": "Doorbird Event to BI Camera",
        "lhsName": "event_name",
        "rhsName": "camera",
        "mappings": [
            {
                "lhs": "doorbird_front_door_motion",
                "rhs": "frontdoor-motion"
            },
            {
                "lhs": "doorbird_side_entry_motion",
                "rhs": "sideentry-motion"
            },
            {
                "lhs": "doorbird_back_door_motion",
                "rhs": "backdoor-motion"
            }
        ]
    },
    {
        "id": "aef2d8f0.e21398",
        "type": "map-config",
        "name": "AI to HD Camera Mapping",
        "lhsName": "AI Identifier",
        "rhsName": "HD Camera",
        "mappings": [
            {
                "lhs": "front-door",
                "rhs": "frontdoor"
            },
            {
                "lhs": "side-door",
                "rhs": "sideentry"
            },
            {
                "lhs": "back-door",
                "rhs": "backdoor"
            },
            {
                "lhs": "side-180",
                "rhs": "Side180-HD"
            },
            {
                "lhs": "front-180",
                "rhs": "Front180-HD"
            }
        ]
    },
    {
        "id": "ba88bc3e.93fb6",
        "type": "map-config",
        "name": "Dahua to SD Mapping",
        "lhsName": "Dahua Event Identifier",
        "rhsName": "SD Camera",
        "mappings": [
            {
                "lhs": "side-180",
                "rhs": "side180-motion"
            },
            {
                "lhs": "front-180",
                "rhs": "front180-motion"
            }
        ]
    },
    {
        "id": "80abbe6f.032be",
        "type": "dahua-device-config",
        "name": "BackyardPTZ",
        "ipaddress": "10.7.9.12",
        "port": "80"
    },
    {
        "id": "3083a167.a9471e",
        "type": "dahua-device-config",
        "name": "Front180",
        "ipaddress": "10.7.9.10",
        "port": "80"
    },
    {
        "id": "47a7cbf3.98d564",
        "type": "dahua-device-config",
        "name": "Side180",
        "ipaddress": "10.7.9.11",
        "port": "80"
    },
    {
        "id": "1c211dcc.d61fd2",
        "type": "alexa-remote-account",
        "name": "",
        "authMethod": "proxy",
        "proxyOwnIp": "10.7.7.100",
        "proxyPort": "3456",
        "cookieFile": "alexaAuth2",
        "refreshInterval": "3",
        "alexaServiceHost": "pitangui.amazon.com",
        "amazonPage": "amazon.com",
        "acceptLanguage": "en-US",
        "userAgent": "",
        "useWsMqtt": "on",
        "autoInit": "on"
    },
    {
        "id": "ef753f0c.2417a",
        "type": "map-config",
        "name": "HDMI Inputs",
        "lhsName": "Input Index",
        "rhsName": "Input Name",
        "mappings": [
            {
                "lhs": "7",
                "rhs": "Surveillance"
            }
        ]
    },
    {
        "id": "c590c3b8.f74cd",
        "type": "map-config",
        "name": "HDBT Outputs",
        "lhsName": "Output Index",
        "rhsName": "Output Name",
        "mappings": [
            {
                "lhs": "7",
                "rhs": "Office TV"
            },
            {
                "lhs": "0",
                "rhs": "Living Room TV"
            }
        ]
    },
    {
        "id": "210f3ca0.f0ec14",
        "type": "schedex",
        "z": "eee3c0c3.7c7bd",
        "name": "Porch Light Trigger",
        "suspended": false,
        "lat": "35.6145",
        "lon": "-88.8139",
        "ontime": "dusk",
        "ontopic": "",
        "onpayload": "turn_on",
        "onoffset": "-5",
        "onrandomoffset": false,
        "offtime": "22:30",
        "offtopic": "",
        "offpayload": "turn_off",
        "offoffset": "-15",
        "offrandomoffset": true,
        "mon": true,
        "tue": true,
        "wed": true,
        "thu": true,
        "fri": true,
        "sat": true,
        "sun": true,
        "x": 410,
        "y": 120,
        "wires": [
            [
                "8d49cec5.ef4d9"
            ]
        ]
    },
    {
        "id": "b2259c64.157f7",
        "type": "api-call-service",
        "z": "eee3c0c3.7c7bd",
        "name": "Porch Lights",
        "server": "144427d5.6c9f18",
        "service_domain": "switch",
        "service": "",
        "data": "{\"entity_id\": \"switch.front_porch_light, switch.side_entry_porch_light, switch.garage_outside_light\"}",
        "mergecontext": "",
        "x": 850,
        "y": 120,
        "wires": [
            []
        ]
    },
    {
        "id": "9a045e11.88105",
        "type": "inject",
        "z": "eee3c0c3.7c7bd",
        "name": "All Porch Lights Off",
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "off",
        "payloadType": "str",
        "x": 170,
        "y": 140,
        "wires": [
            [
                "210f3ca0.f0ec14"
            ]
        ]
    },
    {
        "id": "d03c0d74.35482",
        "type": "inject",
        "z": "eee3c0c3.7c7bd",
        "name": "All Porch Lights On",
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "on",
        "payloadType": "str",
        "x": 170,
        "y": 100,
        "wires": [
            [
                "210f3ca0.f0ec14"
            ]
        ]
    },
    {
        "id": "c7977616.dfcab8",
        "type": "comment",
        "z": "eee3c0c3.7c7bd",
        "name": "Porch Lights @ Dusk",
        "info": "",
        "x": 170,
        "y": 60,
        "wires": []
    },
    {
        "id": "8d49cec5.ef4d9",
        "type": "function",
        "z": "eee3c0c3.7c7bd",
        "name": "Select Service",
        "func": "// Trigger doesn't support objects on \n// payload so we move the value provided \n// on msg.payload into msg.service property\n// to be used by the porch light service\n\nmsg.payload = {\n    service: msg.payload\n}\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 620,
        "y": 120,
        "wires": [
            [
                "b2259c64.157f7"
            ]
        ]
    },
    {
        "id": "79f23994.f55e88",
        "type": "server-state-changed",
        "z": "eee3c0c3.7c7bd",
        "name": "Kitchen Motion",
        "server": "144427d5.6c9f18",
        "version": 1,
        "entityidfilter": "binary_sensor.kitchen_motion",
        "entityidfiltertype": "exact",
        "outputinitially": false,
        "state_type": "str",
        "haltifstate": "on",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "outputs": 2,
        "output_only_on_state_change": false,
        "x": 160,
        "y": 300,
        "wires": [
            [
                "fd97ed5c.f14d3",
                "c5f55684.5b1fd8"
            ],
            [
                "fd97ed5c.f14d3"
            ]
        ]
    },
    {
        "id": "a7d89183.b3723",
        "type": "api-call-service",
        "z": "eee3c0c3.7c7bd",
        "name": "Off",
        "server": "144427d5.6c9f18",
        "service_domain": "light",
        "service": "turn_off",
        "data": "{\"entity_id\":\"light.kitchen_can_lights\"}",
        "mergecontext": "",
        "x": 1110,
        "y": 400,
        "wires": [
            []
        ]
    },
    {
        "id": "8417a2fb.440b1",
        "type": "server-state-changed",
        "z": "eee3c0c3.7c7bd",
        "name": "Kitchen Switch Flipped On",
        "server": "144427d5.6c9f18",
        "version": 1,
        "entityidfilter": "light.kitchen_can_lights",
        "entityidfiltertype": "exact",
        "outputinitially": false,
        "state_type": "str",
        "haltifstate": "on",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "outputs": 2,
        "output_only_on_state_change": true,
        "x": 550,
        "y": 380,
        "wires": [
            [
                "2901960a.c8dc3a"
            ],
            []
        ]
    },
    {
        "id": "2f7566a7.1942ba",
        "type": "comment",
        "z": "eee3c0c3.7c7bd",
        "name": "Kitchen Can Lights",
        "info": "",
        "x": 170,
        "y": 240,
        "wires": []
    },
    {
        "id": "6007cb34.ee1bb4",
        "type": "server-state-changed",
        "z": "eee3c0c3.7c7bd",
        "name": "Switch Flipped On",
        "server": "144427d5.6c9f18",
        "entityidfilter": "light.pantry_led",
        "entityidfiltertype": "exact",
        "outputinitially": false,
        "state_type": "str",
        "haltifstate": "on",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "outputs": 2,
        "x": 170,
        "y": 540,
        "wires": [
            [
                "5615982.498e668"
            ],
            []
        ]
    },
    {
        "id": "7cc803f5.dd82fc",
        "type": "comment",
        "z": "eee3c0c3.7c7bd",
        "name": "Pantry Shelf LED",
        "info": "",
        "x": 160,
        "y": 480,
        "wires": []
    },
    {
        "id": "5615982.498e668",
        "type": "stoptimer",
        "z": "eee3c0c3.7c7bd",
        "duration": "5",
        "units": "Minute",
        "payloadtype": "bool",
        "payloadval": "true",
        "name": "5 Minutes",
        "x": 420,
        "y": 540,
        "wires": [
            [],
            [
                "48b1fc0f.620214"
            ]
        ]
    },
    {
        "id": "48b1fc0f.620214",
        "type": "api-call-service",
        "z": "eee3c0c3.7c7bd",
        "name": "Turn Off Pantry Light",
        "server": "144427d5.6c9f18",
        "service_domain": "light",
        "service": "turn_off",
        "data": "{\"entity_id\":\"light.pantry_led\"}",
        "mergecontext": "",
        "x": 680,
        "y": 600,
        "wires": [
            []
        ]
    },
    {
        "id": "7fb24f45.2a33d",
        "type": "function",
        "z": "38894af.7ca61b6",
        "name": "Set Message",
        "func": "return {\n    payload: {\n        data: {\n            title: \"SMOKE DETECTED!\",\n            message: \"Call the Fire Department.\",\n            data: {\n                url: 'tel://731-423-3911',\n                push: {\n                    badge: 911,\n                    sound: \"US-EN-Alexa-Smoke-Detected-Generic.wav\"\n                }\n            }\n        }\n    }\n};",
        "outputs": 1,
        "noerr": 0,
        "x": 710,
        "y": 180,
        "wires": [
            [
                "5e9d1b86.e677f4"
            ]
        ]
    },
    {
        "id": "a76898ba.169aa8",
        "type": "inject",
        "z": "38894af.7ca61b6",
        "name": "Test Notification",
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "0",
        "payloadType": "num",
        "x": 140,
        "y": 180,
        "wires": [
            [
                "4cdd2835.d7e4e8"
            ]
        ]
    },
    {
        "id": "8cccfa11.2a8788",
        "type": "server-state-changed",
        "z": "eee3c0c3.7c7bd",
        "name": "Pantry Door Opened",
        "server": "144427d5.6c9f18",
        "entityidfilter": "binary_sensor.pantry_door",
        "entityidfiltertype": "exact",
        "outputinitially": false,
        "state_type": "str",
        "haltifstate": "on",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "outputs": 2,
        "x": 170,
        "y": 660,
        "wires": [
            [
                "461ee655.9b46c8"
            ],
            []
        ]
    },
    {
        "id": "da6bf586.7c3cf8",
        "type": "api-call-service",
        "z": "eee3c0c3.7c7bd",
        "name": "Turn On Pantry Light",
        "server": "144427d5.6c9f18",
        "service_domain": "light",
        "service": "turn_on",
        "data": "{\"entity_id\":\"light.pantry_led\", \"white_value\": 255, \"rgb_color\": [255,255,255], \"transition\": 10}",
        "mergecontext": "",
        "x": 680,
        "y": 660,
        "wires": [
            []
        ]
    },
    {
        "id": "a906d294.95b98",
        "type": "server-state-changed",
        "z": "eee3c0c3.7c7bd",
        "name": "Pantry Door Closed",
        "server": "144427d5.6c9f18",
        "entityidfilter": "binary_sensor.pantry_door",
        "entityidfiltertype": "exact",
        "outputinitially": false,
        "state_type": "str",
        "haltifstate": "off",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "outputs": 2,
        "x": 170,
        "y": 600,
        "wires": [
            [
                "48b1fc0f.620214"
            ],
            []
        ]
    },
    {
        "id": "461ee655.9b46c8",
        "type": "delay",
        "z": "eee3c0c3.7c7bd",
        "name": "",
        "pauseType": "delay",
        "timeout": "1",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "x": 420,
        "y": 660,
        "wires": [
            [
                "da6bf586.7c3cf8"
            ]
        ]
    },
    {
        "id": "decad0fb.3b576",
        "type": "inject",
        "z": "cb6f2b8f.2124b8",
        "name": "Guest Check Every 15 Minutes",
        "repeat": "900",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 170,
        "y": 140,
        "wires": [
            [
                "d5e90594.b099b8"
            ]
        ]
    },
    {
        "id": "e62ce7c1.471048",
        "type": "comment",
        "z": "cb6f2b8f.2124b8",
        "name": "Guest Presence Detection",
        "info": "",
        "x": 150,
        "y": 100,
        "wires": []
    },
    {
        "id": "a96c033f.d25b3",
        "type": "api-call-service",
        "z": "cb6f2b8f.2124b8",
        "name": "Enable Guest Mode",
        "server": "144427d5.6c9f18",
        "service_domain": "input_boolean",
        "service": "turn_on",
        "data": "{\"entity_id\": \"input_boolean.guest_mode\"}",
        "mergecontext": "",
        "x": 900,
        "y": 120,
        "wires": [
            []
        ]
    },
    {
        "id": "21e8b9b3.0eada6",
        "type": "api-call-service",
        "z": "cb6f2b8f.2124b8",
        "name": "Disable Guest Mode",
        "server": "144427d5.6c9f18",
        "service_domain": "input_boolean",
        "service": "turn_off",
        "data": "{\"entity_id\": \"input_boolean.guest_mode\"}",
        "mergecontext": "",
        "x": 1000,
        "y": 180,
        "wires": [
            []
        ]
    },
    {
        "id": "28d7951a.afb56a",
        "type": "switch",
        "z": "cb6f2b8f.2124b8",
        "name": "hasGuest",
        "property": "payload[0].health[0].num_guest",
        "propertyType": "msg",
        "rules": [
            {
                "t": "gt",
                "v": "0",
                "vt": "num"
            },
            {
                "t": "eq",
                "v": "0",
                "vt": "num"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 680,
        "y": 160,
        "wires": [
            [
                "a96c033f.d25b3"
            ],
            [
                "368fe191.19c0be"
            ]
        ]
    },
    {
        "id": "b24a295d.c02f98",
        "type": "comment",
        "z": "38894af.7ca61b6",
        "name": "Smoke Detection",
        "info": "",
        "x": 140,
        "y": 80,
        "wires": []
    },
    {
        "id": "a8664bea.540808",
        "type": "comment",
        "z": "cb6f2b8f.2124b8",
        "name": "Set Away Mode",
        "info": "",
        "x": 120,
        "y": 260,
        "wires": []
    },
    {
        "id": "bca95b60.f579d8",
        "type": "server-state-changed",
        "z": "cb6f2b8f.2124b8",
        "name": "Location Group",
        "server": "144427d5.6c9f18",
        "version": 1,
        "entityidfilter": "group.location",
        "entityidfiltertype": "exact",
        "outputinitially": true,
        "state_type": "str",
        "haltifstate": "home",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "outputs": 2,
        "output_only_on_state_change": true,
        "x": 120,
        "y": 300,
        "wires": [
            [
                "c3993b0a.7bb2a8"
            ],
            [
                "d0d1c9a1.de7e88"
            ]
        ]
    },
    {
        "id": "d0d1c9a1.de7e88",
        "type": "api-call-service",
        "z": "cb6f2b8f.2124b8",
        "name": "Enable Away Mode",
        "server": "144427d5.6c9f18",
        "service_domain": "input_boolean",
        "service": "turn_on",
        "data": "{\"entity_id\":\"input_boolean.away_mode\"}",
        "mergecontext": "",
        "x": 390,
        "y": 340,
        "wires": [
            []
        ]
    },
    {
        "id": "c3993b0a.7bb2a8",
        "type": "api-call-service",
        "z": "cb6f2b8f.2124b8",
        "name": "Disable Away Mode",
        "server": "144427d5.6c9f18",
        "service_domain": "input_boolean",
        "service": "turn_off",
        "data": "{\"entity_id\":\"input_boolean.away_mode\"}",
        "mergecontext": "",
        "output_location": "payload",
        "output_location_type": "msg",
        "mustacheAltTags": false,
        "x": 400,
        "y": 280,
        "wires": [
            []
        ]
    },
    {
        "id": "ce766641.c85848",
        "type": "server-state-changed",
        "z": "38894af.7ca61b6",
        "name": "Door Opened",
        "server": "144427d5.6c9f18",
        "version": 1,
        "entityidfilter": "door_state",
        "entityidfiltertype": "substring",
        "outputinitially": false,
        "state_type": "str",
        "haltifstate": "on",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "outputs": 2,
        "output_only_on_state_change": true,
        "x": 130,
        "y": 320,
        "wires": [
            [
                "2c12f67c.414c5a"
            ],
            []
        ]
    },
    {
        "id": "d0151dc8.e8bb",
        "type": "function",
        "z": "38894af.7ca61b6",
        "name": "Build Notification",
        "func": "return {\n    payload: {\n        data: {\n            title: \"Alarm Notification!\",\n            message: msg.doorName + ' is ' + msg.payload + '.',\n            data: {\n                'thread-id': 'away-door-activity'\n            }\n        }\n    }\n};",
        "outputs": 1,
        "noerr": 0,
        "x": 610,
        "y": 320,
        "wires": [
            [
                "ce926406.6f9738"
            ]
        ]
    },
    {
        "id": "6887db2b.5d43f4",
        "type": "comment",
        "z": "38894af.7ca61b6",
        "name": "Door/Gate Opened While Away",
        "info": "",
        "x": 190,
        "y": 280,
        "wires": []
    },
    {
        "id": "8bbef984.6ef738",
        "type": "server-events",
        "z": "2061740e.e5207c",
        "name": "All Events",
        "server": "144427d5.6c9f18",
        "x": 100,
        "y": 180,
        "wires": [
            [
                "362d50fe.dbbed",
                "d669aebc.62cfc"
            ]
        ]
    },
    {
        "id": "362d50fe.dbbed",
        "type": "switch",
        "z": "2061740e.e5207c",
        "name": "Doorbird Motion Events",
        "property": "event_type",
        "propertyType": "msg",
        "rules": [
            {
                "t": "regex",
                "v": "doorbird_.*_motion",
                "vt": "str",
                "case": false
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 330,
        "y": 160,
        "wires": [
            [
                "be835949.460b78"
            ]
        ]
    },
    {
        "id": "ed45b12d.e4937",
        "type": "comment",
        "z": "2061740e.e5207c",
        "name": "Doorbird Automations",
        "info": "",
        "x": 140,
        "y": 100,
        "wires": []
    },
    {
        "id": "be835949.460b78",
        "type": "time-range-switch",
        "z": "2061740e.e5207c",
        "name": "isNight",
        "lat": "35.67",
        "lon": "-88.82",
        "startTime": "sunset",
        "endTime": "nightEnd",
        "startOffset": 0,
        "endOffset": 0,
        "x": 550,
        "y": 180,
        "wires": [
            [
                "9922dd52.4b8be"
            ],
            []
        ]
    },
    {
        "id": "37b11c64.75dec4",
        "type": "api-call-service",
        "z": "2061740e.e5207c",
        "name": "Turn On Lights",
        "server": "144427d5.6c9f18",
        "service_domain": "switch",
        "service": "turn_on",
        "data": "{\"entity_id\": \"switch.back_porch_light\"}",
        "mergecontext": "",
        "x": 820,
        "y": 180,
        "wires": [
            []
        ]
    },
    {
        "id": "209ca413.76181c",
        "type": "function",
        "z": "2061740e.e5207c",
        "name": "Light Mapper",
        "func": "var map = {\n    doorbird_back_door_motion: \"switch.back_porch_light\",\n    doorbird_back_door_doorbell: \"switch.back_porch_light\",\n    // doorbird_front_door_motion: \"switch.front_porch_light\",\n    doorbird_front_door_doorbell: \"switch.front_porch_light\",\n    // doorbird_side_entry_motion: \"switch.side_entry_porch_light\",\n    doorbird_side_entry_doorbell: \"switch.side_entry_porch_light\",\n}\n\nmsg.data = {\n    entity_id: map[msg.event_type]\n}\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 810,
        "y": 120,
        "wires": [
            []
        ]
    },
    {
        "id": "1e484dd6.47e5e2",
        "type": "comment",
        "z": "cb6f2b8f.2124b8",
        "name": "Set Sleep Mode on Start",
        "info": "",
        "x": 150,
        "y": 680,
        "wires": []
    },
    {
        "id": "36691f72.d39a6",
        "type": "inject",
        "z": "cb6f2b8f.2124b8",
        "name": "Startup Trigger",
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": "5",
        "topic": "on",
        "payload": "",
        "payloadType": "str",
        "x": 120,
        "y": 720,
        "wires": [
            [
                "6170f9fa.a46ca8"
            ]
        ]
    },
    {
        "id": "6170f9fa.a46ca8",
        "type": "api-current-state",
        "z": "cb6f2b8f.2124b8",
        "name": "Bed Is Occupied",
        "server": "144427d5.6c9f18",
        "version": 1,
        "outputs": 2,
        "halt_if": "Occupied",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "override_topic": true,
        "entity_id": "sensor.bed_either",
        "state_type": "str",
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "blockInputOverrides": false,
        "x": 470,
        "y": 620,
        "wires": [
            [
                "32957084.5331f"
            ],
            []
        ]
    },
    {
        "id": "5999ad4.be98354",
        "type": "server-state-changed",
        "z": "cb6f2b8f.2124b8",
        "name": "Bed Occupancy",
        "server": "144427d5.6c9f18",
        "version": 1,
        "entityidfilter": "sensor.bed_either",
        "entityidfiltertype": "exact",
        "outputinitially": false,
        "state_type": "str",
        "haltifstate": "Occupied",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "outputs": 2,
        "output_only_on_state_change": false,
        "x": 120,
        "y": 820,
        "wires": [
            [
                "12fef867.b75418"
            ],
            [
                "cf6e8412.106348"
            ]
        ]
    },
    {
        "id": "49b9a993.3c8bc8",
        "type": "api-call-service",
        "z": "cb6f2b8f.2124b8",
        "name": "Enable Sleep Mode",
        "server": "144427d5.6c9f18",
        "service_domain": "input_boolean",
        "service": "turn_on",
        "data": "{\"entity_id\":\"input_boolean.sleep_mode\"}",
        "mergecontext": "",
        "x": 730,
        "y": 720,
        "wires": [
            []
        ]
    },
    {
        "id": "f9aadbef.28b4b8",
        "type": "api-call-service",
        "z": "cb6f2b8f.2124b8",
        "name": "Disable Sleep Mode",
        "server": "144427d5.6c9f18",
        "service_domain": "input_boolean",
        "service": "turn_off",
        "data": "{\"entity_id\":\"input_boolean.sleep_mode\"}",
        "mergecontext": "",
        "output_location": "payload",
        "output_location_type": "msg",
        "mustacheAltTags": false,
        "x": 740,
        "y": 840,
        "wires": [
            []
        ]
    },
    {
        "id": "9cbc497d.174bc8",
        "type": "schedex",
        "z": "cb6f2b8f.2124b8",
        "name": "Bedtime Trigger",
        "suspended": false,
        "lat": "",
        "lon": "",
        "ontime": "22:00",
        "ontopic": "",
        "onpayload": "",
        "onoffset": 0,
        "onrandomoffset": 0,
        "offtime": "goldenHour",
        "offtopic": "",
        "offpayload": "",
        "offoffset": 0,
        "offrandomoffset": 0,
        "mon": true,
        "tue": true,
        "wed": true,
        "thu": true,
        "fri": true,
        "sat": true,
        "sun": true,
        "x": 120,
        "y": 620,
        "wires": [
            [
                "6170f9fa.a46ca8"
            ]
        ]
    },
    {
        "id": "cb69900c.75a75",
        "type": "comment",
        "z": "cb6f2b8f.2124b8",
        "name": "Set Sleep Mode at Bedtime",
        "info": "",
        "x": 160,
        "y": 580,
        "wires": []
    },
    {
        "id": "ef6b11b5.09a0c",
        "type": "comment",
        "z": "cb6f2b8f.2124b8",
        "name": "Set Sleep Mode on Occupancy",
        "info": "",
        "x": 170,
        "y": 780,
        "wires": []
    },
    {
        "id": "1ffc80e8.bd10cf",
        "type": "comment",
        "z": "eee3c0c3.7c7bd",
        "name": "Inside Lights @ Bedtime",
        "info": "",
        "x": 180,
        "y": 760,
        "wires": []
    },
    {
        "id": "bfd530b2.f283a",
        "type": "server-state-changed",
        "z": "eee3c0c3.7c7bd",
        "name": "Sleep Mode",
        "server": "144427d5.6c9f18",
        "version": 1,
        "entityidfilter": "input_boolean.sleep_mode",
        "entityidfiltertype": "substring",
        "outputinitially": false,
        "state_type": "str",
        "haltifstate": "on",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "outputs": 2,
        "output_only_on_state_change": false,
        "x": 150,
        "y": 800,
        "wires": [
            [
                "cf3a9398.0b726"
            ],
            [
                "ab9721bc.57dc"
            ]
        ]
    },
    {
        "id": "604733f.ffb9ecc",
        "type": "api-call-service",
        "z": "eee3c0c3.7c7bd",
        "name": "Group - Night Lights Off",
        "server": "144427d5.6c9f18",
        "service_domain": "homeassistant",
        "service": "turn_off",
        "data": "{\"entity_id\": \"group.lights_night_off\"}",
        "mergecontext": "",
        "x": 710,
        "y": 800,
        "wires": [
            []
        ]
    },
    {
        "id": "a5c6da26.a437e8",
        "type": "server-state-changed",
        "z": "38894af.7ca61b6",
        "name": "Sleep Mode Enabled",
        "server": "144427d5.6c9f18",
        "version": 1,
        "entityidfilter": "input_boolean.sleep_mode",
        "entityidfiltertype": "substring",
        "outputinitially": false,
        "state_type": "str",
        "haltifstate": "on",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "outputs": 2,
        "output_only_on_state_change": true,
        "x": 150,
        "y": 1120,
        "wires": [
            [
                "928ecd6a.39312"
            ],
            []
        ]
    },
    {
        "id": "46fe19a8.293148",
        "type": "comment",
        "z": "38894af.7ca61b6",
        "name": "Lock All Doors on Sleep Mode Enable",
        "info": "",
        "x": 210,
        "y": 1060,
        "wires": []
    },
    {
        "id": "e9cddfe6.fa704",
        "type": "comment",
        "z": "38894af.7ca61b6",
        "name": "Lock All Doors on Away Mode Enable",
        "info": "",
        "x": 210,
        "y": 1360,
        "wires": []
    },
    {
        "id": "35ddcdcd.f3e962",
        "type": "server-state-changed",
        "z": "38894af.7ca61b6",
        "name": "Away Mode Enabled",
        "server": "144427d5.6c9f18",
        "version": 1,
        "entityidfilter": "input_boolean.away_mode",
        "entityidfiltertype": "exact",
        "outputinitially": false,
        "state_type": "str",
        "haltifstate": "on",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "outputs": 2,
        "output_only_on_state_change": false,
        "x": 150,
        "y": 1400,
        "wires": [
            [
                "9dada5c9.04f6f8",
                "d339389a.418648"
            ],
            []
        ]
    },
    {
        "id": "36ec47a.7ed4bb8",
        "type": "server-state-changed",
        "z": "30c7e5fd.18228a",
        "name": "Away Mode Enabled",
        "server": "144427d5.6c9f18",
        "version": 0,
        "entityidfilter": "input_boolean.away_mode",
        "entityidfiltertype": "substring",
        "haltifstate": "off",
        "outputs": 1,
        "x": 170,
        "y": 140,
        "wires": [
            []
        ]
    },
    {
        "id": "879bca82.99f6f8",
        "type": "server-state-changed",
        "z": "30c7e5fd.18228a",
        "name": "Away Mode Disabled",
        "server": "144427d5.6c9f18",
        "entityidfilter": "input_boolean.away_mode",
        "entityidfiltertype": "substring",
        "haltifstate": "on",
        "outputs": 1,
        "x": 180,
        "y": 200,
        "wires": [
            [
                "3194a548.bd2f1a",
                "e70c9ec7.f71ee"
            ]
        ]
    },
    {
        "id": "3194a548.bd2f1a",
        "type": "change",
        "z": "30c7e5fd.18228a",
        "name": "Stop Timer",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "stop",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 410,
        "y": 180,
        "wires": [
            [
                "25b30fb4.e5f2b"
            ]
        ]
    },
    {
        "id": "d15821ae.44ebd",
        "type": "api-call-service",
        "z": "30c7e5fd.18228a",
        "name": "Set Ecobee Away",
        "server": "144427d5.6c9f18",
        "service_domain": "climate",
        "service": "set_preset_mode",
        "data": "{\"entity_id\":\"climate.laundry, climate.master, climate.upstairs\",\"preset_mode\":\"Away\"}",
        "mergecontext": "",
        "output_location": "payload",
        "output_location_type": "msg",
        "mustacheAltTags": false,
        "x": 890,
        "y": 80,
        "wires": [
            []
        ]
    },
    {
        "id": "ea54b02e.6a60a",
        "type": "function",
        "z": "30c7e5fd.18228a",
        "name": "Set Message",
        "func": "return {\n    payload: {\n        data: {\n            title: \"Ecobee Away Mode Enabled\",\n            message: \"Save that $$$!\"\n        }\n    }\n};",
        "outputs": 1,
        "noerr": 0,
        "x": 1110,
        "y": 240,
        "wires": [
            [
                "7e577921.85b078"
            ]
        ]
    },
    {
        "id": "3b2f81e8.6beb3e",
        "type": "comment",
        "z": "30c7e5fd.18228a",
        "name": "Enable Ecobee Away Mode",
        "info": "",
        "x": 200,
        "y": 80,
        "wires": []
    },
    {
        "id": "e70c9ec7.f71ee",
        "type": "api-call-service",
        "z": "30c7e5fd.18228a",
        "name": "Resume Schedule",
        "server": "144427d5.6c9f18",
        "service_domain": "ecobee",
        "service": "resume_program",
        "data": "{\"entity_id\":\"climate.laundry, climate.master, climate.upstairs\",\"resume_all\":true}",
        "mergecontext": "",
        "output_location": "payload",
        "output_location_type": "msg",
        "mustacheAltTags": false,
        "x": 550,
        "y": 360,
        "wires": [
            []
        ]
    },
    {
        "id": "9922dd52.4b8be",
        "type": "api-current-state",
        "z": "2061740e.e5207c",
        "name": "Sleep Mode Active",
        "server": "144427d5.6c9f18",
        "outputs": 1,
        "halt_if": "on",
        "override_topic": false,
        "entity_id": "input_boolean.sleep_mode",
        "override_payload": false,
        "x": 610,
        "y": 120,
        "wires": [
            [
                "209ca413.76181c"
            ]
        ]
    },
    {
        "id": "d26e85b.c424b78",
        "type": "api-call-service",
        "z": "eee3c0c3.7c7bd",
        "name": "Stair Light On",
        "server": "144427d5.6c9f18",
        "service_domain": "homeassistant",
        "service": "turn_on",
        "data": "{\"entity_id\": \"switch.stair_light\"}",
        "mergecontext": "",
        "x": 680,
        "y": 860,
        "wires": [
            []
        ]
    },
    {
        "id": "ab9721bc.57dc",
        "type": "api-call-service",
        "z": "eee3c0c3.7c7bd",
        "name": "Stair Light Off",
        "server": "144427d5.6c9f18",
        "service_domain": "homeassistant",
        "service": "turn_off",
        "data": "{\"entity_id\": \"switch.stair_light\"}",
        "mergecontext": "",
        "x": 440,
        "y": 880,
        "wires": [
            []
        ]
    },
    {
        "id": "4c43add1.d859b4",
        "type": "stoptimer",
        "z": "38894af.7ca61b6",
        "duration": "1",
        "units": "Minute",
        "payloadtype": "num",
        "payloadval": "0",
        "name": "1m Timer",
        "x": 760,
        "y": 500,
        "wires": [
            [
                "3cac9dc5.f192f2",
                "53322bd0.9ade94"
            ],
            []
        ]
    },
    {
        "id": "2a8e78a8.3a6a48",
        "type": "function",
        "z": "38894af.7ca61b6",
        "name": "Build Notification",
        "func": "var notificationMessage = 'The ' + msg.doorName + ' has been left open.';\n\nif(msg.payload === 'Closed') {\n    notificationMessage = 'The ' + msg.doorName + ' has been closed.';\n}\n\nreturn {\n    payload: {\n        data: {\n            title: \"Door Activity Notification\",\n            message: notificationMessage,\n            data: {\n                push: {\n                    category: 'clear_door_timer',\n                    \"thread-id\": 'ha-door-notification-' + msg.doorName \n                }\n            }\n        }\n    }\n};",
        "outputs": 1,
        "noerr": 0,
        "x": 1070,
        "y": 560,
        "wires": [
            [
                "f2b70656.597f28"
            ]
        ]
    },
    {
        "id": "5e4eb376.2ae7dc",
        "type": "server-state-changed",
        "z": "38894af.7ca61b6",
        "name": "Door Closed",
        "server": "144427d5.6c9f18",
        "version": 1,
        "entityidfilter": "door_state",
        "entityidfiltertype": "substring",
        "outputinitially": false,
        "state_type": "str",
        "haltifstate": "off",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "outputs": 2,
        "output_only_on_state_change": true,
        "x": 130,
        "y": 660,
        "wires": [
            [
                "ba818cf8.be274"
            ],
            []
        ]
    },
    {
        "id": "fea89e0d.500b8",
        "type": "comment",
        "z": "38894af.7ca61b6",
        "name": "Notify If Door/Gate Open > 1m",
        "info": "",
        "x": 190,
        "y": 460,
        "wires": []
    },
    {
        "id": "ba818cf8.be274",
        "type": "change",
        "z": "38894af.7ca61b6",
        "name": "Stop Timer",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "STOP",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 350,
        "y": 700,
        "wires": [
            [
                "27fb2179.a7237e"
            ]
        ]
    },
    {
        "id": "27fb2179.a7237e",
        "type": "switch",
        "z": "38894af.7ca61b6",
        "name": "Door Router",
        "property": "topic",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "binary_sensor.front_door_state",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "binary_sensor.back_door_state",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "binary_sensor.side_door_state",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "binary_sensor.north_gate_state",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "binary_sensor.south_gate_state",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "cover.garage_1",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "cover.garage_2",
                "vt": "str"
            }
        ],
        "checkall": "false",
        "repair": false,
        "outputs": 7,
        "x": 570,
        "y": 580,
        "wires": [
            [
                "4c43add1.d859b4"
            ],
            [
                "e6f4f6d4.3f84b8"
            ],
            [
                "6a93c010.4eedd"
            ],
            [
                "481e307a.623bc"
            ],
            [
                "3f6afe29.11be52"
            ],
            [
                "f6ab6bfc.8c7ab8"
            ],
            [
                "a4f5259.feac0d8"
            ]
        ]
    },
    {
        "id": "e6f4f6d4.3f84b8",
        "type": "stoptimer",
        "z": "38894af.7ca61b6",
        "duration": "1",
        "units": "Minute",
        "payloadtype": "num",
        "payloadval": "0",
        "name": "1m Timer",
        "x": 760,
        "y": 540,
        "wires": [
            [
                "3cac9dc5.f192f2",
                "53322bd0.9ade94"
            ],
            []
        ]
    },
    {
        "id": "6a93c010.4eedd",
        "type": "stoptimer",
        "z": "38894af.7ca61b6",
        "duration": "1",
        "units": "Minute",
        "payloadtype": "num",
        "payloadval": "0",
        "name": "1m Timer",
        "x": 760,
        "y": 580,
        "wires": [
            [
                "3cac9dc5.f192f2",
                "53322bd0.9ade94"
            ],
            []
        ]
    },
    {
        "id": "3cac9dc5.f192f2",
        "type": "link out",
        "z": "38894af.7ca61b6",
        "name": "Utility - Repeat Door Timer",
        "links": [
            "ef97a7a2.bd3d68"
        ],
        "x": 975,
        "y": 620,
        "wires": []
    },
    {
        "id": "ef97a7a2.bd3d68",
        "type": "link in",
        "z": "38894af.7ca61b6",
        "name": "Utility - Repeat Door Timer",
        "links": [
            "3cac9dc5.f192f2"
        ],
        "x": 395,
        "y": 740,
        "wires": [
            [
                "27fb2179.a7237e"
            ]
        ]
    },
    {
        "id": "53322bd0.9ade94",
        "type": "function",
        "z": "38894af.7ca61b6",
        "name": "Door Namer",
        "func": "var doorNames = {\n    'binary_sensor.front_door_state': 'Front Door',\n    'binary_sensor.back_door_state': 'Back Door',\n    'binary_sensor.side_door_state': 'Side Door',\n    'binary_sensor.south_gate_state': 'South Gate',\n    'binary_sensor.north_gate_state': 'North Gate',\n    'cover.garage_1': 'Garage Door 1',\n    'cover.garage_2': 'Garage Door 2'\n}\n\nif(doorNames.hasOwnProperty(msg.topic)) {\n    msg.doorName = doorNames[msg.topic]\n}\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 1030,
        "y": 520,
        "wires": [
            [
                "2a8e78a8.3a6a48"
            ]
        ]
    },
    {
        "id": "98de7b37.97b938",
        "type": "server-state-changed",
        "z": "cb6f2b8f.2124b8",
        "name": "Away Mode Enabled",
        "server": "144427d5.6c9f18",
        "version": 1,
        "entityidfilter": "input_boolean.away_mode",
        "entityidfiltertype": "exact",
        "outputinitially": false,
        "state_type": "str",
        "haltifstate": "on",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "outputs": 2,
        "output_only_on_state_change": false,
        "x": 150,
        "y": 1000,
        "wires": [
            [
                "38ab4a04.31f836"
            ],
            []
        ]
    },
    {
        "id": "cf3e3ab9.88a658",
        "type": "comment",
        "z": "cb6f2b8f.2124b8",
        "name": "Notify on Away Mode Enable",
        "info": "",
        "x": 160,
        "y": 940,
        "wires": []
    },
    {
        "id": "38ab4a04.31f836",
        "type": "function",
        "z": "cb6f2b8f.2124b8",
        "name": "Build Notification",
        "func": "return {\n    payload: {\n        data: {\n            title: \"Away Mode Active\",\n            message: \"You will be notified of any unusual activity.\"\n        }\n    }\n};",
        "outputs": 1,
        "noerr": 0,
        "x": 410,
        "y": 1000,
        "wires": [
            [
                "51f9861c.fb07a8"
            ]
        ]
    },
    {
        "id": "b38d6099.4e13d",
        "type": "inject",
        "z": "cb6f2b8f.2124b8",
        "name": "Test Notification",
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "true",
        "payloadType": "bool",
        "x": 420,
        "y": 960,
        "wires": [
            [
                "38ab4a04.31f836"
            ]
        ]
    },
    {
        "id": "259dc6d8.29a85a",
        "type": "link in",
        "z": "90be6c3f.6407",
        "name": "Push Notification - Matt",
        "links": [
            "33e0d52f.80feea",
            "3d25c1a9.3a673e",
            "3f1cb6f.d64444a",
            "51f9861c.fb07a8",
            "553988c1.e16418",
            "562a6302.2c4fac",
            "5ff8b930.afc738",
            "7ac33f9f.1276",
            "7e577921.85b078",
            "9a1b5a6f.701c08",
            "a6aa9ecc.fbb3b",
            "b2243d7b.9aa5f",
            "d62da390.c14cc",
            "f2b70656.597f28",
            "fb45bc1d.a0ecb",
            "3e1a676b.172da8",
            "fd535219.99971",
            "b6a8ab3c.6342e8"
        ],
        "x": 255,
        "y": 260,
        "wires": [
            [
                "5a78366b.a02858"
            ]
        ]
    },
    {
        "id": "3ba4aeb7.ee1e12",
        "type": "link in",
        "z": "90be6c3f.6407",
        "name": "Push Notification - Alydia",
        "links": [
            "3d25c1a9.3a673e",
            "51f9861c.fb07a8",
            "553988c1.e16418",
            "5e9d1b86.e677f4",
            "5ff8b930.afc738",
            "ce926406.6f9738",
            "f087f08a.0264e",
            "f2b70656.597f28",
            "fd535219.99971",
            "d920bf48.d8d85"
        ],
        "x": 255,
        "y": 340,
        "wires": [
            [
                "c781ecd5.f4ab4"
            ]
        ]
    },
    {
        "id": "51f9861c.fb07a8",
        "type": "link out",
        "z": "cb6f2b8f.2124b8",
        "name": "Away Mode Enabled",
        "links": [
            "259dc6d8.29a85a",
            "3ba4aeb7.ee1e12",
            "58dfbc1f.ec9674"
        ],
        "x": 575,
        "y": 1000,
        "wires": []
    },
    {
        "id": "ce926406.6f9738",
        "type": "link out",
        "z": "38894af.7ca61b6",
        "name": "Door Opened While Away",
        "links": [
            "3ba4aeb7.ee1e12",
            "58dfbc1f.ec9674",
            "f7417213.1e0df",
            "f60c4926.bc1918"
        ],
        "x": 755,
        "y": 320,
        "wires": []
    },
    {
        "id": "33e0d52f.80feea",
        "type": "link out",
        "z": "cb6f2b8f.2124b8",
        "name": "Guest Mode Disabled",
        "links": [
            "259dc6d8.29a85a",
            "58dfbc1f.ec9674"
        ],
        "x": 1075,
        "y": 240,
        "wires": []
    },
    {
        "id": "c03ce9cb.bd9d28",
        "type": "function",
        "z": "cb6f2b8f.2124b8",
        "name": "Set Message",
        "func": "return {\n    payload: {\n        data: {\n            title: \"Guest Mode Disabled\",\n            message: \"All guest devices have disconnected from network.\"\n        }\n    }\n};",
        "outputs": 1,
        "noerr": 0,
        "x": 950,
        "y": 240,
        "wires": [
            [
                "33e0d52f.80feea"
            ]
        ]
    },
    {
        "id": "f2b70656.597f28",
        "type": "link out",
        "z": "38894af.7ca61b6",
        "name": "Door Left Open",
        "links": [
            "259dc6d8.29a85a",
            "3ba4aeb7.ee1e12",
            "58dfbc1f.ec9674",
            "66e43dcb.363604",
            "d7669edc.b8c1"
        ],
        "x": 1215,
        "y": 560,
        "wires": []
    },
    {
        "id": "5a78366b.a02858",
        "type": "api-call-service",
        "z": "90be6c3f.6407",
        "name": "Push Notification - Matt",
        "server": "144427d5.6c9f18",
        "service_domain": "notify",
        "service": "mobile_app_matts_iphone",
        "data": "",
        "mergecontext": "",
        "output_location": "payload",
        "output_location_type": "msg",
        "mustacheAltTags": false,
        "x": 650,
        "y": 260,
        "wires": [
            []
        ]
    },
    {
        "id": "c781ecd5.f4ab4",
        "type": "api-call-service",
        "z": "90be6c3f.6407",
        "name": "Push Notification - Alydia",
        "server": "144427d5.6c9f18",
        "service_domain": "notify",
        "service": "mobile_app_alydia_s_iphone",
        "data": "{\"title\":\"Matt says...\", \"message\":\"I love you!\"}",
        "mergecontext": "",
        "output_location": "payload",
        "output_location_type": "msg",
        "mustacheAltTags": false,
        "x": 650,
        "y": 340,
        "wires": [
            []
        ]
    },
    {
        "id": "d88ae7ad.72c5b8",
        "type": "link in",
        "z": "90be6c3f.6407",
        "name": "Alexa TTS - Master Bedroom",
        "links": [
            "562a6302.2c4fac",
            "5e9d1b86.e677f4",
            "9fc4d89a.e1ae38",
            "f087f08a.0264e",
            "3f1cb6f.d64444a",
            "fd535219.99971",
            "d920bf48.d8d85"
        ],
        "x": 255,
        "y": 420,
        "wires": [
            [
                "f770cf38.c47f2"
            ]
        ]
    },
    {
        "id": "5e9d1b86.e677f4",
        "type": "link out",
        "z": "38894af.7ca61b6",
        "name": "Smoke Detected",
        "links": [
            "3ba4aeb7.ee1e12",
            "58dfbc1f.ec9674",
            "66e43dcb.363604",
            "d7669edc.b8c1",
            "e41eac8.937f55",
            "d88ae7ad.72c5b8",
            "3c513bc.a5aa8c4",
            "26219430.1853ec",
            "b5c2d8b0.9a59d8",
            "5c44608f.94f4c",
            "f7417213.1e0df",
            "f60c4926.bc1918"
        ],
        "x": 875,
        "y": 180,
        "wires": []
    },
    {
        "id": "9dada5c9.04f6f8",
        "type": "api-call-service",
        "z": "38894af.7ca61b6",
        "name": "Lock All Doors",
        "server": "144427d5.6c9f18",
        "service_domain": "lock",
        "service": "lock",
        "data": "{\"entity_id\": \"lock.front_door, lock.back_door, lock.garage_entry, lock.side_entry\"}",
        "mergecontext": "",
        "x": 420,
        "y": 1400,
        "wires": [
            []
        ]
    },
    {
        "id": "3c513bc.a5aa8c4",
        "type": "link in",
        "z": "90be6c3f.6407",
        "name": "Alexa TTS - Matt's Office",
        "links": [
            "5e9d1b86.e677f4",
            "f087f08a.0264e",
            "3f1cb6f.d64444a"
        ],
        "x": 255,
        "y": 500,
        "wires": [
            [
                "8d6f3712.ad8788"
            ]
        ]
    },
    {
        "id": "da1c8d91.ec08b",
        "type": "comment",
        "z": "38894af.7ca61b6",
        "name": "Doorbell Notifications",
        "info": "",
        "x": 160,
        "y": 1500,
        "wires": []
    },
    {
        "id": "f69a6ad1.9ab428",
        "type": "server-events",
        "z": "38894af.7ca61b6",
        "name": "All Events",
        "server": "144427d5.6c9f18",
        "x": 120,
        "y": 1580,
        "wires": [
            [
                "fad883e.4f9208"
            ]
        ]
    },
    {
        "id": "fad883e.4f9208",
        "type": "switch",
        "z": "38894af.7ca61b6",
        "name": "Doorbird Doorbell Events",
        "property": "event_type",
        "propertyType": "msg",
        "rules": [
            {
                "t": "regex",
                "v": "doorbird_.*_doorbell",
                "vt": "str",
                "case": false
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 350,
        "y": 1580,
        "wires": [
            [
                "1ef8149b.76ac7b",
                "c5826772.8ebcb8"
            ]
        ]
    },
    {
        "id": "1ef8149b.76ac7b",
        "type": "function",
        "z": "38894af.7ca61b6",
        "name": "Doorbell Identifier",
        "func": "var map = {\n    doorbird_back_door_doorbell: \"back door\",\n    doorbird_front_door_doorbell: \"front door\",\n    doorbird_side_entry_doorbell: \"side door\",\n}\n\nvar stream = {\n    doorbird_back_door_doorbell: \"https://bi.obscurelogic.com/image/backdoor?q=50&s=80\",\n    doorbird_front_door_doorbell: \"https://bi.obscurelogic.com/image/frontdoor?q=50&s=80\",\n    doorbird_side_entry_doorbell: \"https://bi.obscurelogic.com/image/sideentry?q=50&s=80\",\n}\n\nmsg.data = {\n    door_name: map[msg.event_type],\n    stream_url: stream[msg.event_type]\n}\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 630,
        "y": 1580,
        "wires": [
            [
                "55feffde.8c42f"
            ]
        ]
    },
    {
        "id": "55feffde.8c42f",
        "type": "function",
        "z": "38894af.7ca61b6",
        "name": "Set Message",
        "func": "doorbellMessages = [\n    'The ' + msg.data.door_name + ' bell has rung.',\n    'Somebody is at the ' + msg.data.door_name,\n    'Somebody requires attention at the ' + msg.data.door_name,\n    'The doorbell has been pressed at the ' + msg.data.door_name\n]\n\nreturn {\n    payload: {\n        data: {\n            message: doorbellMessages[Math.floor(Math.random()*doorbellMessages.length)],\n        \n            data: {\n                attachment: {\n                    \"content-type\": \"jpeg\",\n                    url: msg.data.stream_url\n                },\n                \"thread-id\": 'doorbell-notification'\n            }\n        }\n    }\n};",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 810,
        "y": 1580,
        "wires": [
            [
                "fd535219.99971",
                "b6957352.54ced"
            ]
        ]
    },
    {
        "id": "fd535219.99971",
        "type": "link out",
        "z": "38894af.7ca61b6",
        "name": "Doorbell Button Notifications",
        "links": [
            "259dc6d8.29a85a",
            "3ba4aeb7.ee1e12",
            "b5c2d8b0.9a59d8",
            "d7669edc.b8c1",
            "d88ae7ad.72c5b8"
        ],
        "x": 1175,
        "y": 1580,
        "wires": []
    },
    {
        "id": "26219430.1853ec",
        "type": "link in",
        "z": "90be6c3f.6407",
        "name": "Alexa TTS - Playroom",
        "links": [
            "5e9d1b86.e677f4",
            "f087f08a.0264e",
            "d45c6688.fec088",
            "7ac33f9f.1276",
            "5ff8b930.afc738"
        ],
        "x": 255,
        "y": 560,
        "wires": [
            [
                "29489496.5079dc"
            ]
        ]
    },
    {
        "id": "704a126f.c1e7bc",
        "type": "inject",
        "z": "90be6c3f.6407",
        "name": "Send Test Message",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "{\"data\":{\"title\":\"Test Notification\",\"message\":\"This is a test.\"}}",
        "payloadType": "json",
        "x": 130,
        "y": 460,
        "wires": [
            [
                "95d34970.d787f8"
            ]
        ]
    },
    {
        "id": "18ef1a18.f12fe6",
        "type": "function",
        "z": "38894af.7ca61b6",
        "name": "Set Sleep Routine Fired",
        "func": "global.set('sleep_routine_fired', true);\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 470,
        "y": 1160,
        "wires": [
            []
        ]
    },
    {
        "id": "d354f7f.00c8d08",
        "type": "server-state-changed",
        "z": "38894af.7ca61b6",
        "name": "Exterior Door Unlocked",
        "server": "144427d5.6c9f18",
        "version": 1,
        "entityidfilter": "group.exterior_locks",
        "entityidfiltertype": "exact",
        "outputinitially": false,
        "state_type": "str",
        "haltifstate": "locked",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "outputs": 2,
        "output_only_on_state_change": false,
        "x": 820,
        "y": 1340,
        "wires": [
            [],
            [
                "326c2add.6e3806"
            ]
        ]
    },
    {
        "id": "326c2add.6e3806",
        "type": "function",
        "z": "38894af.7ca61b6",
        "name": "Reset Sleep Routine",
        "func": "global.set('sleep_routine_fired', false);\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 1200,
        "y": 1100,
        "wires": [
            []
        ]
    },
    {
        "id": "928ecd6a.39312",
        "type": "switch",
        "z": "38894af.7ca61b6",
        "name": "Halt If Routine Already Executed",
        "property": "sleep_routine_fired",
        "propertyType": "global",
        "rules": [
            {
                "t": "false"
            }
        ],
        "checkall": "false",
        "repair": false,
        "outputs": 1,
        "x": 470,
        "y": 1120,
        "wires": [
            [
                "6049fc74.846f74",
                "18ef1a18.f12fe6"
            ]
        ]
    },
    {
        "id": "7957925.104696c",
        "type": "inject",
        "z": "38894af.7ca61b6",
        "name": "Reset Sleep Routine",
        "repeat": "",
        "crontab": "00 09 * * *",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 820,
        "y": 1300,
        "wires": [
            [
                "326c2add.6e3806"
            ]
        ]
    },
    {
        "id": "b3ed595e.befc58",
        "type": "comment",
        "z": "38894af.7ca61b6",
        "name": "Reset Sleep Routine",
        "info": "Daily reset allows sleep routine to fire \nagain each night.\n\nResetting on exterior door unlock means \nthe sleep routine will fire again when \ngetting back in bed if a door is unlocked\nafter bedtime.  This should ensure that \ndoors are secured while sleeping.\n\n",
        "x": 810,
        "y": 1260,
        "wires": []
    },
    {
        "id": "3ce6d3cd.af215c",
        "type": "server-state-changed",
        "z": "38894af.7ca61b6",
        "name": "Door Opened",
        "server": "144427d5.6c9f18",
        "version": 1,
        "entityidfilter": "door_state",
        "entityidfiltertype": "substring",
        "outputinitially": false,
        "state_type": "str",
        "haltifstate": "on",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "outputs": 2,
        "output_only_on_state_change": false,
        "x": 350,
        "y": 540,
        "wires": [
            [
                "27fb2179.a7237e",
                "a7dd324a.6bbbc"
            ],
            []
        ]
    },
    {
        "id": "8bfc1912.cc2258",
        "type": "server-state-changed",
        "z": "38894af.7ca61b6",
        "name": "Door Opened",
        "server": "144427d5.6c9f18",
        "version": 1,
        "entityidfilter": "door_state",
        "entityidfiltertype": "substring",
        "outputinitially": false,
        "state_type": "str",
        "haltifstate": "on",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "outputs": 2,
        "output_only_on_state_change": false,
        "x": 130,
        "y": 880,
        "wires": [
            [
                "fd815c5c.72ed2"
            ],
            []
        ]
    },
    {
        "id": "6c5d3ea3.f4f51",
        "type": "comment",
        "z": "38894af.7ca61b6",
        "name": "Door Opened While Sleeping",
        "info": "",
        "x": 180,
        "y": 820,
        "wires": []
    },
    {
        "id": "8d8206b1.6ffa18",
        "type": "function",
        "z": "38894af.7ca61b6",
        "name": "Door Namer",
        "func": "var doorNames = {\n    'binary_sensor.front_door_state': 'Front Door',\n    'binary_sensor.back_door_state': 'Back Door',\n    'binary_sensor.side_door_state': 'Side Door'\n}\n\nif(doorNames.hasOwnProperty(msg.topic)) {\n    msg.topic = doorNames[msg.topic]\n}\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 770,
        "y": 860,
        "wires": [
            [
                "fcaa231a.8b616"
            ]
        ]
    },
    {
        "id": "fcaa231a.8b616",
        "type": "template",
        "z": "38894af.7ca61b6",
        "name": "Set Message",
        "field": "message",
        "fieldType": "msg",
        "format": "handlebars",
        "syntax": "mustache",
        "template": "Wake up. The {{topic}} has been opened.",
        "output": "str",
        "x": 770,
        "y": 900,
        "wires": [
            [
                "e09ea359.04e5f"
            ]
        ]
    },
    {
        "id": "e09ea359.04e5f",
        "type": "function",
        "z": "38894af.7ca61b6",
        "name": "Build Notification",
        "func": "return {\n    payload: {\n        data: {\n            title: \"DOOR STILL OPEN!\",\n            message: msg.message,\n        }\n    }\n};",
        "outputs": 1,
        "noerr": 0,
        "x": 790,
        "y": 940,
        "wires": [
            [
                "9fc4d89a.e1ae38",
                "1751f37c.107a7d"
            ]
        ]
    },
    {
        "id": "9fc4d89a.e1ae38",
        "type": "link out",
        "z": "38894af.7ca61b6",
        "name": "Door Opened While Sleeping",
        "links": [
            "d88ae7ad.72c5b8",
            "f7417213.1e0df",
            "f60c4926.bc1918"
        ],
        "x": 1235,
        "y": 940,
        "wires": []
    },
    {
        "id": "12e1ad7d.3633e3",
        "type": "inject",
        "z": "38894af.7ca61b6",
        "name": "Test Notification",
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 440,
        "y": 820,
        "wires": [
            [
                "c672fc66.53c1c"
            ]
        ]
    },
    {
        "id": "c672fc66.53c1c",
        "type": "function",
        "z": "38894af.7ca61b6",
        "name": "Setup Test Notification",
        "func": "return {\n    \"payload\": \"open\",\n    \"topic\": \"sensor.front_door_state\"\n}",
        "outputs": 1,
        "noerr": 0,
        "x": 740,
        "y": 820,
        "wires": [
            [
                "8d8206b1.6ffa18"
            ]
        ]
    },
    {
        "id": "8dbee0f6.087c",
        "type": "delay",
        "z": "38894af.7ca61b6",
        "name": "Delay 4s",
        "pauseType": "delay",
        "timeout": "4",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "x": 1040,
        "y": 900,
        "wires": [
            [
                "9fc4d89a.e1ae38",
                "1751f37c.107a7d"
            ]
        ]
    },
    {
        "id": "b5c2d8b0.9a59d8",
        "type": "link in",
        "z": "90be6c3f.6407",
        "name": "Alexa TTS - Kitchen",
        "links": [
            "5e9d1b86.e677f4",
            "f087f08a.0264e",
            "3f1cb6f.d64444a",
            "d45c6688.fec088",
            "5ff8b930.afc738",
            "fd535219.99971"
        ],
        "x": 255,
        "y": 660,
        "wires": [
            [
                "95d34970.d787f8"
            ]
        ]
    },
    {
        "id": "c8f1ecf8.47595",
        "type": "server-state-changed",
        "z": "38894af.7ca61b6",
        "name": "Water Leak Sensor",
        "server": "144427d5.6c9f18",
        "entityidfilter": "binary_sensor.*leak*",
        "entityidfiltertype": "regex",
        "haltifstate": "",
        "outputs": 1,
        "x": 150,
        "y": 2040,
        "wires": [
            [
                "744bfc94.bf9cb4"
            ]
        ]
    },
    {
        "id": "744bfc94.bf9cb4",
        "type": "switch",
        "z": "38894af.7ca61b6",
        "name": "on/off",
        "property": "payload",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "on",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "off",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 330,
        "y": 2040,
        "wires": [
            [
                "fb2e3c5e.c248"
            ],
            [
                "5fda46a6.5fbcc8"
            ]
        ]
    },
    {
        "id": "5fda46a6.5fbcc8",
        "type": "change",
        "z": "38894af.7ca61b6",
        "name": "Reset Delay",
        "rules": [
            {
                "t": "set",
                "p": "reset",
                "pt": "msg",
                "to": "true",
                "tot": "bool"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 490,
        "y": 2100,
        "wires": [
            [
                "b90ef3c2.e2a1"
            ]
        ]
    },
    {
        "id": "fb2e3c5e.c248",
        "type": "function",
        "z": "38894af.7ca61b6",
        "name": "Leak Sensor Locator",
        "func": "var map = {\n    \"binary_sensor.kitchen_leak_sensor\": \"Kitchen\",\n    \"binary_sensor.master_bath_leak_sensor\": \"Master Bathroom\",\n    \"binary_sensor.laundry_room_sink_leak_sensor\": \"Laundry Room Sink\"\n}\n\nmsg.data = {\n    sensor_location: map[msg.topic]\n}\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 520,
        "y": 2000,
        "wires": [
            [
                "e99dbcd0.6a0e9"
            ]
        ]
    },
    {
        "id": "b90ef3c2.e2a1",
        "type": "delay",
        "z": "38894af.7ca61b6",
        "name": "Delay 60s",
        "pauseType": "delay",
        "timeout": "60",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "x": 740,
        "y": 2100,
        "wires": [
            [
                "f087f08a.0264e",
                "b2055264.6e15c"
            ]
        ]
    },
    {
        "id": "e99dbcd0.6a0e9",
        "type": "function",
        "z": "38894af.7ca61b6",
        "name": "Build Notification",
        "func": "return {\n    payload: {\n        data: {\n            title: 'LEAK DETECTED!',\n            message: \"A leak has been detected in the \" + msg.data.sensor_location,\n        \n            data: {\n                \"thread-id\": 'water-leak-notification'\n            }\n        }\n    }\n};",
        "outputs": 1,
        "noerr": 0,
        "x": 750,
        "y": 2000,
        "wires": [
            [
                "f087f08a.0264e",
                "b2055264.6e15c"
            ]
        ]
    },
    {
        "id": "f087f08a.0264e",
        "type": "link out",
        "z": "38894af.7ca61b6",
        "name": "Leak Detected",
        "links": [
            "3ba4aeb7.ee1e12",
            "58dfbc1f.ec9674",
            "66e43dcb.363604",
            "d7669edc.b8c1",
            "e41eac8.937f55",
            "d88ae7ad.72c5b8",
            "3c513bc.a5aa8c4",
            "26219430.1853ec",
            "b5c2d8b0.9a59d8",
            "5c44608f.94f4c",
            "f7417213.1e0df",
            "f60c4926.bc1918"
        ],
        "x": 975,
        "y": 2000,
        "wires": []
    },
    {
        "id": "b14d8b5.771eb78",
        "type": "comment",
        "z": "38894af.7ca61b6",
        "name": "Water Leak Notifications",
        "info": "",
        "x": 170,
        "y": 1900,
        "wires": []
    },
    {
        "id": "4254c077.173be",
        "type": "function",
        "z": "b55ab74c.698a88",
        "name": "Set Warning Message",
        "func": "var bedtimeMessages = [\n    'Bedtime is in ' + msg.payload,\n    msg.payload + ' until bedtime.',\n    'Twinkle twinkle little star, bedtime is not that far.',\n    'Bedtime quickly approaches. T-minus ' + msg.payload + ' and counting.',\n    'Time to go potty and get ready for bed. ' + msg.payload + ' until bedtime',\n    'Start getting ready for bed.'\n    ]\n\nreturn {\n    payload: {\n        data: {\n            message: bedtimeMessages[Math.floor(Math.random()*bedtimeMessages.length)],\n            data: {\n                push: {\n                    category: 'silence_bedtime_notifications',\n                    \"thread-id\": 'bedtime-notification'\n                }\n            }\n        }\n    }\n};",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 1140,
        "y": 1020,
        "wires": [
            [
                "a17d9cdd.46c2d"
            ]
        ]
    },
    {
        "id": "5ff8b930.afc738",
        "type": "link out",
        "z": "b55ab74c.698a88",
        "name": "Bedtime Notifications",
        "links": [
            "259dc6d8.29a85a",
            "26219430.1853ec",
            "3ba4aeb7.ee1e12",
            "58dfbc1f.ec9674",
            "b5c2d8b0.9a59d8",
            "d7669edc.b8c1"
        ],
        "x": 1295,
        "y": 1060,
        "wires": []
    },
    {
        "id": "a20fcb6f.79b368",
        "type": "function",
        "z": "b55ab74c.698a88",
        "name": "Set Bedtime Message",
        "func": "var bedtimeMessages = [\n    'It is now bedtime.',\n    'Guess what time it is. Bedtime.',\n    'Time to get in the bed.',\n    'Bedtime.',\n    'The time has come. It is time to sleep.',\n    'Good night, sleep tight.',\n    'Good night, sweet children.'\n]\n\nreturn {\n    payload: {\n        data: {\n            message: bedtimeMessages[Math.floor(Math.random()*bedtimeMessages.length)],\n            data: {\n                \"thread-id\": 'bedtime-notification'\n            }\n        }\n    }\n}",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 1140,
        "y": 1120,
        "wires": [
            [
                "a17d9cdd.46c2d"
            ]
        ]
    },
    {
        "id": "48b0def5.daad6",
        "type": "comment",
        "z": "b55ab74c.698a88",
        "name": "Bedtime Alerts",
        "info": "",
        "x": 420,
        "y": 860,
        "wires": []
    },
    {
        "id": "34b777c3.70f908",
        "type": "inject",
        "z": "38894af.7ca61b6",
        "name": "Test Notification",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "doorbird_front_door_doorbell",
        "payload": "",
        "payloadType": "date",
        "x": 140,
        "y": 1540,
        "wires": [
            [
                "b30ba49.231ce58"
            ]
        ]
    },
    {
        "id": "b30ba49.231ce58",
        "type": "function",
        "z": "38894af.7ca61b6",
        "name": "Test Doorbell",
        "func": "msg.event_type = 'doorbird_front_door_doorbell'\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 390,
        "y": 1540,
        "wires": [
            [
                "1ef8149b.76ac7b"
            ]
        ]
    },
    {
        "id": "5c44608f.94f4c",
        "type": "link in",
        "z": "90be6c3f.6407",
        "name": "Alexa TTS - Girl's Room",
        "links": [
            "5e9d1b86.e677f4",
            "f087f08a.0264e"
        ],
        "x": 255,
        "y": 720,
        "wires": [
            [
                "bc9ef461.5004b8"
            ]
        ]
    },
    {
        "id": "f65133f3.e5e14",
        "type": "inject",
        "z": "38894af.7ca61b6",
        "name": "Send Test Notification",
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 160,
        "y": 1940,
        "wires": [
            [
                "108b40b8.6c91ef"
            ]
        ]
    },
    {
        "id": "108b40b8.6c91ef",
        "type": "function",
        "z": "38894af.7ca61b6",
        "name": "Setup Test Notification",
        "func": "return {\n    \"payload\": \"on\",\n    \"topic\": \"binary_sensor.master_bath_leak_sensor\"\n}",
        "outputs": 1,
        "noerr": 0,
        "x": 400,
        "y": 1940,
        "wires": [
            [
                "fb2e3c5e.c248"
            ]
        ]
    },
    {
        "id": "821ebb4c.7ccd38",
        "type": "inject",
        "z": "38894af.7ca61b6",
        "name": "Stop Notification Loop",
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 160,
        "y": 2100,
        "wires": [
            [
                "5fda46a6.5fbcc8"
            ]
        ]
    },
    {
        "id": "5e48cb98.0d30f4",
        "type": "api-call-service",
        "z": "90be6c3f.6407",
        "name": "WebOS - Playroom TV",
        "server": "144427d5.6c9f18",
        "service_domain": "notify",
        "service": "playroom_tv",
        "data": "",
        "mergecontext": "",
        "output_location": "payload",
        "output_location_type": "msg",
        "x": 640,
        "y": 180,
        "wires": [
            []
        ]
    },
    {
        "id": "66e43dcb.363604",
        "type": "link in",
        "z": "90be6c3f.6407",
        "name": "WebOS - Playroom TV",
        "links": [
            "5e9d1b86.e677f4",
            "f087f08a.0264e",
            "f2b70656.597f28",
            "3f1cb6f.d64444a"
        ],
        "x": 255,
        "y": 180,
        "wires": [
            [
                "5e48cb98.0d30f4"
            ]
        ]
    },
    {
        "id": "c5826772.8ebcb8",
        "type": "debug",
        "z": "38894af.7ca61b6",
        "name": "Doorbird Button Events",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "x": 650,
        "y": 1620,
        "wires": []
    },
    {
        "id": "b10cd235.4e338",
        "type": "api-call-service",
        "z": "90be6c3f.6407",
        "name": "Push Notification - Matt Browser",
        "server": "144427d5.6c9f18",
        "service_domain": "notify",
        "service": "browser_push",
        "data": "",
        "mergecontext": "",
        "output_location": "payload",
        "output_location_type": "msg",
        "mustacheAltTags": false,
        "x": 680,
        "y": 220,
        "wires": [
            []
        ]
    },
    {
        "id": "eb4a90c8.9c286",
        "type": "mqtt in",
        "z": "2061740e.e5207c",
        "name": "All MQTT",
        "topic": "#",
        "qos": "2",
        "broker": "1f84a57d.10775b",
        "x": 120,
        "y": 860,
        "wires": [
            [
                "24d70e68.65b4d2"
            ]
        ]
    },
    {
        "id": "24d70e68.65b4d2",
        "type": "debug",
        "z": "2061740e.e5207c",
        "name": "MQTT Messages",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "x": 310,
        "y": 860,
        "wires": []
    },
    {
        "id": "80420cd7.0f748",
        "type": "server-state-changed",
        "z": "47267ef8.fca6f",
        "name": "Bed Unoccupied",
        "server": "144427d5.6c9f18",
        "entityidfilter": "sensor.bed_both",
        "entityidfiltertype": "exact",
        "haltifstate": "Occupied",
        "outputs": 1,
        "x": 180,
        "y": 540,
        "wires": [
            [
                "3269d216.98a64e"
            ]
        ]
    },
    {
        "id": "c7e9e280.455c2",
        "type": "comment",
        "z": "47267ef8.fca6f",
        "name": "Pause Media On Bed Unoccupied",
        "info": "",
        "x": 240,
        "y": 480,
        "wires": []
    },
    {
        "id": "3269d216.98a64e",
        "type": "api-call-service",
        "z": "47267ef8.fca6f",
        "name": "Pause Playback",
        "server": "144427d5.6c9f18",
        "service_domain": "media_player",
        "service": "media_pause",
        "data": "{\"entity_id\": \"media_player.master_bedroom_tv_chromecast\"}",
        "mergecontext": "",
        "x": 480,
        "y": 540,
        "wires": [
            []
        ]
    },
    {
        "id": "88f43e4a.06933",
        "type": "change",
        "z": "90be6c3f.6407",
        "name": "Select Media Player",
        "rules": [
            {
                "t": "set",
                "p": "data",
                "pt": "msg",
                "to": "{\"entity_id\":\"media_player.playroom_tv\"}",
                "tot": "json"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 640,
        "y": 560,
        "wires": [
            [
                "68119da7.eca3f4"
            ]
        ]
    },
    {
        "id": "b159a61.0c29c58",
        "type": "change",
        "z": "90be6c3f.6407",
        "name": "Select Media Player",
        "rules": [
            {
                "t": "set",
                "p": "data",
                "pt": "msg",
                "to": "{\"entity_id\":\"media_player.master_bedroom_tv_chromecast\"}",
                "tot": "json"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 640,
        "y": 420,
        "wires": [
            [
                "708d64a1.c4ee8c"
            ]
        ]
    },
    {
        "id": "58dfbc1f.ec9674",
        "type": "link in",
        "z": "90be6c3f.6407",
        "name": "Push Notification - Matt Browser",
        "links": [
            "33e0d52f.80feea",
            "495277d1.51d858",
            "51f9861c.fb07a8",
            "5e9d1b86.e677f4",
            "5ff8b930.afc738",
            "7e577921.85b078",
            "ce926406.6f9738",
            "f087f08a.0264e",
            "f2b70656.597f28",
            "fb45bc1d.a0ecb",
            "d62da390.c14cc",
            "553988c1.e16418",
            "9a1b5a6f.701c08",
            "3f1cb6f.d64444a",
            "b2243d7b.9aa5f",
            "3e1a676b.172da8"
        ],
        "x": 255,
        "y": 220,
        "wires": [
            [
                "b10cd235.4e338"
            ]
        ]
    },
    {
        "id": "7e577921.85b078",
        "type": "link out",
        "z": "30c7e5fd.18228a",
        "name": "Ecobee Away Mode Enabled",
        "links": [
            "259dc6d8.29a85a",
            "58dfbc1f.ec9674"
        ],
        "x": 1275,
        "y": 280,
        "wires": []
    },
    {
        "id": "a3ac2d3b.2c0f9",
        "type": "server-state-changed",
        "z": "38894af.7ca61b6",
        "name": "Gate Opened",
        "server": "144427d5.6c9f18",
        "version": 1,
        "entityidfilter": "gate_state",
        "entityidfiltertype": "substring",
        "outputinitially": false,
        "state_type": "str",
        "haltifstate": "on",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "outputs": 2,
        "output_only_on_state_change": true,
        "x": 130,
        "y": 360,
        "wires": [
            [
                "2c12f67c.414c5a"
            ],
            []
        ]
    },
    {
        "id": "1af46f8.fc92591",
        "type": "server-state-changed",
        "z": "38894af.7ca61b6",
        "name": "Gate Opened",
        "server": "144427d5.6c9f18",
        "version": 1,
        "entityidfilter": "gate_state",
        "entityidfiltertype": "substring",
        "outputinitially": false,
        "state_type": "str",
        "haltifstate": "on",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "outputs": 2,
        "output_only_on_state_change": false,
        "x": 350,
        "y": 580,
        "wires": [
            [
                "27fb2179.a7237e",
                "a7dd324a.6bbbc"
            ],
            []
        ]
    },
    {
        "id": "7559f0fd.8e122",
        "type": "server-state-changed",
        "z": "38894af.7ca61b6",
        "name": "Gate Closed",
        "server": "144427d5.6c9f18",
        "version": 1,
        "entityidfilter": "gate_state",
        "entityidfiltertype": "substring",
        "outputinitially": false,
        "state_type": "str",
        "haltifstate": "off",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "outputs": 2,
        "output_only_on_state_change": true,
        "x": 130,
        "y": 700,
        "wires": [
            [
                "ba818cf8.be274"
            ],
            []
        ]
    },
    {
        "id": "481e307a.623bc",
        "type": "stoptimer",
        "z": "38894af.7ca61b6",
        "duration": "1",
        "units": "Minute",
        "payloadtype": "num",
        "payloadval": "0",
        "name": "1m Timer",
        "x": 760,
        "y": 620,
        "wires": [
            [
                "3cac9dc5.f192f2",
                "53322bd0.9ade94"
            ],
            []
        ]
    },
    {
        "id": "3f6afe29.11be52",
        "type": "stoptimer",
        "z": "38894af.7ca61b6",
        "duration": "1",
        "units": "Minute",
        "payloadtype": "num",
        "payloadval": "0",
        "name": "1m Timer",
        "x": 760,
        "y": 660,
        "wires": [
            [
                "53322bd0.9ade94",
                "3cac9dc5.f192f2"
            ],
            []
        ]
    },
    {
        "id": "a19da4bf.c32108",
        "type": "switch",
        "z": "38894af.7ca61b6",
        "name": "Unlocked Doors Found",
        "property": "payload",
        "propertyType": "msg",
        "rules": [
            {
                "t": "neq",
                "v": "All doors are secure.  Good night.",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "All doors are secure.  Good night.",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 810,
        "y": 1180,
        "wires": [
            [
                "2d0655d0.300cda",
                "326c2add.6e3806",
                "ca3e8118.7264e"
            ],
            [
                "4b0d0947.978688"
            ]
        ]
    },
    {
        "id": "6049fc74.846f74",
        "type": "api-render-template",
        "z": "38894af.7ca61b6",
        "name": "Door Lock Status Message",
        "server": "144427d5.6c9f18",
        "template": "{% if is_state(\"lock.front_door\", \"locked\") and\n      is_state(\"lock.back_door\", \"locked\") and\n      is_state(\"lock.side_entry\", \"locked\") and\n      is_state(\"lock.garage_entry\", \"locked\") and\n      is_state(\"cover.garage_1\", \"closed\") and\n      is_state(\"cover.garage_2\", \"closed\") \n\n      -%}\nAll doors are secure.  Good night.\n  \n{%- else -%} \n    {% set unlockedCount = 0 %}\n  \n  {%- if not is_state(\"lock.front_door\", \"locked\") -%}\nThe front door reports a status of {{ states(\"lock.front_door\")}}.\n    {% set unlockedCount = unlockedCount + 1 %}\n  {%- endif %}\n\n\n  {%- if not is_state(\"lock.back_door\", \"locked\") -%}\nThe back door reports a status of {{ states(\"lock.back_door\")}}.    \n{% set unlockedCount = unlockedCount + 1 %}\n  {%- endif %}\n\n  {%- if not is_state(\"lock.garage_entry\", \"locked\") -%}\nThe garage door reports a status of {{ states(\"lock.garage_entry\")}}.\n  {% set unlockedCount = unlockedCount + 1 %}\n  {%- endif %}\n\n  {%- if not is_state(\"lock.side_entry\", \"locked\") -%}\nThe side door reports a status of {{states(\"lock.side_entry\")}}.    \n{% set unlockedCount = unlockedCount + 1 %}\n  {%- endif %}\n  \n    {%- if not is_state(\"cover.garage_1\", \"closed\") -%}\nThe big garage is open.\n    {% set unlockedCount = unlockedCount + 1 %}\n  {%- endif %}\n  \n    {%- if not is_state(\"cover.garage_2\", \"closed\") -%}\nThe little garage is open.\n    {% set unlockedCount = unlockedCount + 1 %}\n  {%- endif %}\n  \n  {% if unlockedCount > 1 -%}\nAttempting to secure all doors now.\n  {%- else -%}\nAttempting to secure the door now.\n  {%- endif %}\n  \n{%- endif %}",
        "resultsLocation": "payload",
        "resultsLocationType": "msg",
        "templateLocation": "template",
        "templateLocationType": "msg",
        "x": 780,
        "y": 1120,
        "wires": [
            [
                "a19da4bf.c32108",
                "2d8a718d.93454e",
                "484d95d6.b8c6cc"
            ]
        ]
    },
    {
        "id": "88fe746f.c586b8",
        "type": "function",
        "z": "38894af.7ca61b6",
        "name": "Build Notification",
        "func": "// switch (msg.topic) {\n//     case ''\n// }\n\nreturn {\n    payload: {\n        data: {\n            message: msg.payload,\n            data: {\n                \"thread-id\": 'bedtime-security-notification'\n            }\n        }\n    }\n};",
        "outputs": 1,
        "noerr": 0,
        "x": 1490,
        "y": 1160,
        "wires": [
            [
                "562a6302.2c4fac"
            ]
        ]
    },
    {
        "id": "2d0655d0.300cda",
        "type": "api-call-service",
        "z": "38894af.7ca61b6",
        "name": "Lock All Doors",
        "server": "144427d5.6c9f18",
        "service_domain": "lock",
        "service": "lock",
        "data": "{\"entity_id\":\"lock.front_door, lock.back_door, lock.garage_entry, lock.side_entry\"}",
        "mergecontext": "",
        "output_location": "payload",
        "output_location_type": "msg",
        "mustacheAltTags": false,
        "x": 1180,
        "y": 1200,
        "wires": [
            [
                "12647560.d49ceb"
            ]
        ]
    },
    {
        "id": "12647560.d49ceb",
        "type": "delay",
        "z": "38894af.7ca61b6",
        "name": "Delay",
        "pauseType": "delay",
        "timeout": "1",
        "timeoutUnits": "minutes",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "x": 1150,
        "y": 1240,
        "wires": [
            [
                "f3f50736.7dd2a8"
            ]
        ]
    },
    {
        "id": "eacd1413.2dac18",
        "type": "api-render-template",
        "z": "38894af.7ca61b6",
        "name": "Door Lock Status Message",
        "server": "144427d5.6c9f18",
        "template": "{% if is_state(\"lock.front_door\", \"locked\") and\n      is_state(\"lock.back_door\", \"locked\") and\n      is_state(\"lock.side_entry\", \"locked\") and\n      is_state(\"lock.garage_entry\", \"locked\") and\n      is_state(\"cover.garage_1\", \"closed\") and\n      is_state(\"cover.garage_2\", \"closed\")\n      -%}\n  I was able to secure all doors. Good night.\n{%- else -%} \n\n  {%- if not is_state(\"lock.front_door\", \"locked\") -%}\n    I was unable to lock the front door.\n  {%- endif %}\n\n  {%- if not is_state(\"lock.back_door\", \"locked\") -%}\n    I was unable to lock the back door.\n  {%- endif %}\n\n  {%- if not is_state(\"lock.garage_entry\", \"locked\") -%}\n    I was unable to lock the garage door.\n  {%- endif %}\n\n  {%- if not is_state(\"lock.side_entry\", \"locked\") -%}\n    I was unable to lock the side entry door.\n  {%- endif %}\n\n  {%- if not is_state(\"cover.garage_1\", \"closed\") -%}\n    I was unable to close the big garage door.\n  {%- endif %}\n  \n  {%- if not is_state(\"cover.garage_2\", \"closed\") -%}\n    I was unable to close the little garage door.\n  {%- endif %}\n  \n  \n  Please double check the door to make sure it is secure.\n  \n{%- endif %}",
        "resultsLocation": "payload",
        "resultsLocationType": "msg",
        "templateLocation": "template",
        "templateLocationType": "msg",
        "x": 1220,
        "y": 1320,
        "wires": [
            [
                "b1146ea0.db685"
            ]
        ]
    },
    {
        "id": "562a6302.2c4fac",
        "type": "link out",
        "z": "38894af.7ca61b6",
        "name": "Door Lock Status @ Sleep Mode Enabled",
        "links": [
            "259dc6d8.29a85a",
            "d88ae7ad.72c5b8"
        ],
        "x": 1415,
        "y": 1200,
        "wires": []
    },
    {
        "id": "f3f50736.7dd2a8",
        "type": "function",
        "z": "38894af.7ca61b6",
        "name": "Clear Template",
        "func": "\nreturn {};",
        "outputs": 1,
        "noerr": 0,
        "x": 1180,
        "y": 1280,
        "wires": [
            [
                "eacd1413.2dac18"
            ]
        ]
    },
    {
        "id": "8458fde1.e55c2",
        "type": "inject",
        "z": "38894af.7ca61b6",
        "name": "Test Notification",
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "sensor.north_gate_state",
        "payload": "",
        "payloadType": "date",
        "x": 740,
        "y": 460,
        "wires": [
            [
                "53322bd0.9ade94"
            ]
        ]
    },
    {
        "id": "1934d9bb.5fe796",
        "type": "server-state-changed",
        "z": "76250bd8.6dba94",
        "name": "Reset Alexa Handler Input",
        "server": "144427d5.6c9f18",
        "entityidfilter": "input_boolean.alexa_.*",
        "entityidfiltertype": "regex",
        "outputinitially": false,
        "state_type": "str",
        "haltifstate": "off",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "outputs": 2,
        "x": 190,
        "y": 140,
        "wires": [
            [
                "bfab3a97.d8afc8"
            ],
            []
        ]
    },
    {
        "id": "1acdb776.78bf49",
        "type": "api-call-service",
        "z": "76250bd8.6dba94",
        "name": "Reset Alexa Input",
        "server": "144427d5.6c9f18",
        "service_domain": "input_boolean",
        "service": "turn_off",
        "data": "",
        "mergecontext": "",
        "output_location": "payload",
        "output_location_type": "msg",
        "x": 770,
        "y": 140,
        "wires": [
            []
        ]
    },
    {
        "id": "660b5707.cac9f8",
        "type": "comment",
        "z": "76250bd8.6dba94",
        "name": "Reset Trigger for All Flows",
        "info": "Immediately turns off the boolean input from\nHome Assistant when triggered since action is\nonly taken when switched on.",
        "x": 190,
        "y": 100,
        "wires": []
    },
    {
        "id": "e18b65fc.e57fd8",
        "type": "function",
        "z": "38894af.7ca61b6",
        "name": "Door Namer",
        "func": "var doorNames = {\n    'binary_sensor.front_door_state': 'Front Door',\n    'binary_sensor.back_door_state': 'Back Door',\n    'binary_sensor.side_door_state': 'Side Door',\n    'binary_sensor.south_gate_state': 'South Gate',\n    'binary_sensor.north_gate_state': 'North Gate'\n}\n\nif(doorNames.hasOwnProperty(msg.topic)) {\n    msg.doorName = doorNames[msg.topic]\n}\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 570,
        "y": 280,
        "wires": [
            [
                "d0151dc8.e8bb"
            ]
        ]
    },
    {
        "id": "e6e01a43.bfc978",
        "type": "debug",
        "z": "2061740e.e5207c",
        "name": "All Events",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "x": 380,
        "y": 220,
        "wires": []
    },
    {
        "id": "d669aebc.62cfc",
        "type": "switch",
        "z": "2061740e.e5207c",
        "name": "",
        "property": "event_type",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "test_event",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 240,
        "y": 220,
        "wires": [
            [
                "e6e01a43.bfc978"
            ]
        ]
    },
    {
        "id": "c9f72f6.4fa52d",
        "type": "api-call-service",
        "z": "97047d3e.e8278",
        "name": "Light Service",
        "server": "144427d5.6c9f18",
        "service_domain": "",
        "service": "",
        "data": "",
        "mergecontext": "",
        "x": 1930,
        "y": 280,
        "wires": [
            []
        ]
    },
    {
        "id": "9bb5757.d056d88",
        "type": "function",
        "z": "97047d3e.e8278",
        "name": "Build Service Payload",
        "func": "var service = msg.payload == 'ON' ? 'turn_on' : 'turn_off';\n\nvar domain = msg.topic.split('.')[0];\n\nreturn { \n        payload:{\n            domain: domain,\n            service: service,\n            data: {\n                entity_id: msg.topic\n            }\n        }\n    };",
        "outputs": 1,
        "noerr": 0,
        "x": 1000,
        "y": 240,
        "wires": [
            [
                "e4410f0c.79f2f"
            ]
        ]
    },
    {
        "id": "88870d79.b0355",
        "type": "inject",
        "z": "97047d3e.e8278",
        "name": "On",
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "on",
        "payloadType": "str",
        "x": 390,
        "y": 180,
        "wires": [
            [
                "3d25b766.82cee8",
                "458a451b.4b1efc",
                "e37dd587.8c1ba8",
                "dbefdafa.3f9cf8",
                "38d09349.53b57c"
            ]
        ]
    },
    {
        "id": "ffbdb800.cbb2b8",
        "type": "inject",
        "z": "97047d3e.e8278",
        "name": "Off",
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "off",
        "payloadType": "str",
        "x": 390,
        "y": 220,
        "wires": [
            [
                "3d25b766.82cee8",
                "458a451b.4b1efc",
                "e37dd587.8c1ba8",
                "dbefdafa.3f9cf8",
                "38d09349.53b57c"
            ]
        ]
    },
    {
        "id": "b3976b49.6c3848",
        "type": "inject",
        "z": "97047d3e.e8278",
        "name": "Auto",
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "auto",
        "payloadType": "str",
        "x": 390,
        "y": 260,
        "wires": [
            [
                "3d25b766.82cee8",
                "458a451b.4b1efc",
                "e37dd587.8c1ba8",
                "dbefdafa.3f9cf8",
                "38d09349.53b57c"
            ]
        ]
    },
    {
        "id": "5943794e.0d5bf8",
        "type": "inject",
        "z": "97047d3e.e8278",
        "name": "Stop",
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": "0.5",
        "topic": "",
        "payload": "stop",
        "payloadType": "str",
        "x": 390,
        "y": 300,
        "wires": [
            [
                "3d25b766.82cee8",
                "458a451b.4b1efc",
                "e37dd587.8c1ba8",
                "dbefdafa.3f9cf8",
                "38d09349.53b57c"
            ]
        ]
    },
    {
        "id": "b78e0fc9.3e897",
        "type": "api-current-state",
        "z": "97047d3e.e8278",
        "name": "Is Extended Away",
        "server": "144427d5.6c9f18",
        "version": 1,
        "outputs": 2,
        "halt_if": "on",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "override_topic": false,
        "entity_id": "input_boolean.extended_away_mode",
        "state_type": "str",
        "state_location": "",
        "override_payload": "none",
        "entity_location": "",
        "override_data": "none",
        "blockInputOverrides": false,
        "x": 1450,
        "y": 280,
        "wires": [
            [
                "f6fe513a.1dd42",
                "5014d01f.3a489"
            ],
            []
        ],
        "icon": "node-red/alert.png"
    },
    {
        "id": "c7403459.3e5a18",
        "type": "comment",
        "z": "cb6f2b8f.2124b8",
        "name": "Extended Away Mode",
        "info": "",
        "x": 140,
        "y": 1060,
        "wires": []
    },
    {
        "id": "96c5b3f6.7f2d9",
        "type": "mqtt in",
        "z": "cb6f2b8f.2124b8",
        "name": "Owntracks Location Update",
        "topic": "owntracks/+/iphone",
        "qos": "2",
        "datatype": "json",
        "broker": "1f84a57d.10775b",
        "x": 160,
        "y": 1100,
        "wires": [
            [
                "6b7cfac6.419554"
            ]
        ]
    },
    {
        "id": "fb45bc1d.a0ecb",
        "type": "link out",
        "z": "cb6f2b8f.2124b8",
        "name": "Extended Away Mode Enabled",
        "links": [
            "259dc6d8.29a85a",
            "58dfbc1f.ec9674"
        ],
        "x": 1395,
        "y": 1160,
        "wires": []
    },
    {
        "id": "7a4afce1.eceb54",
        "type": "function",
        "z": "cb6f2b8f.2124b8",
        "name": "Build Notification",
        "func": "if (msg.topic == 'enable_extended_away') {\n    msg = {\n        payload: {\n            data: {\n                title: \"Extended Away Mode Active\",\n                message: \"Enjoy your trip!\"\n            }\n        }\n    }\n}\n\nif (msg.topic == 'disable_extended_away') {\n        msg = {\n        payload: {\n            data: {\n                title: \"Extended Away Mode Disabled\",\n                message: \"Welcome Back!\"\n            }\n        }\n    }\n}\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 1250,
        "y": 1160,
        "wires": [
            [
                "fb45bc1d.a0ecb"
            ]
        ]
    },
    {
        "id": "6b7cfac6.419554",
        "type": "delay",
        "z": "cb6f2b8f.2124b8",
        "name": "Startup Delay",
        "pauseType": "delay",
        "timeout": "5",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "x": 400,
        "y": 1100,
        "wires": [
            [
                "348d34cd.5a22cc"
            ]
        ]
    },
    {
        "id": "ad4b446b.4c9a48",
        "type": "api-call-service",
        "z": "cb6f2b8f.2124b8",
        "name": "Disable Extended Away",
        "server": "144427d5.6c9f18",
        "service_domain": "input_boolean",
        "service": "turn_off",
        "data": "{\"entity_id\": \"input_boolean.extended_away_mode\"}",
        "mergecontext": "",
        "x": 1270,
        "y": 1220,
        "wires": [
            []
        ]
    },
    {
        "id": "b70c233a.4f3e1",
        "type": "server-state-changed",
        "z": "30c7e5fd.18228a",
        "name": "Extended Away Disabled",
        "server": "144427d5.6c9f18",
        "entityidfilter": "input_boolean.extended_away_mode",
        "entityidfiltertype": "exact",
        "haltifstate": "on",
        "outputs": 1,
        "x": 190,
        "y": 260,
        "wires": [
            [
                "e70c9ec7.f71ee"
            ]
        ]
    },
    {
        "id": "7f050cdc.10b3d4",
        "type": "api-call-service",
        "z": "cb6f2b8f.2124b8",
        "name": "Enable Extended Away",
        "server": "144427d5.6c9f18",
        "service_domain": "input_boolean",
        "service": "turn_on",
        "data": "{\"entity_id\":\"input_boolean.extended_away_mode\"}",
        "mergecontext": "",
        "output_location": "payload",
        "output_location_type": "msg",
        "x": 1270,
        "y": 1100,
        "wires": [
            []
        ]
    },
    {
        "id": "f6fe513a.1dd42",
        "type": "debug",
        "z": "97047d3e.e8278",
        "name": "Light Service Debug",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "x": 1760,
        "y": 340,
        "wires": []
    },
    {
        "id": "e4410f0c.79f2f",
        "type": "delay",
        "z": "97047d3e.e8278",
        "name": "Startup Delay",
        "pauseType": "delay",
        "timeout": "5",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "x": 1020,
        "y": 280,
        "wires": [
            [
                "3c1e70cc.56031"
            ]
        ]
    },
    {
        "id": "749067ba.5fbb88",
        "type": "api-current-state",
        "z": "cb6f2b8f.2124b8",
        "name": "Extended Away Enabled?",
        "server": "144427d5.6c9f18",
        "version": 1,
        "outputs": 2,
        "halt_if": "on",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "override_topic": true,
        "entity_id": "input_boolean.extended_away_mode",
        "state_type": "str",
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "blockInputOverrides": false,
        "x": 950,
        "y": 1120,
        "wires": [
            [],
            [
                "7f050cdc.10b3d4",
                "7a4afce1.eceb54"
            ]
        ]
    },
    {
        "id": "3c1e70cc.56031",
        "type": "delay",
        "z": "97047d3e.e8278",
        "name": "Randomize",
        "pauseType": "random",
        "timeout": "5",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "300",
        "randomUnits": "seconds",
        "drop": false,
        "x": 1230,
        "y": 280,
        "wires": [
            [
                "b78e0fc9.3e897"
            ]
        ]
    },
    {
        "id": "5623456b.fc134c",
        "type": "switch",
        "z": "97047d3e.e8278",
        "name": "Discard Strings",
        "property": "payload",
        "propertyType": "msg",
        "rules": [
            {
                "t": "istype",
                "v": "object",
                "vt": "object"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 1740,
        "y": 280,
        "wires": [
            [
                "c9f72f6.4fa52d"
            ]
        ]
    },
    {
        "id": "a8bd851.da78978",
        "type": "inject",
        "z": "30c7e5fd.18228a",
        "name": "Set Ecobee Home",
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 210,
        "y": 320,
        "wires": [
            [
                "e70c9ec7.f71ee"
            ]
        ]
    },
    {
        "id": "73975859.0d2928",
        "type": "inject",
        "z": "30c7e5fd.18228a",
        "name": "Set Ecobee Away",
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 620,
        "y": 80,
        "wires": [
            [
                "d15821ae.44ebd"
            ]
        ]
    },
    {
        "id": "74d488ef.7de0a8",
        "type": "server-state-changed",
        "z": "30c7e5fd.18228a",
        "name": "Sleep Mode",
        "server": "144427d5.6c9f18",
        "version": 1,
        "entityidfilter": "input_boolean.sleep_mode",
        "entityidfiltertype": "substring",
        "outputinitially": false,
        "state_type": "str",
        "haltifstate": "on",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "outputs": 2,
        "output_only_on_state_change": false,
        "x": 150,
        "y": 500,
        "wires": [
            [
                "4e29dc95.9fd824",
                "885ed3b9.3f301",
                "d4ff4793.7e2c58",
                "9483a989.c99918"
            ],
            [
                "69ac16b4.bbc3e8"
            ]
        ]
    },
    {
        "id": "3ba27f68.c873b",
        "type": "api-call-service",
        "z": "30c7e5fd.18228a",
        "name": "Sound Machine Off",
        "server": "144427d5.6c9f18",
        "service_domain": "media_player",
        "service": "media_pause",
        "data": "{\"entity_id\":\"media_player.master_bedroom_sonos\"}",
        "mergecontext": "",
        "output_location": "payload",
        "output_location_type": "msg",
        "x": 850,
        "y": 460,
        "wires": [
            []
        ]
    },
    {
        "id": "30a44dd0.162a22",
        "type": "inject",
        "z": "38894af.7ca61b6",
        "name": "Reset Timers",
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "STOP",
        "payloadType": "str",
        "x": 430,
        "y": 460,
        "wires": [
            [
                "48e55600.7e731c"
            ]
        ]
    },
    {
        "id": "5895b4f4.b78d0c",
        "type": "comment",
        "z": "30c7e5fd.18228a",
        "name": "Fan On When Bed Occupied",
        "info": "",
        "x": 200,
        "y": 1060,
        "wires": []
    },
    {
        "id": "60d5968.d518768",
        "type": "server-state-changed",
        "z": "30c7e5fd.18228a",
        "name": "Bed Occupied",
        "server": "144427d5.6c9f18",
        "version": 1,
        "entityidfilter": "sensor.bed_either",
        "entityidfiltertype": "exact",
        "outputinitially": false,
        "state_type": "str",
        "haltifstate": "Occupied",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "outputs": 2,
        "output_only_on_state_change": false,
        "x": 150,
        "y": 1140,
        "wires": [
            [
                "7e3eb6e2.67bc48"
            ],
            [
                "4553441c.310eac"
            ]
        ]
    },
    {
        "id": "d14e27bc.f3c458",
        "type": "api-call-service",
        "z": "30c7e5fd.18228a",
        "name": "Fan On",
        "server": "144427d5.6c9f18",
        "service_domain": "fan",
        "service": "set_speed",
        "data": "",
        "mergecontext": "",
        "x": 1200,
        "y": 660,
        "wires": [
            []
        ]
    },
    {
        "id": "4553441c.310eac",
        "type": "api-call-service",
        "z": "30c7e5fd.18228a",
        "name": "Fan Off",
        "server": "144427d5.6c9f18",
        "service_domain": "fan",
        "service": "turn_off",
        "data": "{\"entity_id\": \"fan.master_bedroom_fan_level\"}",
        "mergecontext": "",
        "x": 400,
        "y": 1220,
        "wires": [
            []
        ]
    },
    {
        "id": "e91c738b.34686",
        "type": "time-range-switch",
        "z": "30c7e5fd.18228a",
        "name": "Is Bedtime?",
        "lat": "",
        "lon": "",
        "startTime": "22:00",
        "endTime": "7:00",
        "startOffset": 0,
        "endOffset": 0,
        "x": 530,
        "y": 1180,
        "wires": [
            [],
            [
                "e9325a4e.aa71a8"
            ]
        ]
    },
    {
        "id": "40a0cc5d.c330d4",
        "type": "function",
        "z": "30c7e5fd.18228a",
        "name": "Bedtime Settings",
        "func": "msg.payload = {\n    data: {\n        entity_id: \"fan.master_bedroom_fan_level\", \n        speed: msg.payload\n    }\n}\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 970,
        "y": 660,
        "wires": [
            [
                "d14e27bc.f3c458"
            ]
        ]
    },
    {
        "id": "e9325a4e.aa71a8",
        "type": "function",
        "z": "30c7e5fd.18228a",
        "name": "Other Settings",
        "func": "msg.payload = {\n    data: {\n        entity_id: \"fan.master_bedroom_fan_level\", \n        speed:\"medium\"\n    }\n}\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 740,
        "y": 1140,
        "wires": [
            [
                "20b94728.74eb88"
            ]
        ]
    },
    {
        "id": "5c2ae9a4.780d58",
        "type": "inject",
        "z": "30c7e5fd.18228a",
        "name": "",
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "Occupied",
        "payloadType": "str",
        "x": 160,
        "y": 1100,
        "wires": [
            [
                "7e3eb6e2.67bc48"
            ]
        ]
    },
    {
        "id": "26d30629.9b476a",
        "type": "server-state-changed",
        "z": "eee3c0c3.7c7bd",
        "name": "Light Turned On",
        "server": "144427d5.6c9f18",
        "entityidfilter": "light.",
        "entityidfiltertype": "substring",
        "outputinitially": false,
        "state_type": "str",
        "haltifstate": "off",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "outputs": 2,
        "output_only_on_state_change": true,
        "x": 160,
        "y": 1320,
        "wires": [
            [
                "936ba4b4.ddcab8",
                "6ea9c5cc.e2cb3c"
            ],
            []
        ]
    },
    {
        "id": "d8e83fcc.412d9",
        "type": "api-call-service",
        "z": "eee3c0c3.7c7bd",
        "name": "On",
        "server": "144427d5.6c9f18",
        "service_domain": "light",
        "service": "turn_on",
        "data": "",
        "mergecontext": "",
        "x": 1010,
        "y": 1320,
        "wires": [
            [
                "c5863dd6.8bd9f"
            ]
        ]
    },
    {
        "id": "63cca837.6b1d58",
        "type": "function",
        "z": "eee3c0c3.7c7bd",
        "name": "Adjust Level Payload",
        "func": "var lightLevel = flow.get(\"light_level_pct\");\n\n// set special level if provided\n// caller is responsible for resetting levels\nif(msg.special_level) {\n    flow.set(\"light_level_custom_\" + msg.topic, msg.special_level)\n} else {    \n    flow.set(\"light_level_custom_\" + msg.topic, undefined)\n}\n\nvar specialLevel = flow.get(\"light_level_custom_\" + msg.topic)\n\nif (specialLevel) {\n    lightLevel = specialLevel;\n}\n\nmsg = {\n    payload: {\n        entity_id: msg.topic,\n        data: {\n            brightness_pct: lightLevel,\n            entity_id: msg.topic,\n        }\n    }\n}\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 780,
        "y": 1320,
        "wires": [
            [
                "36a017f0.bede88",
                "d8e83fcc.412d9"
            ]
        ]
    },
    {
        "id": "20c451c1.48de3e",
        "type": "function",
        "z": "eee3c0c3.7c7bd",
        "name": "Set Light Level",
        "func": "flow.set(\"light_level_pct\", msg.payload);",
        "outputs": 1,
        "noerr": 0,
        "x": 460,
        "y": 1400,
        "wires": [
            []
        ]
    },
    {
        "id": "25e1a545.413dea",
        "type": "comment",
        "z": "eee3c0c3.7c7bd",
        "name": "Time Based Light Dimming",
        "info": "",
        "x": 190,
        "y": 1280,
        "wires": []
    },
    {
        "id": "5adca2d9.cd9d7c",
        "type": "split",
        "z": "eee3c0c3.7c7bd",
        "name": "Split",
        "splt": "\\n",
        "spltType": "str",
        "arraySplt": 1,
        "arraySpltType": "len",
        "stream": false,
        "addname": "",
        "x": 550,
        "y": 1540,
        "wires": [
            [
                "31d0ed0a.d06a62"
            ]
        ]
    },
    {
        "id": "31d0ed0a.d06a62",
        "type": "change",
        "z": "eee3c0c3.7c7bd",
        "name": "Set Topic",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 580,
        "y": 1580,
        "wires": [
            [
                "56eee06.99a9b2"
            ]
        ]
    },
    {
        "id": "49f64c2c.a64644",
        "type": "inject",
        "z": "eee3c0c3.7c7bd",
        "name": "",
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "30",
        "payloadType": "num",
        "x": 230,
        "y": 1380,
        "wires": [
            [
                "20c451c1.48de3e"
            ]
        ]
    },
    {
        "id": "4324fda6.94b894",
        "type": "mqtt out",
        "z": "8d45d5f6.f088e8",
        "name": "Tree Pattern Adjust",
        "topic": "led/tree/patternAdjust",
        "qos": "0",
        "retain": "",
        "broker": "1f84a57d.10775b",
        "x": 792,
        "y": 180,
        "wires": []
    },
    {
        "id": "c1699215.193ce",
        "type": "inject",
        "z": "8d45d5f6.f088e8",
        "name": "Adjust Tree Pattern",
        "repeat": "120",
        "crontab": "",
        "once": true,
        "onceDelay": "1",
        "topic": "",
        "payload": "1",
        "payloadType": "str",
        "x": 240,
        "y": 180,
        "wires": [
            [
                "8de38213.0e005"
            ]
        ]
    },
    {
        "id": "9f204fef.d5081",
        "type": "inject",
        "z": "eee3c0c3.7c7bd",
        "name": "",
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "100",
        "payloadType": "num",
        "x": 230,
        "y": 1420,
        "wires": [
            [
                "20c451c1.48de3e"
            ]
        ]
    },
    {
        "id": "20829d14.a77f42",
        "type": "api-call-service",
        "z": "76250bd8.6dba94",
        "name": "Turn On TV",
        "server": "144427d5.6c9f18",
        "service_domain": "media_player",
        "service": "turn_on",
        "data": "{\"entity_id\": \"media_player.playroom_tv\"}",
        "mergecontext": "",
        "x": 450,
        "y": 300,
        "wires": [
            []
        ]
    },
    {
        "id": "1dd1e412.a1570c",
        "type": "api-call-service",
        "z": "76250bd8.6dba94",
        "name": "Set TV to 11-2",
        "server": "144427d5.6c9f18",
        "service_domain": "media_player",
        "service": "play_media",
        "data": "{\"entity_id\": \"media_player.playroom_tv\", \"media_content_id\": \"11-2\", \"media_content_type\": \"channel\"}",
        "mergecontext": "",
        "x": 700,
        "y": 340,
        "wires": [
            []
        ]
    },
    {
        "id": "1a2a73d0.b6f47c",
        "type": "delay",
        "z": "76250bd8.6dba94",
        "name": "Delay 5s",
        "pauseType": "delay",
        "timeout": "5",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "x": 440,
        "y": 340,
        "wires": [
            [
                "1dd1e412.a1570c"
            ]
        ]
    },
    {
        "id": "18d627a7.c24208",
        "type": "inject",
        "z": "38894af.7ca61b6",
        "name": "",
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 180,
        "y": 1160,
        "wires": [
            [
                "928ecd6a.39312"
            ]
        ]
    },
    {
        "id": "6cecb33a.c2a5dc",
        "type": "api-current-state",
        "z": "30c7e5fd.18228a",
        "name": "Bed Is Occupied",
        "server": "144427d5.6c9f18",
        "version": 1,
        "outputs": 2,
        "halt_if": "off",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "override_topic": false,
        "entity_id": "sensor.bed_either",
        "state_type": "str",
        "state_location": "",
        "override_payload": "none",
        "entity_location": "data",
        "override_data": "msg",
        "blockInputOverrides": false,
        "x": 710,
        "y": 640,
        "wires": [
            [],
            [
                "95020313.f0aff"
            ]
        ]
    },
    {
        "id": "7e3eb6e2.67bc48",
        "type": "api-current-state",
        "z": "30c7e5fd.18228a",
        "name": "Flag - Fan on when bed occupied",
        "server": "144427d5.6c9f18",
        "version": 1,
        "outputs": 2,
        "halt_if": "on",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "override_topic": false,
        "entity_id": "input_boolean.flag_fan_on_when_bed_occupied",
        "state_type": "str",
        "state_location": "",
        "override_payload": "none",
        "entity_location": "data",
        "override_data": "msg",
        "blockInputOverrides": false,
        "x": 480,
        "y": 1120,
        "wires": [
            [
                "e91c738b.34686"
            ],
            []
        ]
    },
    {
        "id": "885ed3b9.3f301",
        "type": "api-current-state",
        "z": "30c7e5fd.18228a",
        "name": "Flag Check",
        "server": "144427d5.6c9f18",
        "version": 1,
        "outputs": 2,
        "halt_if": "on",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "override_topic": false,
        "entity_id": "input_boolean.flag_fan_on_at_bedtime",
        "state_type": "str",
        "state_location": "",
        "override_payload": "none",
        "entity_location": "data",
        "override_data": "msg",
        "blockInputOverrides": false,
        "x": 410,
        "y": 640,
        "wires": [
            [
                "6cecb33a.c2a5dc"
            ],
            []
        ]
    },
    {
        "id": "95020313.f0aff",
        "type": "api-current-state",
        "z": "30c7e5fd.18228a",
        "name": "Get Fan Speed",
        "server": "144427d5.6c9f18",
        "version": 0,
        "outputs": 1,
        "halt_if": "",
        "override_topic": false,
        "entity_id": "input_select.option_fan_speed_at_bedtime",
        "override_payload": true,
        "x": 700,
        "y": 680,
        "wires": [
            [
                "40a0cc5d.c330d4"
            ]
        ]
    },
    {
        "id": "ab9ab807.c3ad58",
        "type": "delay",
        "z": "b55ab74c.698a88",
        "name": "5m Delay",
        "pauseType": "delay",
        "timeout": "5",
        "timeoutUnits": "minutes",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "x": 660,
        "y": 940,
        "wires": [
            [
                "30eb3225.e29e7e"
            ]
        ]
    },
    {
        "id": "fe960e6c.e95d8",
        "type": "delay",
        "z": "b55ab74c.698a88",
        "name": "10m Delay",
        "pauseType": "delay",
        "timeout": "10",
        "timeoutUnits": "minutes",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "x": 670,
        "y": 980,
        "wires": [
            [
                "f75716cd.511c08"
            ]
        ]
    },
    {
        "id": "7cb1a4dc.28bdcc",
        "type": "delay",
        "z": "b55ab74c.698a88",
        "name": "15m Delay",
        "pauseType": "delay",
        "timeout": "15",
        "timeoutUnits": "minutes",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "x": 670,
        "y": 1020,
        "wires": [
            [
                "a20fcb6f.79b368",
                "78a2b17d.a78e"
            ]
        ]
    },
    {
        "id": "30eb3225.e29e7e",
        "type": "change",
        "z": "b55ab74c.698a88",
        "name": "10 Minute Message",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "10 minutes",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 850,
        "y": 940,
        "wires": [
            [
                "4254c077.173be"
            ]
        ]
    },
    {
        "id": "3bc02f96.228c4",
        "type": "change",
        "z": "b55ab74c.698a88",
        "name": "15 Minute Message",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "15 minutes",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 850,
        "y": 900,
        "wires": [
            [
                "4254c077.173be"
            ]
        ]
    },
    {
        "id": "f75716cd.511c08",
        "type": "change",
        "z": "b55ab74c.698a88",
        "name": "5 Minute Message",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "5 minutes",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 850,
        "y": 980,
        "wires": [
            [
                "4254c077.173be"
            ]
        ]
    },
    {
        "id": "71ef9f7.ac8386",
        "type": "function",
        "z": "b55ab74c.698a88",
        "name": "Set Bedtime Event Status",
        "func": "flow.set('bedtime_event_fired', true);\n",
        "outputs": 1,
        "noerr": 0,
        "x": 710,
        "y": 860,
        "wires": [
            []
        ]
    },
    {
        "id": "c69c9e5a.02ca1",
        "type": "switch",
        "z": "b55ab74c.698a88",
        "name": "Halt If Already Fired",
        "property": "bedtime_event_fired",
        "propertyType": "flow",
        "rules": [
            {
                "t": "false"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 430,
        "y": 900,
        "wires": [
            [
                "3bc02f96.228c4",
                "71ef9f7.ac8386",
                "ab9ab807.c3ad58",
                "fe960e6c.e95d8",
                "7cb1a4dc.28bdcc"
            ]
        ]
    },
    {
        "id": "2d1abd58.41aef2",
        "type": "comment",
        "z": "47267ef8.fca6f",
        "name": "Master Bedroom Lights Off On Media Start",
        "info": "",
        "x": 260,
        "y": 300,
        "wires": []
    },
    {
        "id": "5dd403a2.c90a5c",
        "type": "server-state-changed",
        "z": "47267ef8.fca6f",
        "name": "Master Bedroom Media State",
        "server": "144427d5.6c9f18",
        "entityidfilter": "media_player.master_bedroom_tv_chromecast",
        "entityidfiltertype": "exact",
        "haltifstate": "",
        "outputs": 1,
        "x": 220,
        "y": 360,
        "wires": [
            [
                "716735dc.665acc"
            ]
        ]
    },
    {
        "id": "716735dc.665acc",
        "type": "switch",
        "z": "47267ef8.fca6f",
        "name": "State Router",
        "property": "payload",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "playing",
                "vt": "str"
            }
        ],
        "checkall": "false",
        "repair": false,
        "outputs": 1,
        "x": 500,
        "y": 360,
        "wires": [
            [
                "9a965b9f.858768"
            ]
        ]
    },
    {
        "id": "8002ffa.6b70b",
        "type": "api-call-service",
        "z": "47267ef8.fca6f",
        "name": "Turn Off Lights",
        "server": "144427d5.6c9f18",
        "service_domain": "switch",
        "service": "turn_off",
        "data": "{\"entity_id\": \"switch.master_bedroom_light\"}",
        "mergecontext": "",
        "x": 960,
        "y": 360,
        "wires": [
            []
        ]
    },
    {
        "id": "9a965b9f.858768",
        "type": "api-current-state",
        "z": "47267ef8.fca6f",
        "name": "Halt If Lights Off",
        "server": "144427d5.6c9f18",
        "outputs": 1,
        "halt_if": "off",
        "override_topic": false,
        "entity_id": "switch.master_bedroom_light",
        "override_payload": false,
        "x": 720,
        "y": 360,
        "wires": [
            [
                "8002ffa.6b70b"
            ]
        ]
    },
    {
        "id": "2c205a59.383456",
        "type": "server-state-changed",
        "z": "47267ef8.fca6f",
        "name": "Living Room TV Media State",
        "server": "144427d5.6c9f18",
        "entityidfilter": "media_player.living_room_tv",
        "entityidfiltertype": "exact",
        "outputinitially": false,
        "state_type": "str",
        "haltifstate": "off",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "outputs": 2,
        "output_only_on_state_change": true,
        "x": 200,
        "y": 760,
        "wires": [
            [
                "99c8323a.d9ff5"
            ],
            []
        ]
    },
    {
        "id": "99c8323a.d9ff5",
        "type": "switch",
        "z": "47267ef8.fca6f",
        "name": "isPlaying",
        "property": "payload",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "playing",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 440,
        "y": 720,
        "wires": [
            [
                "96968b6c.c92238",
                "d218f7cf.2f4b58",
                "dace7edc.697a6"
            ],
            [
                "bdb8c7a9.ead018"
            ]
        ]
    },
    {
        "id": "270fc0f.47a3d4",
        "type": "comment",
        "z": "47267ef8.fca6f",
        "name": "Living Room Lights Off On Media Start",
        "info": "",
        "x": 230,
        "y": 620,
        "wires": []
    },
    {
        "id": "64957100.edc8d",
        "type": "api-call-service",
        "z": "8d45d5f6.f088e8",
        "name": "Inside Lights Off",
        "server": "144427d5.6c9f18",
        "service_domain": "homeassistant",
        "service": "turn_off",
        "data": "{\"entity_id\": \"group.christmas_lights_inside\"}",
        "mergecontext": "",
        "x": 680,
        "y": 340,
        "wires": [
            []
        ]
    },
    {
        "id": "82641421.0af868",
        "type": "server-state-changed",
        "z": "8d45d5f6.f088e8",
        "name": "Sleep Mode Active",
        "server": "144427d5.6c9f18",
        "version": "1",
        "entityidfilter": "input_boolean.sleep_mode",
        "entityidfiltertype": "exact",
        "outputinitially": false,
        "state_type": "str",
        "haltifstate": "On",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "outputs": 2,
        "output_only_on_state_change": true,
        "x": 230,
        "y": 340,
        "wires": [
            [],
            []
        ]
    },
    {
        "id": "769d043d.7bd40c",
        "type": "comment",
        "z": "8d45d5f6.f088e8",
        "name": "Inside Lights Off @ Bedtime",
        "info": "",
        "x": 240,
        "y": 300,
        "wires": []
    },
    {
        "id": "153fa906.7b84f7",
        "type": "api-call-service",
        "z": "8d45d5f6.f088e8",
        "name": "Inside Lights On",
        "server": "144427d5.6c9f18",
        "service_domain": "homeassistant",
        "service": "turn_on",
        "data": "{\"entity_id\": \"group.christmas_lights_inside\"}",
        "mergecontext": "",
        "x": 680,
        "y": 560,
        "wires": [
            []
        ]
    },
    {
        "id": "105c4f83.2110f",
        "type": "api-current-state",
        "z": "8d45d5f6.f088e8",
        "name": "Block If Sleep Mode Active",
        "server": "144427d5.6c9f18",
        "version": "1",
        "outputs": 2,
        "halt_if": "On",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "override_topic": false,
        "entity_id": "input_boolean.sleep_mode",
        "state_type": "str",
        "state_location": "",
        "override_payload": "none",
        "entity_location": "",
        "override_data": "none",
        "blockInputOverrides": false,
        "x": 720,
        "y": 460,
        "wires": [
            [],
            [
                "b4813311.239c"
            ]
        ]
    },
    {
        "id": "b4813311.239c",
        "type": "api-current-state",
        "z": "8d45d5f6.f088e8",
        "name": "Block If Already On",
        "server": "144427d5.6c9f18",
        "version": "1",
        "outputs": 2,
        "halt_if": "On",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "override_topic": false,
        "entity_id": "group.christmas_lights_inside",
        "state_type": "str",
        "state_location": "",
        "override_payload": "none",
        "entity_location": "data",
        "override_data": "msg",
        "blockInputOverrides": false,
        "x": 690,
        "y": 500,
        "wires": [
            [],
            [
                "153fa906.7b84f7"
            ]
        ]
    },
    {
        "id": "d7669edc.b8c1",
        "type": "link in",
        "z": "90be6c3f.6407",
        "name": "WebOS - Living Room TV",
        "links": [
            "5e9d1b86.e677f4",
            "5ff8b930.afc738",
            "f087f08a.0264e",
            "f2b70656.597f28",
            "fd535219.99971",
            "3f1cb6f.d64444a",
            "d920bf48.d8d85"
        ],
        "x": 255,
        "y": 140,
        "wires": [
            [
                "c6ac8d87.65e44"
            ]
        ]
    },
    {
        "id": "c6ac8d87.65e44",
        "type": "api-call-service",
        "z": "90be6c3f.6407",
        "name": "WebOS - Living Room TV",
        "server": "144427d5.6c9f18",
        "service_domain": "notify",
        "service": "living_room_tv",
        "data": "",
        "mergecontext": "",
        "x": 650,
        "y": 140,
        "wires": [
            []
        ]
    },
    {
        "id": "a406c663.ab0a6",
        "type": "switch",
        "z": "8d45d5f6.f088e8",
        "name": "On/Off",
        "property": "payload",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "OFF",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "ON",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 450,
        "y": 420,
        "wires": [
            [
                "64957100.edc8d"
            ],
            [
                "36fcddbc.c37e82",
                "f4316c4e.01975"
            ]
        ]
    },
    {
        "id": "1ff179d8.17ba36",
        "type": "comment",
        "z": "8d45d5f6.f088e8",
        "name": "Inside Lights Schedule",
        "info": "",
        "x": 220,
        "y": 420,
        "wires": []
    },
    {
        "id": "dbbd116e.e5a03",
        "type": "link in",
        "z": "eee3c0c3.7c7bd",
        "name": "Adjust Light Level",
        "links": [
            "2e6b817.ba2c47e",
            "5e7b562d.80c438"
        ],
        "x": 615,
        "y": 1260,
        "wires": [
            [
                "63cca837.6b1d58"
            ]
        ]
    },
    {
        "id": "2e6b817.ba2c47e",
        "type": "link out",
        "z": "47267ef8.fca6f",
        "name": "Media Lighting - Living Room",
        "links": [
            "dbbd116e.e5a03"
        ],
        "x": 1415,
        "y": 780,
        "wires": []
    },
    {
        "id": "d218f7cf.2f4b58",
        "type": "change",
        "z": "47267ef8.fca6f",
        "name": "Playing Level",
        "rules": [
            {
                "t": "set",
                "p": "special_level",
                "pt": "msg",
                "to": "15",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 750,
        "y": 720,
        "wires": [
            [
                "a8a5edff.97d4"
            ]
        ]
    },
    {
        "id": "5e762d2e.e2a404",
        "type": "inject",
        "z": "47267ef8.fca6f",
        "name": "",
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "playing",
        "payloadType": "str",
        "x": 270,
        "y": 680,
        "wires": [
            [
                "99c8323a.d9ff5"
            ]
        ]
    },
    {
        "id": "2a4edf13.498f1",
        "type": "api-call-service",
        "z": "47267ef8.fca6f",
        "name": "Kitchen Pendants Off",
        "server": "144427d5.6c9f18",
        "service_domain": "switch",
        "service": "turn_off",
        "data": "{\"entity_id\":\"switch.kitchen_pendant_lights\"}",
        "mergecontext": "",
        "x": 1000,
        "y": 660,
        "wires": [
            []
        ]
    },
    {
        "id": "5e7b562d.80c438",
        "type": "link out",
        "z": "eee3c0c3.7c7bd",
        "name": "Kitchen Motion Light Adjustment",
        "links": [
            "dbbd116e.e5a03"
        ],
        "x": 1035,
        "y": 296,
        "wires": []
    },
    {
        "id": "fd97ed5c.f14d3",
        "type": "api-current-state",
        "z": "eee3c0c3.7c7bd",
        "name": "Halt If Away",
        "server": "144427d5.6c9f18",
        "version": 1,
        "outputs": 2,
        "halt_if": "on",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "override_topic": false,
        "entity_id": "input_boolean.away_mode",
        "state_type": "str",
        "state_location": "",
        "override_payload": "none",
        "entity_location": "",
        "override_data": "none",
        "blockInputOverrides": false,
        "x": 410,
        "y": 300,
        "wires": [
            [],
            [
                "ec156ffc.6dcf4"
            ]
        ]
    },
    {
        "id": "2901960a.c8dc3a",
        "type": "switch",
        "z": "eee3c0c3.7c7bd",
        "name": "On/Off",
        "property": "payload",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "on",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "off",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 870,
        "y": 300,
        "wires": [
            [
                "5e7b562d.80c438"
            ],
            [
                "c174ca76.fe5338",
                "c5f55684.5b1fd8"
            ]
        ]
    },
    {
        "id": "40d1d2bf.0f110c",
        "type": "delay",
        "z": "eee3c0c3.7c7bd",
        "name": "Deploy Delay",
        "pauseType": "delay",
        "timeout": "5",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "x": 210,
        "y": 1540,
        "wires": [
            [
                "b2330fbe.bec08"
            ]
        ]
    },
    {
        "id": "b2330fbe.bec08",
        "type": "api-render-template",
        "z": "eee3c0c3.7c7bd",
        "name": "List On Lights",
        "server": "144427d5.6c9f18",
        "template": "{% for state in states.light -%}\n{% if state.state == 'on' %}\n{{ state.entity_id }}{% endif -%}\n{% endfor %}\n\n",
        "x": 520,
        "y": 1500,
        "wires": [
            [
                "5adca2d9.cd9d7c"
            ]
        ]
    },
    {
        "id": "b171b1d3.a7c75",
        "type": "inject",
        "z": "eee3c0c3.7c7bd",
        "name": "Off",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "off",
        "payloadType": "str",
        "x": 390,
        "y": 240,
        "wires": [
            [
                "fd97ed5c.f14d3"
            ]
        ]
    },
    {
        "id": "49700d5f.faa384",
        "type": "inject",
        "z": "eee3c0c3.7c7bd",
        "name": "On",
        "props": [
            {
                "p": "payload",
                "v": "on",
                "vt": "str"
            },
            {
                "p": "topic",
                "v": "",
                "vt": "string"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "on",
        "payloadType": "str",
        "x": 570,
        "y": 240,
        "wires": [
            [
                "fd97ed5c.f14d3"
            ]
        ]
    },
    {
        "id": "ec156ffc.6dcf4",
        "type": "change",
        "z": "eee3c0c3.7c7bd",
        "name": "Set Topic",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "light.kitchen_can_lights",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 600,
        "y": 300,
        "wires": [
            [
                "2901960a.c8dc3a"
            ]
        ]
    },
    {
        "id": "cf3a9398.0b726",
        "type": "api-current-state",
        "z": "eee3c0c3.7c7bd",
        "name": "Guest Mode",
        "server": "144427d5.6c9f18",
        "version": 1,
        "outputs": 2,
        "halt_if": "on",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "override_topic": false,
        "entity_id": "input_boolean.guest_mode",
        "state_type": "str",
        "state_location": "",
        "override_payload": "none",
        "entity_location": "",
        "override_data": "none",
        "blockInputOverrides": false,
        "x": 430,
        "y": 800,
        "wires": [
            [],
            [
                "604733f.ffb9ecc"
            ]
        ]
    },
    {
        "id": "fd815c5c.72ed2",
        "type": "api-current-state",
        "z": "38894af.7ca61b6",
        "name": "Sleep Mode Enabled",
        "server": "144427d5.6c9f18",
        "version": 1,
        "outputs": 2,
        "halt_if": "on",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "override_topic": false,
        "entity_id": "input_boolean.sleep_mode",
        "state_type": "str",
        "state_location": "",
        "override_payload": "none",
        "entity_location": "",
        "override_data": "none",
        "blockInputOverrides": false,
        "x": 380,
        "y": 880,
        "wires": [
            [
                "2316f4eb.9cb06c"
            ],
            []
        ]
    },
    {
        "id": "2316f4eb.9cb06c",
        "type": "api-current-state",
        "z": "38894af.7ca61b6",
        "name": "Guest Mode Enabled",
        "server": "144427d5.6c9f18",
        "version": 1,
        "outputs": 2,
        "halt_if": "on",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "override_topic": false,
        "entity_id": "input_boolean.guest_mode",
        "state_type": "str",
        "state_location": "",
        "override_payload": "none",
        "entity_location": "",
        "override_data": "none",
        "blockInputOverrides": false,
        "x": 380,
        "y": 920,
        "wires": [
            [],
            [
                "8ce109f3.a90188"
            ]
        ]
    },
    {
        "id": "368fe191.19c0be",
        "type": "api-current-state",
        "z": "cb6f2b8f.2124b8",
        "name": "Halt If Guest Mode Disabled",
        "server": "144427d5.6c9f18",
        "outputs": 1,
        "halt_if": "off",
        "override_topic": false,
        "entity_id": "input_boolean.guest_mode",
        "override_payload": false,
        "override_data": false,
        "x": 700,
        "y": 240,
        "wires": [
            [
                "21e8b9b3.0eada6",
                "c03ce9cb.bd9d28"
            ]
        ]
    },
    {
        "id": "88d42a21.79c948",
        "type": "comment",
        "z": "76250bd8.6dba94",
        "name": "Play Cartoons in Playroom",
        "info": "",
        "x": 190,
        "y": 260,
        "wires": []
    },
    {
        "id": "51f0abaa.218044",
        "type": "server-state-changed",
        "z": "76250bd8.6dba94",
        "name": "Alexa Handler - Goodnight",
        "server": "144427d5.6c9f18",
        "entityidfilter": "input_boolean.alexa_goodnight",
        "entityidfiltertype": "exact",
        "outputinitially": false,
        "state_type": "str",
        "haltifstate": "off",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "outputs": 2,
        "x": 190,
        "y": 420,
        "wires": [
            [
                "152433ab.784a5c"
            ],
            []
        ]
    },
    {
        "id": "a8a5edff.97d4",
        "type": "time-range-switch",
        "z": "47267ef8.fca6f",
        "name": "isNight",
        "lat": "",
        "lon": "",
        "startTime": "sunrise",
        "endTime": "sunset",
        "startOffset": 0,
        "endOffset": 0,
        "x": 930,
        "y": 720,
        "wires": [
            [],
            [
                "6d21a918.9090e8"
            ]
        ]
    },
    {
        "id": "3663f012.7284c",
        "type": "mqtt out",
        "z": "8d45d5f6.f088e8",
        "name": "Tree Power",
        "topic": "led/tree/power",
        "qos": "0",
        "retain": "",
        "broker": "1f84a57d.10775b",
        "x": 470,
        "y": 120,
        "wires": []
    },
    {
        "id": "56eee06.99a9b2",
        "type": "switch",
        "z": "eee3c0c3.7c7bd",
        "name": "Exclude Specific Lights",
        "property": "topic",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "light.backyard_tree_led",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "light.ava_s_lamp",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "light.lynley_s_lamp",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "light.office_tv_led",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "false",
        "repair": false,
        "outputs": 5,
        "x": 550,
        "y": 1640,
        "wires": [
            [],
            [],
            [],
            [],
            [
                "c6f4ae6e.c4fe2"
            ]
        ]
    },
    {
        "id": "9155bc22.589b4",
        "type": "api-current-state",
        "z": "eee3c0c3.7c7bd",
        "name": "Block If Motion Active",
        "server": "144427d5.6c9f18",
        "version": 1,
        "outputs": 2,
        "halt_if": "on",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "override_topic": false,
        "entity_id": "binary_sensor.kitchen_motion",
        "state_type": "str",
        "state_location": "",
        "override_payload": "none",
        "entity_location": "",
        "override_data": "none",
        "blockInputOverrides": false,
        "x": 920,
        "y": 400,
        "wires": [
            [],
            [
                "a7d89183.b3723"
            ]
        ]
    },
    {
        "id": "36fcddbc.c37e82",
        "type": "api-current-state",
        "z": "8d45d5f6.f088e8",
        "name": "Home",
        "server": "144427d5.6c9f18",
        "version": 1,
        "outputs": 2,
        "halt_if": "not_home",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "override_topic": false,
        "entity_id": "group.all_people",
        "state_type": "str",
        "state_location": "",
        "override_payload": "none",
        "entity_location": "",
        "override_data": "none",
        "blockInputOverrides": false,
        "x": 650,
        "y": 400,
        "wires": [
            [],
            [
                "105c4f83.2110f"
            ]
        ]
    },
    {
        "id": "f4316c4e.01975",
        "type": "api-current-state",
        "z": "8d45d5f6.f088e8",
        "name": "Away",
        "server": "144427d5.6c9f18",
        "version": 1,
        "outputs": 2,
        "halt_if": "home",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "override_topic": false,
        "entity_id": "group.all_people",
        "state_type": "str",
        "state_location": "",
        "override_payload": "none",
        "entity_location": "",
        "override_data": "none",
        "blockInputOverrides": false,
        "x": 650,
        "y": 280,
        "wires": [
            [],
            [
                "64957100.edc8d"
            ]
        ]
    },
    {
        "id": "993501d3.37c6e",
        "type": "delay",
        "z": "8d45d5f6.f088e8",
        "name": "Startup Delay",
        "pauseType": "delay",
        "timeout": "1",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "x": 360,
        "y": 500,
        "wires": [
            [
                "a406c663.ab0a6"
            ]
        ]
    },
    {
        "id": "8de38213.0e005",
        "type": "api-current-state",
        "z": "8d45d5f6.f088e8",
        "name": "Halt If Tree Off",
        "server": "144427d5.6c9f18",
        "version": 0,
        "outputs": 1,
        "halt_if": "off",
        "override_topic": false,
        "entity_id": "light.backyard_tree_led",
        "override_payload": false,
        "override_data": false,
        "x": 480,
        "y": 180,
        "wires": [
            [
                "808ba40a.43e208"
            ]
        ]
    },
    {
        "id": "808ba40a.43e208",
        "type": "api-current-state",
        "z": "8d45d5f6.f088e8",
        "name": "Pattern Rotation Check",
        "server": "144427d5.6c9f18",
        "version": "1",
        "outputs": 2,
        "halt_if": "off",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "override_topic": false,
        "entity_id": "input_boolean.option_backyard_tree_rotate_pattern",
        "state_type": "str",
        "state_location": "",
        "override_payload": "none",
        "entity_location": "",
        "override_data": "none",
        "blockInputOverrides": false,
        "x": 510,
        "y": 240,
        "wires": [
            [],
            [
                "4324fda6.94b894"
            ]
        ]
    },
    {
        "id": "a17d9cdd.46c2d",
        "type": "api-current-state",
        "z": "b55ab74c.698a88",
        "name": "Halt If Away",
        "server": "144427d5.6c9f18",
        "outputs": 1,
        "halt_if": "on",
        "override_topic": false,
        "entity_id": "input_boolean.away_mode",
        "override_payload": false,
        "override_data": false,
        "x": 1130,
        "y": 1060,
        "wires": [
            [
                "5ff8b930.afc738"
            ]
        ]
    },
    {
        "id": "388fbd9a.f51ce2",
        "type": "inject",
        "z": "8d45d5f6.f088e8",
        "name": "Tree Off Schedule",
        "repeat": "",
        "crontab": "00 23 * * *",
        "once": false,
        "onceDelay": "1",
        "topic": "",
        "payload": "0",
        "payloadType": "num",
        "x": 250,
        "y": 80,
        "wires": [
            [
                "3663f012.7284c",
                "bb3c5c4f.6ed76"
            ]
        ]
    },
    {
        "id": "e911146a.5c48d8",
        "type": "server-state-changed",
        "z": "8d45d5f6.f088e8",
        "name": "Single Pixel Specified",
        "server": "144427d5.6c9f18",
        "entityidfilter": "input_number.option_backyard_tree_single_pixel",
        "entityidfiltertype": "exact",
        "outputinitially": false,
        "haltifstate": "",
        "outputs": 1,
        "x": 220,
        "y": 640,
        "wires": [
            [
                "f27c3b0.1a281c8",
                "e9f97268.304f9"
            ]
        ]
    },
    {
        "id": "f27c3b0.1a281c8",
        "type": "debug",
        "z": "8d45d5f6.f088e8",
        "name": "Single Pixel Value",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "x": 590,
        "y": 640,
        "wires": []
    },
    {
        "id": "e9f97268.304f9",
        "type": "mqtt out",
        "z": "8d45d5f6.f088e8",
        "name": "Tree Pattern Adjust",
        "topic": "led/tree/single",
        "qos": "0",
        "retain": "",
        "broker": "1f84a57d.10775b",
        "x": 590,
        "y": 700,
        "wires": []
    },
    {
        "id": "bb3c5c4f.6ed76",
        "type": "api-call-service",
        "z": "8d45d5f6.f088e8",
        "name": "Enable Pattern Rotation Daily",
        "server": "144427d5.6c9f18",
        "service_domain": "input_boolean",
        "service": "turn_on",
        "data": "{\"entity_id\":\"input_boolean.option_backyard_tree_rotate_pattern\"}",
        "mergecontext": "",
        "x": 710,
        "y": 80,
        "wires": [
            []
        ]
    },
    {
        "id": "c174ca76.fe5338",
        "type": "trigger",
        "z": "eee3c0c3.7c7bd",
        "name": "Delay",
        "op1": "",
        "op2": "",
        "op1type": "nul",
        "op2type": "pay",
        "duration": "15",
        "extend": true,
        "overrideDelay": false,
        "units": "min",
        "reset": "on",
        "bytopic": "topic",
        "topic": "topic",
        "outputs": 1,
        "x": 870,
        "y": 340,
        "wires": [
            [
                "9155bc22.589b4"
            ]
        ]
    },
    {
        "id": "152433ab.784a5c",
        "type": "api-current-state",
        "z": "76250bd8.6dba94",
        "name": "Halt If Sleep Mode Enabled",
        "server": "144427d5.6c9f18",
        "outputs": 1,
        "halt_if": "on",
        "override_topic": false,
        "entity_id": "input_boolean.sleep_mode",
        "override_payload": false,
        "override_data": false,
        "x": 520,
        "y": 420,
        "wires": [
            [
                "44c5ed07.104934"
            ]
        ]
    },
    {
        "id": "44c5ed07.104934",
        "type": "api-call-service",
        "z": "76250bd8.6dba94",
        "name": "Enable Sleep Mode",
        "server": "144427d5.6c9f18",
        "service_domain": "input_boolean",
        "service": "turn_on",
        "data": "{\"entity_id\": \"input_boolean.sleep_mode\"}",
        "mergecontext": "",
        "x": 930,
        "y": 420,
        "wires": [
            []
        ]
    },
    {
        "id": "bdb8c7a9.ead018",
        "type": "change",
        "z": "47267ef8.fca6f",
        "name": "Reset Level",
        "rules": [
            {
                "t": "delete",
                "p": "special_level",
                "pt": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 750,
        "y": 780,
        "wires": [
            [
                "6d21a918.9090e8"
            ]
        ]
    },
    {
        "id": "f37615fe.5a8188",
        "type": "inject",
        "z": "47267ef8.fca6f",
        "name": "",
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "paused",
        "payloadType": "str",
        "x": 270,
        "y": 720,
        "wires": [
            [
                "99c8323a.d9ff5"
            ]
        ]
    },
    {
        "id": "6d21a918.9090e8",
        "type": "change",
        "z": "47267ef8.fca6f",
        "name": "Set Topic",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "light.kitchen_can_lights",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "payload.entity_id",
                "pt": "msg",
                "to": "light.kitchen_can_lights",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1140,
        "y": 780,
        "wires": [
            [
                "18b03173.700dcf"
            ]
        ]
    },
    {
        "id": "36a017f0.bede88",
        "type": "debug",
        "z": "eee3c0c3.7c7bd",
        "name": "Light Level Payload",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "x": 1050,
        "y": 1440,
        "wires": []
    },
    {
        "id": "18b03173.700dcf",
        "type": "api-current-state",
        "z": "47267ef8.fca6f",
        "name": "Halt if Off",
        "server": "144427d5.6c9f18",
        "outputs": 2,
        "halt_if": "off",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "override_topic": false,
        "entity_id": "light.kitchen_can_lights",
        "state_type": "str",
        "state_location": "",
        "override_payload": "none",
        "entity_location": "",
        "override_data": "none",
        "x": 1300,
        "y": 780,
        "wires": [
            [
                "2e6b817.ba2c47e"
            ],
            []
        ]
    },
    {
        "id": "96968b6c.c92238",
        "type": "time-range-switch",
        "z": "47267ef8.fca6f",
        "name": "isNight",
        "lat": "",
        "lon": "",
        "startTime": "sunrise",
        "endTime": "sunset",
        "startOffset": 0,
        "endOffset": 0,
        "x": 680,
        "y": 660,
        "wires": [
            [],
            [
                "2a4edf13.498f1"
            ]
        ]
    },
    {
        "id": "fc268fde.02b75",
        "type": "server-state-changed",
        "z": "3e9522c6.d11e1e",
        "name": "Alexa Handler - Show Cameras on TVs",
        "server": "144427d5.6c9f18",
        "entityidfilter": "input_boolean.alexa_show_.*_tv",
        "entityidfiltertype": "regex",
        "outputinitially": false,
        "state_type": "str",
        "haltifstate": "off",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "outputs": 2,
        "output_only_on_state_change": false,
        "x": 190,
        "y": 380,
        "wires": [
            [
                "76b58aa2.4c5024"
            ],
            []
        ]
    },
    {
        "id": "8d11fcf7.518b1",
        "type": "api-call-service",
        "z": "3e9522c6.d11e1e",
        "name": "Show Camera on Requested Display",
        "server": "144427d5.6c9f18",
        "service_domain": "media_player",
        "service": "play_media",
        "data": "{\"media_content_id\":\"https://bi.obscurelogic.com/mjpg/TV/video.mjpg\",\"media_content_type\":\"image/jpg\"}",
        "mergecontext": "",
        "output_location": "payload",
        "output_location_type": "msg",
        "mustacheAltTags": false,
        "x": 1410,
        "y": 300,
        "wires": [
            [
                "aa990c2c.22912"
            ]
        ]
    },
    {
        "id": "8fb080c0.696a2",
        "type": "inject",
        "z": "3e9522c6.d11e1e",
        "name": "Test Notification",
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 140,
        "y": 120,
        "wires": [
            [
                "1f9e987c.47f058"
            ]
        ]
    },
    {
        "id": "1f9e987c.47f058",
        "type": "function",
        "z": "3e9522c6.d11e1e",
        "name": "Test Doorbell",
        "func": "msg.event_type = 'doorbird_front_door_doorbell'\n// msg.event_type = 'doorbird_side_entry_button'\n// msg.event_type = 'doorbird_back_door_button'\n\n\nreturn msg;\n\n",
        "outputs": 1,
        "noerr": 0,
        "x": 390,
        "y": 120,
        "wires": [
            [
                "9bf1aa85.7499c8"
            ]
        ]
    },
    {
        "id": "e0f73ce1.d1e12",
        "type": "server-events",
        "z": "3e9522c6.d11e1e",
        "name": "Front Door Doorbell",
        "server": "144427d5.6c9f18",
        "event_type": "doorbird_front_door_doorbell",
        "x": 370,
        "y": 160,
        "wires": [
            [
                "9bf1aa85.7499c8"
            ]
        ]
    },
    {
        "id": "9bf1aa85.7499c8",
        "type": "function",
        "z": "3e9522c6.d11e1e",
        "name": "Doorbell to Camera Mapper",
        "func": "var map = {\n    doorbird_back_door_doorbell: \"camera.all_cameras\",\n    doorbird_front_door_doorbell: \"camera.all_cameras\",\n    doorbird_side_entry_doorbell: \"camera.all_cameras\",\n}\n\nmsg.payload = {\n    entity_id: map[msg.event_type],\n}\n\nmsg.display = 'all';\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 680,
        "y": 120,
        "wires": [
            [
                "78310c2b.3a5c44",
                "3a6fcf4f.b6e8c"
            ]
        ]
    },
    {
        "id": "78310c2b.3a5c44",
        "type": "api-current-state",
        "z": "3e9522c6.d11e1e",
        "name": "Get Camera URL",
        "server": "144427d5.6c9f18",
        "version": 1,
        "outputs": 1,
        "halt_if": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "override_topic": false,
        "entity_id": "",
        "state_type": "str",
        "state_location": "",
        "override_payload": "none",
        "entity_location": "data",
        "override_data": "msg",
        "blockInputOverrides": false,
        "x": 1010,
        "y": 380,
        "wires": [
            [
                "cb9584e6.66a8b8",
                "3a6fcf4f.b6e8c"
            ]
        ]
    },
    {
        "id": "76b58aa2.4c5024",
        "type": "function",
        "z": "3e9522c6.d11e1e",
        "name": "Alexa Action to Camera/Display Mapper",
        "func": "var map = {\n    \"input_boolean.alexa_show_back_door_office_tv\": {camera: \"camera.all_cameras\", display: \"media_player.office_chromecast\"},\n    \"input_boolean.alexa_show_front_door_office_tv\": {camera: \"camera.all_cameras\", display: \"media_player.office_chromecast\"},\n    \"input_boolean.alexa_show_side_entry_office_tv\": {camera: \"camera.all_cameras\", display: \"media_player.office_chromecast\"},\n    \"input_boolean.alexa_show_girls_room_office_tv\": {camera: \"camera.girl_s_room\", display: \"media_player.office_chromecast\"},\n    \"input_boolean.alexa_show_front_yard_office_tv\": {camera: \"camera.all_cameras\", display: \"media_player.office_chromecast\"},\n    \"input_boolean.alexa_show_side_yard_office_tv\": {camera: \"camera.all_cameras\", display: \"media_player.office_chromecast\"},\n\n    \n    \"input_boolean.alexa_show_back_door_playroom_tv\": {camera: \"camera.all_cameras\", display: \"media_player.playroom_tv_chromecast\"},\n    \"input_boolean.alexa_show_front_door_playroom_tv\": {camera: \"camera.all_cameras\", display: \"media_player.playroom_tv_chromecast\"},\n    \"input_boolean.alexa_show_side_entry_playroom_tv\": {camera: \"camera.all_cameras\", display: \"media_player.playroom_tv_chromecast\"},\n    \"input_boolean.alexa_show_girls_room_play_room_tv\": {camera: \"camera.girl_s_room\", display: \"media_player.playroom_tv_chromecast\"},\n    \n    \"input_boolean.alexa_show_back_door_living_room_tv\": {camera: \"camera.all_cameras\", display: \"media_player.living_room_chromecast\"},\n    \"input_boolean.alexa_show_front_door_living_room_tv\": {camera: \"camera.all_cameras\", display: \"media_player.living_room_chromecast\"},\n    \"input_boolean.alexa_show_side_entry_living_room_tv\": {camera: \"camera.all_cameras\", display: \"media_player.living_room_chromecast\"},\n    \"input_boolean.alexa_show_girls_room_living_room_tv\": {camera: \"camera.girl_s_room\", display: \"media_player.living_room_chromecast\"},\n    \"input_boolean.alexa_show_front_yard_living_room_tv\": {camera: \"camera.all_cameras\", display: \"media_player.living_room_chromecast\"},\n    \"input_boolean.alexa_show_side_yard_living_room_tv\": {camera: \"camera.all_cameras\", display: \"media_player.living_room_chromecast\"},\n\n\n}\n\nmsg.payload = {\n    entity_id: map[msg.topic].camera,\n}\n\nmsg.display = map[msg.topic].display;\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 660,
        "y": 380,
        "wires": [
            [
                "78310c2b.3a5c44"
            ]
        ]
    },
    {
        "id": "a67f2028.5f2d7",
        "type": "switch",
        "z": "3e9522c6.d11e1e",
        "name": "Display Selector",
        "property": "display",
        "propertyType": "msg",
        "rules": [
            {
                "t": "neq",
                "v": "all",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "false",
        "repair": false,
        "outputs": 2,
        "x": 1040,
        "y": 260,
        "wires": [
            [
                "c7579c9b.d4f56"
            ],
            [
                "e1d3a8a0.2ce0f8"
            ]
        ]
    },
    {
        "id": "e1d3a8a0.2ce0f8",
        "type": "api-call-service",
        "z": "3e9522c6.d11e1e",
        "name": "Show Camera on All Displays",
        "server": "144427d5.6c9f18",
        "service_domain": "media_player",
        "service": "play_media",
        "data": "{\"entity_id\":\"media_player.living_room_chromecast, media_player.office_chromecast, media_player.playroom_tv_chromecast, media_player.master_bedroom_tv\",\"media_content_id\":\"https://{{base_url}}/api/camera_proxy_stream/{{data.entity_id}}?token={{data.attributes.access_token}}\",\"media_content_type\":\"image/jpg\"}",
        "mergecontext": "",
        "output_location": "payload",
        "output_location_type": "msg",
        "x": 1390,
        "y": 380,
        "wires": [
            [
                "98f435bd.39b668"
            ]
        ]
    },
    {
        "id": "1164957c.f13cdb",
        "type": "comment",
        "z": "3e9522c6.d11e1e",
        "name": "Alexa Requests To Display Cameras",
        "info": "",
        "x": 180,
        "y": 340,
        "wires": []
    },
    {
        "id": "1d8b2bfb.0655a4",
        "type": "comment",
        "z": "3e9522c6.d11e1e",
        "name": "Display Cameras on Doorbell Ring",
        "info": "",
        "x": 180,
        "y": 60,
        "wires": []
    },
    {
        "id": "aa990c2c.22912",
        "type": "delay",
        "z": "3e9522c6.d11e1e",
        "name": "Delay",
        "pauseType": "delay",
        "timeout": "30",
        "timeoutUnits": "minutes",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "x": 1650,
        "y": 300,
        "wires": [
            [
                "80d538c4.f9f818"
            ]
        ]
    },
    {
        "id": "98f435bd.39b668",
        "type": "delay",
        "z": "3e9522c6.d11e1e",
        "name": "Delay",
        "pauseType": "delay",
        "timeout": "1",
        "timeoutUnits": "minutes",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "x": 1650,
        "y": 380,
        "wires": [
            [
                "80d538c4.f9f818"
            ]
        ]
    },
    {
        "id": "48d2989b.427f78",
        "type": "api-call-service",
        "z": "3e9522c6.d11e1e",
        "name": "Stop Camera Stream on Display",
        "server": "144427d5.6c9f18",
        "service_domain": "media_player",
        "service": "turn_off",
        "data": "",
        "mergecontext": "",
        "output_location": "payload",
        "output_location_type": "msg",
        "x": 1930,
        "y": 340,
        "wires": [
            []
        ]
    },
    {
        "id": "80d538c4.f9f818",
        "type": "change",
        "z": "3e9522c6.d11e1e",
        "name": "Clean Payload",
        "rules": [
            {
                "t": "delete",
                "p": "payload.service",
                "pt": "msg"
            },
            {
                "t": "delete",
                "p": "payload.data.media_content_id",
                "pt": "msg"
            },
            {
                "t": "delete",
                "p": "payload.data.media_content_type",
                "pt": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1880,
        "y": 300,
        "wires": [
            []
        ]
    },
    {
        "id": "c7579c9b.d4f56",
        "type": "change",
        "z": "3e9522c6.d11e1e",
        "name": "Set Display Payload",
        "rules": [
            {
                "t": "set",
                "p": "payload.data.entity_id",
                "pt": "msg",
                "to": "display",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1360,
        "y": 260,
        "wires": [
            [
                "8d11fcf7.518b1"
            ]
        ]
    },
    {
        "id": "d3e9619e.931aa",
        "type": "debug",
        "z": "76250bd8.6dba94",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "x": 630,
        "y": 80,
        "wires": []
    },
    {
        "id": "bfab3a97.d8afc8",
        "type": "function",
        "z": "76250bd8.6dba94",
        "name": "Set Entity ID",
        "func": "msg.payload = {\n    data: {\n        entity_id: msg.topic\n    }\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 430,
        "y": 140,
        "wires": [
            [
                "b67a988d.20f518"
            ]
        ]
    },
    {
        "id": "b67a988d.20f518",
        "type": "delay",
        "z": "76250bd8.6dba94",
        "name": "",
        "pauseType": "delay",
        "timeout": "2",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "x": 580,
        "y": 140,
        "wires": [
            [
                "1acdb776.78bf49"
            ]
        ]
    },
    {
        "id": "c7689285.1768f",
        "type": "server-events",
        "z": "51c810f0.59ce1",
        "name": "All Events",
        "server": "144427d5.6c9f18",
        "event_type": "ios.notification_action_fired",
        "x": 180,
        "y": 160,
        "wires": [
            [
                "62564f22.7c2c4",
                "700b0af3.8487b4"
            ]
        ]
    },
    {
        "id": "62564f22.7c2c4",
        "type": "switch",
        "z": "51c810f0.59ce1",
        "name": "Event Router",
        "property": "payload.event.actionName",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "CLEAR_TIMER",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "RESET_BEDTIME_NOTIFICATIONS",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 370,
        "y": 160,
        "wires": [
            [
                "34401846.8e5518"
            ],
            [
                "5d446861.be44a8"
            ]
        ]
    },
    {
        "id": "700b0af3.8487b4",
        "type": "debug",
        "z": "51c810f0.59ce1",
        "name": "",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "x": 350,
        "y": 120,
        "wires": []
    },
    {
        "id": "34401846.8e5518",
        "type": "link out",
        "z": "51c810f0.59ce1",
        "name": "iOS Action - Clear Timer",
        "links": [
            "e58f35a3.bd7d48"
        ],
        "x": 535,
        "y": 120,
        "wires": []
    },
    {
        "id": "e58f35a3.bd7d48",
        "type": "link in",
        "z": "38894af.7ca61b6",
        "name": "Handler - Reset Door Timer",
        "links": [
            "34401846.8e5518"
        ],
        "x": 375,
        "y": 500,
        "wires": [
            [
                "48e55600.7e731c"
            ]
        ]
    },
    {
        "id": "48e55600.7e731c",
        "type": "change",
        "z": "38894af.7ca61b6",
        "name": "Stop Timer Payload",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "STOP",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 550,
        "y": 500,
        "wires": [
            [
                "4c43add1.d859b4",
                "e6f4f6d4.3f84b8",
                "6a93c010.4eedd",
                "481e307a.623bc",
                "3f6afe29.11be52"
            ]
        ]
    },
    {
        "id": "4cdd2835.d7e4e8",
        "type": "throttle",
        "z": "38894af.7ca61b6",
        "name": "Rate Limit",
        "throttleType": "time",
        "timeLimit": "10",
        "timeLimitType": "seconds",
        "countLimit": "1",
        "blockSize": 0,
        "locked": false,
        "x": 500,
        "y": 180,
        "wires": [
            [
                "7fb24f45.2a33d"
            ]
        ]
    },
    {
        "id": "29515c43.e6c2e4",
        "type": "and-gate",
        "z": "cb6f2b8f.2124b8",
        "name": "Both Outside Boundary",
        "rules": [
            {
                "t": "false",
                "propertyType": "msg",
                "property": "location.inarea",
                "topic": "owntracks/alydia/iphone"
            },
            {
                "t": "false",
                "propertyType": "msg",
                "property": "location.inarea",
                "topic": "owntracks/matt/iphone"
            }
        ],
        "outputTopic": "enable_extended_away",
        "gateType": "and",
        "emitOnlyIfTrue": true,
        "x": 690,
        "y": 1120,
        "wires": [
            [
                "749067ba.5fbb88"
            ]
        ]
    },
    {
        "id": "1751f37c.107a7d",
        "type": "repeat",
        "z": "38894af.7ca61b6",
        "name": "Repeat Notification",
        "repetitions": "4",
        "elseOutput": false,
        "outputs": 1,
        "x": 1010,
        "y": 840,
        "wires": [
            [
                "8dbee0f6.087c"
            ]
        ]
    },
    {
        "id": "b2055264.6e15c",
        "type": "repeat",
        "z": "38894af.7ca61b6",
        "name": "Repeat Until Stopped",
        "repetitions": "100000",
        "elseOutput": false,
        "outputs": 1,
        "x": 740,
        "y": 2040,
        "wires": [
            [
                "b90ef3c2.e2a1"
            ]
        ]
    },
    {
        "id": "d7724a3.a1d30b8",
        "type": "alexa-local",
        "z": "76250bd8.6dba94",
        "devicename": "Cartoons Playroom",
        "inputtrigger": false,
        "x": 170,
        "y": 300,
        "wires": [
            [
                "20829d14.a77f42",
                "1a2a73d0.b6f47c"
            ]
        ]
    },
    {
        "id": "3d25b766.82cee8",
        "type": "light-scheduler",
        "z": "97047d3e.e8278",
        "settings": "9dba4206.297ed",
        "events": "[{\"start\":{\"dow\":1,\"mod\":1080},\"end\":{\"dow\":1,\"mod\":1095}},{\"start\":{\"dow\":1,\"mod\":1275},\"end\":{\"dow\":1,\"mod\":1290}},{\"start\":{\"dow\":2,\"mod\":1095},\"end\":{\"dow\":2,\"mod\":1110}},{\"start\":{\"dow\":4,\"mod\":1080},\"end\":{\"dow\":4,\"mod\":1095}},{\"start\":{\"dow\":3,\"mod\":1215},\"end\":{\"dow\":3,\"mod\":1230}},{\"start\":{\"dow\":4,\"mod\":1110},\"end\":{\"dow\":4,\"mod\":1125}},{\"start\":{\"dow\":3,\"mod\":1125},\"end\":{\"dow\":3,\"mod\":1155}},{\"start\":{\"dow\":1,\"mod\":1125},\"end\":{\"dow\":1,\"mod\":1170}},{\"start\":{\"dow\":1,\"mod\":1230},\"end\":{\"dow\":1,\"mod\":1245}},{\"start\":{\"dow\":1,\"mod\":1335},\"end\":{\"dow\":1,\"mod\":1365}},{\"start\":{\"dow\":2,\"mod\":1170},\"end\":{\"dow\":2,\"mod\":1200}},{\"start\":{\"dow\":4,\"mod\":1260},\"end\":{\"dow\":4,\"mod\":1275}},{\"start\":{\"dow\":4,\"mod\":1335},\"end\":{\"dow\":4,\"mod\":1350}},{\"start\":{\"dow\":5,\"mod\":1170},\"end\":{\"dow\":5,\"mod\":1200}},{\"start\":{\"dow\":5,\"mod\":1260},\"end\":{\"dow\":5,\"mod\":1275}},{\"start\":{\"dow\":5,\"mod\":1305},\"end\":{\"dow\":5,\"mod\":1320}},{\"start\":{\"dow\":6,\"mod\":1200},\"end\":{\"dow\":6,\"mod\":1215}},{\"start\":{\"dow\":2,\"mod\":1290},\"end\":{\"dow\":2,\"mod\":1305}},{\"start\":{\"dow\":0,\"mod\":1275},\"end\":{\"dow\":0,\"mod\":1290}},{\"start\":{\"dow\":0,\"mod\":1215},\"end\":{\"dow\":0,\"mod\":1230}},{\"start\":{\"dow\":0,\"mod\":1155},\"end\":{\"dow\":0,\"mod\":1185}},{\"start\":{\"dow\":6,\"mod\":1365},\"end\":{\"dow\":6,\"mod\":1380}},{\"start\":{\"dow\":0,\"mod\":1335},\"end\":{\"dow\":0,\"mod\":1350}}]",
        "topic": "light.kitchen_can_lights",
        "name": "Kitchen Schedule",
        "onPayload": "ON",
        "onPayloadType": "str",
        "offPayload": "OFF",
        "offPayloadType": "str",
        "onlyWhenDark": true,
        "sunElevationThreshold": 6,
        "sunShowElevationInStatus": false,
        "outputfreq": "output.statechange.startup",
        "x": 670,
        "y": 120,
        "wires": [
            [
                "9bb5757.d056d88"
            ]
        ]
    },
    {
        "id": "458a451b.4b1efc",
        "type": "light-scheduler",
        "z": "97047d3e.e8278",
        "settings": "9dba4206.297ed",
        "events": "[{\"start\":{\"dow\":2,\"mod\":1350},\"end\":{\"dow\":2,\"mod\":1365}},{\"start\":{\"dow\":2,\"mod\":1380},\"end\":{\"dow\":3,\"mod\":0}},{\"start\":{\"dow\":1,\"mod\":1335},\"end\":{\"dow\":2,\"mod\":0}},{\"start\":{\"dow\":3,\"mod\":1365},\"end\":{\"dow\":4,\"mod\":0}},{\"start\":{\"dow\":4,\"mod\":1335},\"end\":{\"dow\":5,\"mod\":0}},{\"start\":{\"dow\":6,\"mod\":1335},\"end\":{\"dow\":0,\"mod\":0}},{\"start\":{\"dow\":0,\"mod\":1320},\"end\":{\"dow\":1,\"mod\":0}},{\"start\":{\"dow\":5,\"mod\":1320},\"end\":{\"dow\":5,\"mod\":1335}},{\"start\":{\"dow\":5,\"mod\":1350},\"end\":{\"dow\":6,\"mod\":0}},{\"start\":{\"dow\":1,\"mod\":0},\"end\":{\"dow\":1,\"mod\":405}},{\"start\":{\"dow\":2,\"mod\":0},\"end\":{\"dow\":2,\"mod\":405}},{\"start\":{\"dow\":3,\"mod\":0},\"end\":{\"dow\":3,\"mod\":390}},{\"start\":{\"dow\":4,\"mod\":0},\"end\":{\"dow\":4,\"mod\":405}},{\"start\":{\"dow\":5,\"mod\":0},\"end\":{\"dow\":5,\"mod\":420}},{\"start\":{\"dow\":6,\"mod\":0},\"end\":{\"dow\":6,\"mod\":420}},{\"start\":{\"dow\":0,\"mod\":0},\"end\":{\"dow\":0,\"mod\":405}}]",
        "topic": "switch.stair_light",
        "name": "Stair Light Schedule",
        "onPayload": "ON",
        "onPayloadType": "str",
        "offPayload": "OFF",
        "offPayloadType": "str",
        "onlyWhenDark": true,
        "sunElevationThreshold": 6,
        "sunShowElevationInStatus": false,
        "outputfreq": "output.statechange.startup",
        "x": 680,
        "y": 180,
        "wires": [
            [
                "9bb5757.d056d88"
            ]
        ]
    },
    {
        "id": "e37dd587.8c1ba8",
        "type": "light-scheduler",
        "z": "97047d3e.e8278",
        "settings": "9dba4206.297ed",
        "events": "[{\"start\":{\"dow\":1,\"mod\":1230},\"end\":{\"dow\":1,\"mod\":1290}},{\"start\":{\"dow\":1,\"mod\":1305},\"end\":{\"dow\":1,\"mod\":1335}},{\"start\":{\"dow\":2,\"mod\":1245},\"end\":{\"dow\":2,\"mod\":1320}},{\"start\":{\"dow\":3,\"mod\":1245},\"end\":{\"dow\":3,\"mod\":1305}},{\"start\":{\"dow\":3,\"mod\":1320},\"end\":{\"dow\":3,\"mod\":1335}},{\"start\":{\"dow\":4,\"mod\":1260},\"end\":{\"dow\":4,\"mod\":1290}},{\"start\":{\"dow\":4,\"mod\":1320},\"end\":{\"dow\":4,\"mod\":1350}},{\"start\":{\"dow\":5,\"mod\":1215},\"end\":{\"dow\":5,\"mod\":1335}},{\"start\":{\"dow\":6,\"mod\":1245},\"end\":{\"dow\":6,\"mod\":1305}},{\"start\":{\"dow\":0,\"mod\":1290},\"end\":{\"dow\":0,\"mod\":1335}},{\"start\":{\"dow\":1,\"mod\":1140},\"end\":{\"dow\":1,\"mod\":1155}},{\"start\":{\"dow\":2,\"mod\":1170},\"end\":{\"dow\":2,\"mod\":1185}},{\"start\":{\"dow\":4,\"mod\":1140},\"end\":{\"dow\":4,\"mod\":1155}},{\"start\":{\"dow\":5,\"mod\":1185},\"end\":{\"dow\":5,\"mod\":1200}},{\"start\":{\"dow\":6,\"mod\":1110},\"end\":{\"dow\":6,\"mod\":1125}},{\"start\":{\"dow\":0,\"mod\":1155},\"end\":{\"dow\":0,\"mod\":1170}},{\"start\":{\"dow\":3,\"mod\":1110},\"end\":{\"dow\":3,\"mod\":1125}},{\"start\":{\"dow\":3,\"mod\":1155},\"end\":{\"dow\":3,\"mod\":1170}},{\"start\":{\"dow\":6,\"mod\":1215},\"end\":{\"dow\":6,\"mod\":1230}},{\"start\":{\"dow\":3,\"mod\":1215},\"end\":{\"dow\":3,\"mod\":1230}},{\"start\":{\"dow\":0,\"mod\":1245},\"end\":{\"dow\":0,\"mod\":1260}}]",
        "topic": "switch.master_bedroom_light",
        "name": "Master Bedroom Light Schedule",
        "onPayload": "ON",
        "onPayloadType": "str",
        "offPayload": "OFF",
        "offPayloadType": "str",
        "onlyWhenDark": true,
        "sunElevationThreshold": 6,
        "sunShowElevationInStatus": false,
        "outputfreq": "output.statechange.startup",
        "x": 710,
        "y": 240,
        "wires": [
            [
                "9bb5757.d056d88"
            ]
        ]
    },
    {
        "id": "dbefdafa.3f9cf8",
        "type": "light-scheduler",
        "z": "97047d3e.e8278",
        "settings": "9dba4206.297ed",
        "events": "[{\"start\":{\"dow\":1,\"mod\":1095},\"end\":{\"dow\":1,\"mod\":1215}},{\"start\":{\"dow\":2,\"mod\":1125},\"end\":{\"dow\":2,\"mod\":1230}},{\"start\":{\"dow\":3,\"mod\":1095},\"end\":{\"dow\":3,\"mod\":1215}},{\"start\":{\"dow\":4,\"mod\":1080},\"end\":{\"dow\":4,\"mod\":1230}},{\"start\":{\"dow\":6,\"mod\":1095},\"end\":{\"dow\":6,\"mod\":1260}},{\"start\":{\"dow\":0,\"mod\":1155},\"end\":{\"dow\":0,\"mod\":1230}},{\"start\":{\"dow\":5,\"mod\":1110},\"end\":{\"dow\":5,\"mod\":1245}}]",
        "topic": "switch.playroom_can_lights",
        "name": "Playroom Light Schedule",
        "onPayload": "ON",
        "onPayloadType": "str",
        "offPayload": "OFF",
        "offPayloadType": "str",
        "onlyWhenDark": true,
        "sunElevationThreshold": 6,
        "sunShowElevationInStatus": false,
        "outputfreq": "output.statechange.startup",
        "x": 690,
        "y": 300,
        "wires": [
            [
                "9bb5757.d056d88"
            ]
        ]
    },
    {
        "id": "38d09349.53b57c",
        "type": "light-scheduler",
        "z": "97047d3e.e8278",
        "settings": "9dba4206.297ed",
        "events": "[{\"start\":{\"dow\":1,\"mod\":1140},\"end\":{\"dow\":1,\"mod\":1155}},{\"start\":{\"dow\":3,\"mod\":1170},\"end\":{\"dow\":3,\"mod\":1200}},{\"start\":{\"dow\":4,\"mod\":1125},\"end\":{\"dow\":4,\"mod\":1140}},{\"start\":{\"dow\":6,\"mod\":1215},\"end\":{\"dow\":6,\"mod\":1245}}]",
        "topic": "light.living_room_chandelier",
        "name": "Living Room Can Lights",
        "onPayload": "ON",
        "onPayloadType": "str",
        "offPayload": "OFF",
        "offPayloadType": "str",
        "onlyWhenDark": true,
        "sunElevationThreshold": 6,
        "sunShowElevationInStatus": false,
        "outputfreq": "output.statechange.startup",
        "x": 690,
        "y": 360,
        "wires": [
            [
                "9bb5757.d056d88"
            ]
        ]
    },
    {
        "id": "f8a0cfa9.74bae",
        "type": "light-scheduler",
        "z": "eee3c0c3.7c7bd",
        "settings": "9dba4206.297ed",
        "events": "[{\"start\":{\"dow\":1,\"mod\":0},\"end\":{\"dow\":2,\"mod\":0}},{\"start\":{\"dow\":2,\"mod\":0},\"end\":{\"dow\":3,\"mod\":0}},{\"start\":{\"dow\":3,\"mod\":0},\"end\":{\"dow\":4,\"mod\":0}},{\"start\":{\"dow\":4,\"mod\":0},\"end\":{\"dow\":5,\"mod\":0}},{\"start\":{\"dow\":5,\"mod\":0},\"end\":{\"dow\":6,\"mod\":0}},{\"start\":{\"dow\":6,\"mod\":0},\"end\":{\"dow\":0,\"mod\":0}},{\"start\":{\"dow\":0,\"mod\":0},\"end\":{\"dow\":1,\"mod\":0}}]",
        "topic": "",
        "name": "",
        "onPayload": "40",
        "onPayloadType": "str",
        "offPayload": "100",
        "offPayloadType": "str",
        "onlyWhenDark": true,
        "sunElevationThreshold": "0",
        "sunShowElevationInStatus": true,
        "outputfreq": "output.statechange.startup",
        "x": 200,
        "y": 1480,
        "wires": [
            [
                "20c451c1.48de3e",
                "40d1d2bf.0f110c"
            ]
        ]
    },
    {
        "id": "4a1938d5.78ef08",
        "type": "light-scheduler",
        "z": "8d45d5f6.f088e8",
        "settings": "9dba4206.297ed",
        "events": "[{\"start\":{\"dow\":1,\"mod\":420},\"end\":{\"dow\":1,\"mod\":1320}},{\"start\":{\"dow\":2,\"mod\":420},\"end\":{\"dow\":2,\"mod\":1320}},{\"start\":{\"dow\":3,\"mod\":420},\"end\":{\"dow\":3,\"mod\":1320}},{\"start\":{\"dow\":4,\"mod\":420},\"end\":{\"dow\":4,\"mod\":1320}},{\"start\":{\"dow\":5,\"mod\":420},\"end\":{\"dow\":5,\"mod\":1320}},{\"start\":{\"dow\":6,\"mod\":420},\"end\":{\"dow\":6,\"mod\":1320}},{\"start\":{\"dow\":0,\"mod\":420},\"end\":{\"dow\":0,\"mod\":1320}}]",
        "topic": "",
        "name": "Inside Light Schedule",
        "onPayload": "ON",
        "onPayloadType": "str",
        "offPayload": "OFF",
        "offPayloadType": "str",
        "onlyWhenDark": false,
        "sunElevationThreshold": 6,
        "sunShowElevationInStatus": false,
        "outputfreq": "output.minutely",
        "x": 220,
        "y": 460,
        "wires": [
            [
                "993501d3.37c6e"
            ]
        ]
    },
    {
        "id": "385b851a.08fd9a",
        "type": "light-scheduler",
        "z": "8d45d5f6.f088e8",
        "settings": "9dba4206.297ed",
        "events": "[{\"start\":{\"dow\":2,\"mod\":900},\"end\":{\"dow\":2,\"mod\":1380}},{\"start\":{\"dow\":3,\"mod\":900},\"end\":{\"dow\":3,\"mod\":1380}},{\"start\":{\"dow\":4,\"mod\":900},\"end\":{\"dow\":4,\"mod\":1380}},{\"start\":{\"dow\":5,\"mod\":900},\"end\":{\"dow\":5,\"mod\":1380}},{\"start\":{\"dow\":6,\"mod\":900},\"end\":{\"dow\":6,\"mod\":1380}},{\"start\":{\"dow\":0,\"mod\":900},\"end\":{\"dow\":0,\"mod\":1380}},{\"start\":{\"dow\":1,\"mod\":900},\"end\":{\"dow\":1,\"mod\":1380}}]",
        "topic": "",
        "name": "Outside Light Schedule",
        "onPayload": "1",
        "onPayloadType": "str",
        "offPayload": "0",
        "offPayloadType": "str",
        "onlyWhenDark": true,
        "sunElevationThreshold": "6",
        "sunShowElevationInStatus": true,
        "outputfreq": "output.statechange.startup",
        "x": 230,
        "y": 120,
        "wires": [
            [
                "3663f012.7284c"
            ]
        ]
    },
    {
        "id": "2d8a718d.93454e",
        "type": "string",
        "z": "38894af.7ca61b6",
        "name": "Strip Newlines",
        "methods": [
            {
                "name": "strip",
                "params": [
                    {
                        "type": "str",
                        "value": "\\n"
                    }
                ]
            }
        ],
        "prop": "payload",
        "propout": "payload",
        "object": "msg",
        "objectout": "msg",
        "x": 1460,
        "y": 1120,
        "wires": [
            [
                "88fe746f.c586b8"
            ]
        ]
    },
    {
        "id": "cb9584e6.66a8b8",
        "type": "credentials",
        "z": "3e9522c6.d11e1e",
        "name": "Get Base URL",
        "props": [
            {
                "value": "base_url",
                "type": "msg"
            }
        ],
        "x": 1020,
        "y": 320,
        "wires": [
            [
                "a67f2028.5f2d7",
                "3a6fcf4f.b6e8c"
            ]
        ]
    },
    {
        "id": "d5e90594.b099b8",
        "type": "Unifi",
        "z": "cb6f2b8f.2124b8",
        "name": "Get Unifi Site Stats",
        "ip": "192.168.1.9",
        "port": 8443,
        "site": "default",
        "command": "1",
        "x": 450,
        "y": 140,
        "wires": [
            [
                "28d7951a.afb56a"
            ]
        ]
    },
    {
        "id": "d5fbda02.222b68",
        "type": "server-events",
        "z": "3e9522c6.d11e1e",
        "name": "Front Door Motion Event",
        "server": "144427d5.6c9f18",
        "event_type": "doorbird_front_door_motion",
        "x": 190,
        "y": 860,
        "wires": [
            [
                "689e7a63.b7e574"
            ]
        ]
    },
    {
        "id": "6babb24d.927d7c",
        "type": "server-events",
        "z": "3e9522c6.d11e1e",
        "name": "Side Entry Motion Event",
        "server": "144427d5.6c9f18",
        "event_type": "doorbird_side_entry_motion",
        "x": 190,
        "y": 900,
        "wires": [
            [
                "689e7a63.b7e574"
            ]
        ]
    },
    {
        "id": "6b4236bb.3b6b28",
        "type": "server-events",
        "z": "3e9522c6.d11e1e",
        "name": "Back Door Motion Event",
        "server": "144427d5.6c9f18",
        "event_type": "doorbird_back_door_motion",
        "x": 190,
        "y": 940,
        "wires": [
            [
                "689e7a63.b7e574"
            ]
        ]
    },
    {
        "id": "c5863dd6.8bd9f",
        "type": "debug",
        "z": "eee3c0c3.7c7bd",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "x": 1210,
        "y": 1320,
        "wires": []
    },
    {
        "id": "c6f4ae6e.c4fe2",
        "type": "switch",
        "z": "eee3c0c3.7c7bd",
        "name": "Filter Blank Responses",
        "property": "topic",
        "propertyType": "msg",
        "rules": [
            {
                "t": "istype",
                "v": "object",
                "vt": "object"
            },
            {
                "t": "eq",
                "v": "OK",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "200",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 4,
        "x": 824.5,
        "y": 1621,
        "wires": [
            [],
            [],
            [],
            [
                "63cca837.6b1d58"
            ]
        ]
    },
    {
        "id": "58ba3d6e.452774",
        "type": "change",
        "z": "90be6c3f.6407",
        "name": "Alexa Device - Kitchen",
        "rules": [
            {
                "t": "set",
                "p": "device",
                "pt": "msg",
                "to": "Kitchen",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 640,
        "y": 660,
        "wires": [
            [
                "f7d31362.4c12a"
            ]
        ]
    },
    {
        "id": "17a5f4ab.a80c8b",
        "type": "mqtt out",
        "z": "90be6c3f.6407",
        "name": "Publish Alexa TTS Notification",
        "topic": "",
        "qos": "0",
        "retain": "false",
        "broker": "1f84a57d.10775b",
        "x": 1070,
        "y": 660,
        "wires": []
    },
    {
        "id": "3fda1b00.a1fa56",
        "type": "inject",
        "z": "b55ab74c.698a88",
        "name": "Reset Timers",
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "STOP",
        "payloadType": "str",
        "x": 190,
        "y": 1000,
        "wires": [
            [
                "9696479c.1845c8"
            ]
        ]
    },
    {
        "id": "9696479c.1845c8",
        "type": "change",
        "z": "b55ab74c.698a88",
        "name": "Stop Timer Payload",
        "rules": [
            {
                "t": "set",
                "p": "reset",
                "pt": "msg",
                "to": "True",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 429,
        "y": 1062,
        "wires": [
            [
                "ab9ab807.c3ad58",
                "fe960e6c.e95d8",
                "7cb1a4dc.28bdcc"
            ]
        ]
    },
    {
        "id": "68119da7.eca3f4",
        "type": "change",
        "z": "90be6c3f.6407",
        "name": "Alexa Device - Playroom",
        "rules": [
            {
                "t": "set",
                "p": "device",
                "pt": "msg",
                "to": "Playroom",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 650,
        "y": 600,
        "wires": [
            [
                "f7d31362.4c12a"
            ]
        ]
    },
    {
        "id": "f7d31362.4c12a",
        "type": "function",
        "z": "90be6c3f.6407",
        "name": "Notification Translator",
        "func": "msg = {\n    topic: 'alexa/tts/' + msg.device,\n    payload: msg.payload.data.message\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 1000,
        "y": 500,
        "wires": [
            [
                "4cc3539d.2cac5c"
            ]
        ]
    },
    {
        "id": "b23a6a41.003758",
        "type": "change",
        "z": "90be6c3f.6407",
        "name": "Alexa Device - Matt's Office",
        "rules": [
            {
                "t": "set",
                "p": "device",
                "pt": "msg",
                "to": "Matt's Office",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 660,
        "y": 500,
        "wires": [
            [
                "f7d31362.4c12a"
            ]
        ]
    },
    {
        "id": "708d64a1.c4ee8c",
        "type": "change",
        "z": "90be6c3f.6407",
        "name": "Alexa Device - Master Bedroom",
        "rules": [
            {
                "t": "set",
                "p": "device",
                "pt": "msg",
                "to": "Master Bedroom",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 670,
        "y": 460,
        "wires": [
            [
                "f7d31362.4c12a"
            ]
        ]
    },
    {
        "id": "c3f1a0c9.06055",
        "type": "change",
        "z": "90be6c3f.6407",
        "name": "Alexa Device - Girls's Room",
        "rules": [
            {
                "t": "set",
                "p": "device",
                "pt": "msg",
                "to": "Girl's Room",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 660,
        "y": 720,
        "wires": [
            [
                "f7d31362.4c12a"
            ]
        ]
    },
    {
        "id": "d3a1039a.3636",
        "type": "comment",
        "z": "3e9522c6.d11e1e",
        "name": "Door Motion Event Recording",
        "info": "",
        "x": 180,
        "y": 820,
        "wires": []
    },
    {
        "id": "8fee7b97.e85098",
        "type": "api-call-service",
        "z": "30c7e5fd.18228a",
        "name": "Master Bedroom Light Off",
        "server": "144427d5.6c9f18",
        "service_domain": "switch",
        "service": "turn_off",
        "data": "{\"entity_id\":\"switch.master_bedroom_light\"}",
        "mergecontext": "",
        "x": 710,
        "y": 580,
        "wires": [
            []
        ]
    },
    {
        "id": "9b071567.e41698",
        "type": "api-call-service",
        "z": "30c7e5fd.18228a",
        "name": "Sound Machine On",
        "server": "144427d5.6c9f18",
        "service_domain": "media_player",
        "service": "media_play",
        "data": "{\"entity_id\":\"media_player.master_bedroom_sonos\"}",
        "mergecontext": "",
        "output_location": "payload",
        "output_location_type": "msg",
        "x": 650,
        "y": 520,
        "wires": [
            []
        ]
    },
    {
        "id": "ec212f.1956ded",
        "type": "comment",
        "z": "30c7e5fd.18228a",
        "name": "Master Bedroom Sleep Comfort Settings",
        "info": "",
        "x": 240,
        "y": 400,
        "wires": []
    },
    {
        "id": "20b94728.74eb88",
        "type": "api-call-service",
        "z": "30c7e5fd.18228a",
        "name": "Fan On",
        "server": "144427d5.6c9f18",
        "service_domain": "fan",
        "service": "set_speed",
        "data": "",
        "mergecontext": "",
        "x": 940,
        "y": 1140,
        "wires": [
            []
        ]
    },
    {
        "id": "48222eb.b6240d",
        "type": "mqtt in",
        "z": "2061740e.e5207c",
        "name": "Location Updates",
        "topic": "owntracks/alydia/#",
        "qos": "2",
        "broker": "1f84a57d.10775b",
        "x": 140,
        "y": 540,
        "wires": [
            [
                "cbfc48a9.61e7f8"
            ]
        ]
    },
    {
        "id": "22b385be.4d637a",
        "type": "debug",
        "z": "2061740e.e5207c",
        "name": "",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 650,
        "y": 640,
        "wires": []
    },
    {
        "id": "cbfc48a9.61e7f8",
        "type": "json",
        "z": "2061740e.e5207c",
        "name": "",
        "property": "payload",
        "action": "",
        "pretty": false,
        "x": 390,
        "y": 540,
        "wires": [
            []
        ]
    },
    {
        "id": "3ed9b5e8.45d60a",
        "type": "comment",
        "z": "38894af.7ca61b6",
        "name": "Doorbird Relay Events",
        "info": "",
        "x": 160,
        "y": 1680,
        "wires": []
    },
    {
        "id": "4efe0afc.9b3124",
        "type": "server-events",
        "z": "38894af.7ca61b6",
        "name": "All Events",
        "server": "144427d5.6c9f18",
        "event_type": "",
        "x": 120,
        "y": 1720,
        "wires": [
            [
                "948dcc7d.04e2"
            ]
        ]
    },
    {
        "id": "948dcc7d.04e2",
        "type": "switch",
        "z": "38894af.7ca61b6",
        "name": "Doorbird Relay Events",
        "property": "event_type",
        "propertyType": "msg",
        "rules": [
            {
                "t": "regex",
                "v": "doorbird_.*_relay",
                "vt": "str",
                "case": false
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 340,
        "y": 1720,
        "wires": [
            [
                "b063fa53.89a488",
                "e535ce0d.e1eac"
            ]
        ]
    },
    {
        "id": "b063fa53.89a488",
        "type": "switch",
        "z": "38894af.7ca61b6",
        "name": "Doorbell Selector",
        "property": "event_type",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "doorbird_front_door_relay",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "doorbird_back_door_relay",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "doorbird_side_entry_relay",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 3,
        "x": 610,
        "y": 1720,
        "wires": [
            [
                "56c45731.cc29a8"
            ],
            [
                "e44d7fc5.c8fa7"
            ],
            [
                "675e086e.aa44a8"
            ]
        ]
    },
    {
        "id": "56c45731.cc29a8",
        "type": "api-call-service",
        "z": "38894af.7ca61b6",
        "name": "Unlock Front Door",
        "server": "144427d5.6c9f18",
        "service_domain": "lock",
        "service": "unlock",
        "data": "{\"entity_id\":\"lock.front_door\"}",
        "mergecontext": "",
        "output_location": "payload",
        "output_location_type": "msg",
        "x": 890,
        "y": 1680,
        "wires": [
            [
                "152743ce.45ad9c"
            ]
        ]
    },
    {
        "id": "e44d7fc5.c8fa7",
        "type": "api-call-service",
        "z": "38894af.7ca61b6",
        "name": "Unlock Back Door",
        "server": "144427d5.6c9f18",
        "service_domain": "lock",
        "service": "unlock",
        "data": "{\"entity_id\":\"lock.back_door\"}",
        "mergecontext": "",
        "output_location": "payload",
        "output_location_type": "msg",
        "x": 890,
        "y": 1720,
        "wires": [
            [
                "152743ce.45ad9c"
            ]
        ]
    },
    {
        "id": "675e086e.aa44a8",
        "type": "api-call-service",
        "z": "38894af.7ca61b6",
        "name": "Unlock Side Entry",
        "server": "144427d5.6c9f18",
        "service_domain": "lock",
        "service": "unlock",
        "data": "{\"entity_id\":\"lock.side_entry\"}",
        "mergecontext": "",
        "output_location": "payload",
        "output_location_type": "msg",
        "x": 890,
        "y": 1760,
        "wires": [
            [
                "152743ce.45ad9c"
            ]
        ]
    },
    {
        "id": "553988c1.e16418",
        "type": "link out",
        "z": "38894af.7ca61b6",
        "name": "Doorbell Relay Notifications",
        "links": [
            "259dc6d8.29a85a",
            "3ba4aeb7.ee1e12",
            "58dfbc1f.ec9674"
        ],
        "x": 1175,
        "y": 1760,
        "wires": []
    },
    {
        "id": "152743ce.45ad9c",
        "type": "function",
        "z": "38894af.7ca61b6",
        "name": "Doorbell Identifier",
        "func": "var map = {\n    doorbird_back_door_relay: \"back door\",\n    doorbird_front_door_relay: \"front door\",\n    doorbird_side_entry_relay: \"side door\",\n}\n\nmsg.data = {\n    door_name: map[msg.event_type]\n}\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 1150,
        "y": 1680,
        "wires": [
            [
                "7f154ef.c9375b"
            ]
        ]
    },
    {
        "id": "7f154ef.c9375b",
        "type": "function",
        "z": "38894af.7ca61b6",
        "name": "Set Message",
        "func": "doorbellMessages = [\n    'The ' + msg.data.door_name + ' was unlocked via Doorbird app.'\n]\n\nreturn {\n    payload: {\n        data: {\n            message: doorbellMessages[Math.floor(Math.random()*doorbellMessages.length)],\n            data: {\n                \"thread-id\": 'doorbell-notification'\n            }\n        }\n    }\n};",
        "outputs": 1,
        "noerr": 0,
        "x": 1150,
        "y": 1720,
        "wires": [
            [
                "553988c1.e16418"
            ]
        ]
    },
    {
        "id": "e535ce0d.e1eac",
        "type": "debug",
        "z": "38894af.7ca61b6",
        "name": "Doorbell Relay Events",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "x": 640,
        "y": 1800,
        "wires": []
    },
    {
        "id": "98f079c4.373d6",
        "type": "inject",
        "z": "76250bd8.6dba94",
        "name": "",
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 200,
        "y": 360,
        "wires": [
            [
                "20829d14.a77f42",
                "1a2a73d0.b6f47c"
            ]
        ]
    },
    {
        "id": "348d34cd.5a22cc",
        "type": "geofence",
        "z": "cb6f2b8f.2124b8",
        "name": "Extended Away Boundary",
        "mode": "circle",
        "inside": "both",
        "rad": 254979.93116431482,
        "points": [],
        "centre": {
            "latitude": 35.871246850027966,
            "longitude": -88.76953125
        },
        "x": 410,
        "y": 1160,
        "wires": [
            [
                "29515c43.e6c2e4",
                "71c7cb5c.b89764"
            ]
        ]
    },
    {
        "id": "ac8f34d.f0dadc8",
        "type": "mqtt in",
        "z": "38894af.7ca61b6",
        "name": "MQTT Status",
        "topic": "gpio/+/input/smoke",
        "qos": "0",
        "broker": "1f84a57d.10775b",
        "x": 130,
        "y": 120,
        "wires": [
            [
                "fe7ad4b4.755658"
            ]
        ]
    },
    {
        "id": "fe7ad4b4.755658",
        "type": "switch",
        "z": "38894af.7ca61b6",
        "name": "Not OK",
        "property": "payload",
        "propertyType": "msg",
        "rules": [
            {
                "t": "neq",
                "v": "OK",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 300,
        "y": 120,
        "wires": [
            [
                "4cdd2835.d7e4e8"
            ]
        ]
    },
    {
        "id": "7defccea.1409e4",
        "type": "mqtt in",
        "z": "38894af.7ca61b6",
        "name": "Upstairs GPIO Status",
        "topic": "gpio/upstairs/status",
        "qos": "1",
        "broker": "1f84a57d.10775b",
        "x": 180,
        "y": 2260,
        "wires": [
            [
                "62cbaf94.91941"
            ]
        ]
    },
    {
        "id": "78a4126f.c0bb4c",
        "type": "mqtt in",
        "z": "38894af.7ca61b6",
        "name": "Downstairs GPIO Status",
        "topic": "gpio/downstairs/status",
        "qos": "1",
        "broker": "1f84a57d.10775b",
        "x": 170,
        "y": 2340,
        "wires": [
            [
                "62cbaf94.91941"
            ]
        ]
    },
    {
        "id": "88ac9186.e649f",
        "type": "function",
        "z": "38894af.7ca61b6",
        "name": "Set Message",
        "func": "return {\n    payload: {\n        data: {\n            message: msg.topic,\n            title: \"GPIO server is offline\",\n            data: {\n                \"thread-id\": 'gpio-server-alert'\n            }\n        }\n    }\n};",
        "outputs": 1,
        "noerr": 0,
        "x": 670,
        "y": 2300,
        "wires": [
            [
                "9a1b5a6f.701c08"
            ]
        ]
    },
    {
        "id": "9a1b5a6f.701c08",
        "type": "link out",
        "z": "38894af.7ca61b6",
        "name": "GPIO Server Status",
        "links": [
            "259dc6d8.29a85a",
            "58dfbc1f.ec9674"
        ],
        "x": 855,
        "y": 2300,
        "wires": []
    },
    {
        "id": "62cbaf94.91941",
        "type": "switch",
        "z": "38894af.7ca61b6",
        "name": "Filter Offline Message",
        "property": "payload",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "dead",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 420,
        "y": 2300,
        "wires": [
            [
                "88ac9186.e649f"
            ]
        ]
    },
    {
        "id": "1c02977b.1a6229",
        "type": "comment",
        "z": "38894af.7ca61b6",
        "name": "Notify on GPIO Server Offline",
        "info": "",
        "x": 180,
        "y": 2220,
        "wires": []
    },
    {
        "id": "516bdc24.776f54",
        "type": "server-state-changed",
        "z": "cb6f2b8f.2124b8",
        "name": "Alydia Location Updates",
        "server": "144427d5.6c9f18",
        "version": "1",
        "entityidfilter": "person.alydia",
        "entityidfiltertype": "exact",
        "outputinitially": false,
        "state_type": "str",
        "haltifstate": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "outputs": 1,
        "output_only_on_state_change": true,
        "x": 150,
        "y": 1400,
        "wires": [
            [
                "e3125103.7c53b"
            ]
        ]
    },
    {
        "id": "88d2bc3.18d424",
        "type": "function",
        "z": "cb6f2b8f.2124b8",
        "name": "Build Notification",
        "func": "\nmsg = {\n    payload: {\n        data: {\n            message: \"Alydia has left \" + msg.data.old_state.state\n        }\n    }\n}\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 690,
        "y": 1400,
        "wires": [
            [
                "a6aa9ecc.fbb3b",
                "a75837e9.2c7bb8"
            ]
        ]
    },
    {
        "id": "a6aa9ecc.fbb3b",
        "type": "link out",
        "z": "cb6f2b8f.2124b8",
        "name": "Alydia Location Updates",
        "links": [
            "259dc6d8.29a85a"
        ],
        "x": 855,
        "y": 1400,
        "wires": []
    },
    {
        "id": "a75837e9.2c7bb8",
        "type": "debug",
        "z": "cb6f2b8f.2124b8",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "x": 890,
        "y": 1460,
        "wires": []
    },
    {
        "id": "e3125103.7c53b",
        "type": "switch",
        "z": "cb6f2b8f.2124b8",
        "name": "Filter No State Change",
        "property": "data.old_state.state",
        "propertyType": "msg",
        "rules": [
            {
                "t": "neq",
                "v": "not_home",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 420,
        "y": 1400,
        "wires": [
            [
                "e7c673c4.ce299"
            ]
        ]
    },
    {
        "id": "83335282.9ff3",
        "type": "comment",
        "z": "cb6f2b8f.2124b8",
        "name": "",
        "info": "",
        "x": 0,
        "y": 0,
        "wires": []
    },
    {
        "id": "c2db8f8b.1637a",
        "type": "comment",
        "z": "cb6f2b8f.2124b8",
        "name": "Location Notifications",
        "info": "",
        "x": 140,
        "y": 1340,
        "wires": []
    },
    {
        "id": "eaafb760.cb33e8",
        "type": "server-state-changed",
        "z": "cb6f2b8f.2124b8",
        "name": "Matt Location Updates",
        "server": "144427d5.6c9f18",
        "version": "1",
        "entityidfilter": "person.matt",
        "entityidfiltertype": "exact",
        "outputinitially": false,
        "state_type": "str",
        "haltifstate": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "outputs": 1,
        "output_only_on_state_change": true,
        "x": 140,
        "y": 1520,
        "wires": [
            [
                "a869a06a.42448"
            ]
        ]
    },
    {
        "id": "a869a06a.42448",
        "type": "switch",
        "z": "cb6f2b8f.2124b8",
        "name": "Filter No State Change",
        "property": "data.old_state.state",
        "propertyType": "msg",
        "rules": [
            {
                "t": "neq",
                "v": "not_home",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 420,
        "y": 1520,
        "wires": [
            [
                "1d725395.841dbc"
            ]
        ]
    },
    {
        "id": "1d725395.841dbc",
        "type": "function",
        "z": "cb6f2b8f.2124b8",
        "name": "Build Notification",
        "func": "\nmsg = {\n    payload: {\n        data: {\n            message: \"Matt has left \" + msg.data.old_state.state\n        }\n    }\n}\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 670,
        "y": 1520,
        "wires": [
            [
                "54935011.c6859",
                "416ca1e9.aca49"
            ]
        ]
    },
    {
        "id": "416ca1e9.aca49",
        "type": "debug",
        "z": "cb6f2b8f.2124b8",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "x": 890,
        "y": 1580,
        "wires": []
    },
    {
        "id": "54935011.c6859",
        "type": "link out",
        "z": "cb6f2b8f.2124b8",
        "name": "Matt Location Updates",
        "links": [],
        "x": 855,
        "y": 1520,
        "wires": []
    },
    {
        "id": "9a802c3a.14347",
        "type": "delay",
        "z": "90be6c3f.6407",
        "name": "",
        "pauseType": "rate",
        "timeout": "5",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "3",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "x": 1020,
        "y": 580,
        "wires": [
            [
                "b3a9b105.f555c"
            ]
        ]
    },
    {
        "id": "10377e32.1eeb62",
        "type": "api-call-service",
        "z": "30c7e5fd.18228a",
        "name": "Living Room TV Off",
        "server": "144427d5.6c9f18",
        "service_domain": "media_player",
        "service": "turn_off",
        "data": "{\"entity_id\":\"media_player.living_room_tv\"}",
        "mergecontext": "",
        "output_location": "payload",
        "output_location_type": "msg",
        "x": 810,
        "y": 780,
        "wires": [
            []
        ]
    },
    {
        "id": "9483a989.c99918",
        "type": "api-call-service",
        "z": "30c7e5fd.18228a",
        "name": "Playroom TV Off",
        "server": "144427d5.6c9f18",
        "service_domain": "media_player",
        "service": "turn_off",
        "data": "{\"entity_id\":\"media_player.playroom_tv\"}",
        "mergecontext": "",
        "output_location": "payload",
        "output_location_type": "msg",
        "mustacheAltTags": false,
        "x": 420,
        "y": 840,
        "wires": [
            []
        ]
    },
    {
        "id": "69afe425.242f1c",
        "type": "http in",
        "z": "47267ef8.fca6f",
        "name": "Sonar Episode Webhook",
        "url": "/sonar-episode",
        "method": "post",
        "upload": false,
        "swaggerDoc": "",
        "x": 260,
        "y": 1000,
        "wires": [
            [
                "59167bdf.4288d4",
                "45c315f3.c18cdc"
            ]
        ]
    },
    {
        "id": "59167bdf.4288d4",
        "type": "debug",
        "z": "47267ef8.fca6f",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "x": 540,
        "y": 1000,
        "wires": []
    },
    {
        "id": "45c315f3.c18cdc",
        "type": "http response",
        "z": "47267ef8.fca6f",
        "name": "Success Response",
        "statusCode": "200",
        "headers": {},
        "x": 460,
        "y": 940,
        "wires": []
    },
    {
        "id": "dace7edc.697a6",
        "type": "api-current-state",
        "z": "47267ef8.fca6f",
        "name": "Vacuum Running?",
        "server": "144427d5.6c9f18",
        "outputs": 2,
        "halt_if": "cleaning",
        "halt_if_type": "str",
        "halt_if_compare": "is_not",
        "override_topic": false,
        "entity_id": "vacuum.rosie",
        "state_type": "str",
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "x": 470,
        "y": 860,
        "wires": [
            [
                "127b3223.3fd84e"
            ],
            []
        ]
    },
    {
        "id": "127b3223.3fd84e",
        "type": "api-call-service",
        "z": "47267ef8.fca6f",
        "name": "Pause Cleaning",
        "server": "144427d5.6c9f18",
        "service_domain": "vacuum",
        "service": "return_to_base",
        "data": "{\"entity_id\":\"vacuum.rosie\"}",
        "mergecontext": "",
        "output_location": "payload",
        "output_location_type": "msg",
        "x": 720,
        "y": 860,
        "wires": [
            []
        ]
    },
    {
        "id": "b3a9b105.f555c",
        "type": "string",
        "z": "90be6c3f.6407",
        "name": "Speech Therapy",
        "methods": [
            {
                "name": "replaceAll",
                "params": [
                    {
                        "type": "str",
                        "value": "Alydia"
                    },
                    {
                        "type": "str",
                        "value": "uh-lydia"
                    }
                ]
            }
        ],
        "prop": "payload",
        "propout": "payload",
        "object": "msg",
        "objectout": "msg",
        "x": 1020,
        "y": 620,
        "wires": [
            [
                "17a5f4ab.a80c8b"
            ]
        ]
    },
    {
        "id": "7e6cf690.b22898",
        "type": "server-state-changed",
        "z": "76250bd8.6dba94",
        "name": "Alexa Handler - Nintendo",
        "server": "144427d5.6c9f18",
        "entityidfilter": "input_boolean.alexa_nintendo",
        "entityidfiltertype": "exact",
        "outputinitially": false,
        "state_type": "str",
        "haltifstate": "off",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "outputs": 2,
        "output_only_on_state_change": false,
        "x": 190,
        "y": 560,
        "wires": [
            [
                "f01e407c.0cabb",
                "6a44db71.48b104"
            ],
            []
        ]
    },
    {
        "id": "f01e407c.0cabb",
        "type": "api-call-service",
        "z": "76250bd8.6dba94",
        "name": "Turn On TV",
        "server": "144427d5.6c9f18",
        "service_domain": "media_player",
        "service": "turn_on",
        "data": "{\"entity_id\":\"media_player.living_room_tv\"}",
        "mergecontext": "",
        "output_location": "payload",
        "output_location_type": "msg",
        "x": 450,
        "y": 560,
        "wires": [
            []
        ]
    },
    {
        "id": "6a44db71.48b104",
        "type": "delay",
        "z": "76250bd8.6dba94",
        "name": "Delay 5s",
        "pauseType": "delay",
        "timeout": "5",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "x": 440,
        "y": 600,
        "wires": [
            [
                "6bef3a66.3e7c04"
            ]
        ]
    },
    {
        "id": "6bef3a66.3e7c04",
        "type": "api-call-service",
        "z": "76250bd8.6dba94",
        "name": "Set TV to HDMI 4",
        "server": "144427d5.6c9f18",
        "service_domain": "media_player",
        "service": "play_media",
        "data": "{\"entity_id\":\"media_player.playroom_tv\",\"media_content_id\":\"HDMI 4\",\"media_content_type\":\"channel\"}",
        "mergecontext": "",
        "output_location": "payload",
        "output_location_type": "msg",
        "x": 710,
        "y": 600,
        "wires": [
            []
        ]
    },
    {
        "id": "5d446861.be44a8",
        "type": "link out",
        "z": "51c810f0.59ce1",
        "name": "iOS Action - Reset Bedtime Notifications",
        "links": [
            "86816ef5.de3a2"
        ],
        "x": 575,
        "y": 140,
        "wires": []
    },
    {
        "id": "86816ef5.de3a2",
        "type": "link in",
        "z": "b55ab74c.698a88",
        "name": "Handler - Reset Bedtime Notifications",
        "links": [
            "5d446861.be44a8"
        ],
        "x": 235,
        "y": 1080,
        "wires": [
            [
                "9696479c.1845c8"
            ]
        ]
    },
    {
        "id": "64a8746b.12c49c",
        "type": "inject",
        "z": "b55ab74c.698a88",
        "name": "Automatic Saturday Cartoons",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "00 07 * * 6",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 190,
        "y": 1340,
        "wires": [
            [
                "71184d29.7c27c4",
                "47f92887.700918"
            ]
        ]
    },
    {
        "id": "71184d29.7c27c4",
        "type": "api-call-service",
        "z": "b55ab74c.698a88",
        "name": "Turn On TV",
        "server": "144427d5.6c9f18",
        "service_domain": "media_player",
        "service": "turn_on",
        "data": "{\"entity_id\":\"media_player.playroom_tv\"}",
        "mergecontext": "",
        "output_location": "payload",
        "output_location_type": "msg",
        "mustacheAltTags": false,
        "x": 510,
        "y": 1340,
        "wires": [
            []
        ]
    },
    {
        "id": "47f92887.700918",
        "type": "delay",
        "z": "b55ab74c.698a88",
        "name": "Delay 5s",
        "pauseType": "delay",
        "timeout": "5",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "x": 500,
        "y": 1380,
        "wires": [
            [
                "ace00934.560fe8"
            ]
        ]
    },
    {
        "id": "ace00934.560fe8",
        "type": "api-call-service",
        "z": "b55ab74c.698a88",
        "name": "Set TV to HDMI 4",
        "server": "144427d5.6c9f18",
        "service_domain": "media_player",
        "service": "play_media",
        "data": "{\"entity_id\":\"media_player.playroom_tv\",\"media_content_id\":\"HDMI 4\",\"media_content_type\":\"channel\"}",
        "mergecontext": "",
        "output_location": "payload",
        "output_location_type": "msg",
        "mustacheAltTags": false,
        "x": 770,
        "y": 1380,
        "wires": [
            []
        ]
    },
    {
        "id": "e7c673c4.ce299",
        "type": "switch",
        "z": "cb6f2b8f.2124b8",
        "name": "Filter Leaving Home",
        "property": "data.old_state.state",
        "propertyType": "msg",
        "rules": [
            {
                "t": "neq",
                "v": "home",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 440,
        "y": 1440,
        "wires": [
            [
                "88d2bc3.18d424"
            ]
        ]
    },
    {
        "id": "936ba4b4.ddcab8",
        "type": "debug",
        "z": "eee3c0c3.7c7bd",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "x": 450,
        "y": 1260,
        "wires": []
    },
    {
        "id": "6b56f9ee.dfe958",
        "type": "inject",
        "z": "b55ab74c.698a88",
        "name": "Wake Up Event",
        "repeat": "",
        "crontab": "00 07 * * *",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 180,
        "y": 140,
        "wires": [
            [
                "131e7424.b4238c"
            ]
        ]
    },
    {
        "id": "80ebe21a.18d31",
        "type": "api-call-service",
        "z": "b55ab74c.698a88",
        "name": "All Night Lights to Green",
        "server": "144427d5.6c9f18",
        "service_domain": "light",
        "service": "turn_on",
        "data": "{\"entity_id\":\"light.ava_s_lamp,light.lynley_s_lamp\",\"rgb_color\":[0,5,0],\"brightness\":50}",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 470,
        "y": 340,
        "wires": [
            []
        ]
    },
    {
        "id": "20718fb4.4fc6c",
        "type": "comment",
        "z": "b55ab74c.698a88",
        "name": "Wakeup Lamp Notification",
        "info": "",
        "x": 470,
        "y": 300,
        "wires": []
    },
    {
        "id": "5ab61840.8063c8",
        "type": "delay",
        "z": "b55ab74c.698a88",
        "name": "Delay 30s",
        "pauseType": "delay",
        "timeout": "30",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "x": 440,
        "y": 620,
        "wires": [
            [
                "291c9f48.926d4"
            ]
        ]
    },
    {
        "id": "7e80806f.8b82a",
        "type": "api-call-service",
        "z": "b55ab74c.698a88",
        "name": "Ava's Lamp to Pink",
        "server": "144427d5.6c9f18",
        "service_domain": "light",
        "service": "turn_on",
        "data": "{\"entity_id\":\"light.ava_s_lamp\",\"rgb_color\":[255,0,80],\"brightness\":5,\"white_value\":0}",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 690,
        "y": 540,
        "wires": [
            []
        ]
    },
    {
        "id": "19189187.276f5e",
        "type": "function",
        "z": "b55ab74c.698a88",
        "name": "Toggler",
        "func": "var flag = flow.get('nightlight_toggle_flag') || 0;\n\nif(flag) {\n    flow.set('nightlight_toggle_flag', 0)\n    return [{}, null]\n}\nflow.set('nightlight_toggle_flag', 1)\n\nreturn [null, {}];",
        "outputs": 2,
        "noerr": 0,
        "x": 440,
        "y": 520,
        "wires": [
            [
                "5ab61840.8063c8",
                "e1eebd26.a0677"
            ],
            [
                "7e80806f.8b82a",
                "5ab61840.8063c8"
            ]
        ]
    },
    {
        "id": "e1eebd26.a0677",
        "type": "api-call-service",
        "z": "b55ab74c.698a88",
        "name": "Ava's Lamp to Blue",
        "server": "144427d5.6c9f18",
        "service_domain": "light",
        "service": "turn_on",
        "data": "{\"entity_id\":\"light.ava_s_lamp\",\"rgb_color\":[0,0,255],\"brightness\":5,\"white_value\":0}",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": true,
        "x": 690,
        "y": 480,
        "wires": [
            []
        ]
    },
    {
        "id": "6ea9c5cc.e2cb3c",
        "type": "switch",
        "z": "eee3c0c3.7c7bd",
        "name": "Exclude Specific Lights",
        "property": "topic",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "light.backyard_tree_led",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "light.lynley_s_lamp",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "light.ava_s_lamp",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "false",
        "repair": false,
        "outputs": 4,
        "x": 470,
        "y": 1320,
        "wires": [
            [],
            [],
            [],
            [
                "63cca837.6b1d58"
            ]
        ]
    },
    {
        "id": "291c9f48.926d4",
        "type": "api-current-state",
        "z": "b55ab74c.698a88",
        "name": "Sleep Mode Check",
        "server": "144427d5.6c9f18",
        "version": 1,
        "outputs": 2,
        "halt_if": "on",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "override_topic": false,
        "entity_id": "input_boolean.kids_sleep_mode",
        "state_type": "str",
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "blockInputOverrides": false,
        "x": 710,
        "y": 640,
        "wires": [
            [
                "19189187.276f5e"
            ],
            [
                "f650f317.57b12"
            ]
        ]
    },
    {
        "id": "f0f14115.0639b",
        "type": "server-state-changed",
        "z": "b55ab74c.698a88",
        "name": "Kid's Sleep Mode Enabled",
        "server": "144427d5.6c9f18",
        "version": 1,
        "entityidfilter": "input_boolean.kids_sleep_mode",
        "entityidfiltertype": "exact",
        "outputinitially": true,
        "state_type": "str",
        "haltifstate": "on",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "outputs": 2,
        "output_only_on_state_change": true,
        "x": 130,
        "y": 500,
        "wires": [
            [
                "c69c9e5a.02ca1",
                "5dcab7a1.0efda8",
                "3c66d6b3.02d35a"
            ],
            [
                "80ebe21a.18d31",
                "2c6bef29.61949",
                "2ccdcb20.d85f24"
            ]
        ]
    },
    {
        "id": "b63857.89bbf7a8",
        "type": "api-call-service",
        "z": "b55ab74c.698a88",
        "name": "Enable Kid's Sleep Mode",
        "server": "144427d5.6c9f18",
        "service_domain": "input_boolean",
        "service": "turn_on",
        "data": "{\"entity_id\":\"input_boolean.kids_sleep_mode\"}",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 430,
        "y": 180,
        "wires": [
            []
        ]
    },
    {
        "id": "ac85d0a0.52f1d",
        "type": "inject",
        "z": "b55ab74c.698a88",
        "name": "Weekday Bedtime Event",
        "repeat": "",
        "crontab": "30 19 * * 1,2,3,4,0",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 150,
        "y": 180,
        "wires": [
            [
                "b63857.89bbf7a8"
            ]
        ]
    },
    {
        "id": "ccfb78c1.c490f8",
        "type": "inject",
        "z": "b55ab74c.698a88",
        "name": "Weekend Bedtime Event",
        "repeat": "",
        "crontab": "30 20 * * 5,6",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 150,
        "y": 220,
        "wires": [
            [
                "b63857.89bbf7a8"
            ]
        ]
    },
    {
        "id": "3749ef6b.fb95f",
        "type": "comment",
        "z": "b55ab74c.698a88",
        "name": "Kid's Sleep Mode",
        "info": "",
        "x": 170,
        "y": 100,
        "wires": []
    },
    {
        "id": "2c6bef29.61949",
        "type": "function",
        "z": "b55ab74c.698a88",
        "name": "Reset Bedtime Event",
        "func": "flow.set('bedtime_event_fired', false);\n",
        "outputs": 1,
        "noerr": 0,
        "x": 440,
        "y": 400,
        "wires": [
            []
        ]
    },
    {
        "id": "78b9a3fd.0e6ddc",
        "type": "comment",
        "z": "b55ab74c.698a88",
        "name": "Nightlight Color Loop",
        "info": "",
        "x": 440,
        "y": 460,
        "wires": []
    },
    {
        "id": "131e7424.b4238c",
        "type": "api-call-service",
        "z": "b55ab74c.698a88",
        "name": "Disable Kid's Sleep Mode",
        "server": "144427d5.6c9f18",
        "service_domain": "input_boolean",
        "service": "turn_off",
        "data": "{\"entity_id\":\"input_boolean.kids_sleep_mode\"}",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 430,
        "y": 140,
        "wires": [
            []
        ]
    },
    {
        "id": "2f876162.bdbe3e",
        "type": "comment",
        "z": "b55ab74c.698a88",
        "name": "Automatic Cartoons on Saturday",
        "info": "",
        "x": 190,
        "y": 1300,
        "wires": []
    },
    {
        "id": "4cc3539d.2cac5c",
        "type": "api-current-state",
        "z": "90be6c3f.6407",
        "name": "Halt if Away Without Guest",
        "server": "144427d5.6c9f18",
        "version": 1,
        "outputs": 2,
        "halt_if": "on",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "override_topic": false,
        "entity_id": "sensor.away_without_guest",
        "state_type": "str",
        "state_location": "",
        "override_payload": "none",
        "entity_location": "",
        "override_data": "none",
        "blockInputOverrides": false,
        "x": 1060,
        "y": 540,
        "wires": [
            [],
            [
                "9a802c3a.14347"
            ]
        ]
    },
    {
        "id": "e7a51a9d.adf8b8",
        "type": "comment",
        "z": "47267ef8.fca6f",
        "name": "Playroom TV Volume Limiter",
        "info": "",
        "x": 220,
        "y": 100,
        "wires": []
    },
    {
        "id": "41151a14.e348e4",
        "type": "api-call-service",
        "z": "47267ef8.fca6f",
        "name": "Set Playroom TV Volume Level",
        "server": "144427d5.6c9f18",
        "service_domain": "media_player",
        "service": "volume_set",
        "data": "{\"entity_id\":\"media_player.playroom_tv\",\"volume_level\":0.3}",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 1050,
        "y": 180,
        "wires": [
            []
        ]
    },
    {
        "id": "360299a4.5b5516",
        "type": "inject",
        "z": "47267ef8.fca6f",
        "name": "Poll Every 30s",
        "repeat": "30",
        "crontab": "",
        "once": true,
        "onceDelay": "1",
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 180,
        "y": 180,
        "wires": [
            [
                "e996674a.6da0c8"
            ]
        ]
    },
    {
        "id": "e996674a.6da0c8",
        "type": "ha-get-entities",
        "z": "47267ef8.fca6f",
        "server": "144427d5.6c9f18",
        "name": "Get Volume Level",
        "rules": [
            {
                "property": "attributes.volume_level",
                "logic": "gt",
                "value": "0.3",
                "valueType": "num"
            },
            {
                "property": "entity_id",
                "logic": "is",
                "value": "media_player.playroom_tv",
                "valueType": "str"
            }
        ],
        "output_type": "count",
        "output_empty_results": false,
        "output_location_type": "msg",
        "output_location": "payload",
        "output_results_count": 1,
        "x": 390,
        "y": 180,
        "wires": [
            [
                "88bf9f76.8b626"
            ]
        ]
    },
    {
        "id": "7993ea50.664c94",
        "type": "api-current-state",
        "z": "47267ef8.fca6f",
        "name": "Limiter Enabled",
        "server": "144427d5.6c9f18",
        "version": 1,
        "outputs": 2,
        "halt_if": "on",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "override_topic": false,
        "entity_id": "input_boolean.limit_playroom_tv_volume",
        "state_type": "str",
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "blockInputOverrides": false,
        "x": 800,
        "y": 180,
        "wires": [
            [
                "41151a14.e348e4",
                "1c2c60a7.8da5af"
            ],
            []
        ]
    },
    {
        "id": "7ac33f9f.1276",
        "type": "link out",
        "z": "47267ef8.fca6f",
        "name": "",
        "links": [
            "259dc6d8.29a85a",
            "26219430.1853ec"
        ],
        "x": 1255,
        "y": 140,
        "wires": []
    },
    {
        "id": "1c2c60a7.8da5af",
        "type": "function",
        "z": "47267ef8.fca6f",
        "name": "Build Notification",
        "func": "return {\n    payload: {\n        data: {\n            title: \"Volume Alert\",\n            message: \"The playroom TV is too loud. Volume will be set to an acceptable level.\",\n        }\n    }\n};",
        "outputs": 1,
        "noerr": 0,
        "x": 1010,
        "y": 140,
        "wires": [
            [
                "7ac33f9f.1276"
            ]
        ]
    },
    {
        "id": "88bf9f76.8b626",
        "type": "switch",
        "z": "47267ef8.fca6f",
        "name": "Volume Is Too Loud",
        "property": "payload",
        "propertyType": "msg",
        "rules": [
            {
                "t": "gt",
                "v": "0",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 610,
        "y": 180,
        "wires": [
            [
                "7993ea50.664c94"
            ]
        ]
    },
    {
        "id": "3a3e412f.1fd2fe",
        "type": "server-events",
        "z": "3e9522c6.d11e1e",
        "name": "Side Entry Doorbell",
        "server": "144427d5.6c9f18",
        "event_type": "doorbird_side_entry_doorbell",
        "x": 370,
        "y": 220,
        "wires": [
            [
                "9bf1aa85.7499c8"
            ]
        ]
    },
    {
        "id": "ddc216ae.df3968",
        "type": "server-events",
        "z": "3e9522c6.d11e1e",
        "name": "Back Door Doorbell",
        "server": "144427d5.6c9f18",
        "event_type": "doorbird_back_door_doorbell",
        "x": 370,
        "y": 280,
        "wires": [
            [
                "9bf1aa85.7499c8"
            ]
        ]
    },
    {
        "id": "296bcfe0.fbf72",
        "type": "function",
        "z": "2061740e.e5207c",
        "name": "",
        "func": "msg = new Date();\n\nreturn msg",
        "outputs": 1,
        "noerr": 0,
        "x": 360,
        "y": 440,
        "wires": [
            [
                "82b74e50.9c7b4"
            ]
        ]
    },
    {
        "id": "82b74e50.9c7b4",
        "type": "debug",
        "z": "2061740e.e5207c",
        "name": "",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "x": 560,
        "y": 440,
        "wires": []
    },
    {
        "id": "d9dcefd9.2dc2b",
        "type": "inject",
        "z": "2061740e.e5207c",
        "name": "",
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 120,
        "y": 420,
        "wires": [
            [
                "296bcfe0.fbf72"
            ]
        ]
    },
    {
        "id": "7933ead2.b923f4",
        "type": "server-state-changed",
        "z": "f5c459c0.3bf568",
        "name": "PiHole Enabled",
        "server": "144427d5.6c9f18",
        "version": 1,
        "entityidfilter": "input_boolean.pihole_enabled",
        "entityidfiltertype": "exact",
        "outputinitially": false,
        "state_type": "str",
        "haltifstate": "on",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "outputs": 2,
        "output_only_on_state_change": true,
        "x": 120,
        "y": 200,
        "wires": [
            [
                "a94469b2.2fa298"
            ],
            [
                "e3376fc1.0b688",
                "f308979f.63c878"
            ]
        ]
    },
    {
        "id": "e3376fc1.0b688",
        "type": "api-call-service",
        "z": "f5c459c0.3bf568",
        "name": "Disable PiHole (1m)",
        "server": "144427d5.6c9f18",
        "service_domain": "pi_hole",
        "service": "disable",
        "data": "{\"duration\":\"00:01:10\"}",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 390,
        "y": 300,
        "wires": [
            []
        ]
    },
    {
        "id": "f308979f.63c878",
        "type": "delay",
        "z": "f5c459c0.3bf568",
        "name": "",
        "pauseType": "delay",
        "timeout": "1",
        "timeoutUnits": "minutes",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "x": 360,
        "y": 220,
        "wires": [
            [
                "e0dfbcd6.94fc5"
            ]
        ]
    },
    {
        "id": "a94469b2.2fa298",
        "type": "api-call-service",
        "z": "f5c459c0.3bf568",
        "name": "Enable PiHole",
        "server": "144427d5.6c9f18",
        "service_domain": "pi_hole",
        "service": "enable",
        "data": "",
        "mergecontext": "",
        "output_location": "payload",
        "output_location_type": "msg",
        "mustacheAltTags": false,
        "x": 560,
        "y": 160,
        "wires": [
            []
        ]
    },
    {
        "id": "bd6e765.d85e188",
        "type": "comment",
        "z": "f5c459c0.3bf568",
        "name": "Temporarily Disable PiHole",
        "info": "",
        "x": 150,
        "y": 140,
        "wires": []
    },
    {
        "id": "e0dfbcd6.94fc5",
        "type": "api-call-service",
        "z": "f5c459c0.3bf568",
        "name": "Toggle Switch",
        "server": "144427d5.6c9f18",
        "service_domain": "input_boolean",
        "service": "turn_on",
        "data": "{\"entity_id\":\"input_boolean.pihole_enabled\"}",
        "mergecontext": "",
        "output_location": "payload",
        "output_location_type": "msg",
        "mustacheAltTags": false,
        "x": 560,
        "y": 220,
        "wires": [
            []
        ]
    },
    {
        "id": "f86184ea.4025f8",
        "type": "comment",
        "z": "3e9522c6.d11e1e",
        "name": "Dahua Camera Events",
        "info": "",
        "x": 180,
        "y": 580,
        "wires": []
    },
    {
        "id": "6c94f898.e42f58",
        "type": "server-state-changed",
        "z": "30c7e5fd.18228a",
        "name": "Vacuum Error Notification",
        "server": "144427d5.6c9f18",
        "version": 1,
        "entityidfilter": "vacuum.rosie",
        "entityidfiltertype": "exact",
        "outputinitially": true,
        "state_type": "str",
        "haltifstate": "Error",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "outputs": 2,
        "output_only_on_state_change": true,
        "x": 190,
        "y": 1320,
        "wires": [
            [
                "6ef0db2e.ce1ea4"
            ],
            []
        ]
    },
    {
        "id": "6ef0db2e.ce1ea4",
        "type": "function",
        "z": "30c7e5fd.18228a",
        "name": "Set Message",
        "func": "return {\n    payload: {\n        data: {\n            title: \"Vacuum Error!\",\n            message: 'The vacuum has reported an error. ' + msg.data.new_state.attributes.error\n        }\n    }\n};",
        "outputs": 1,
        "noerr": 0,
        "x": 410,
        "y": 1320,
        "wires": [
            [
                "3f1cb6f.d64444a"
            ]
        ]
    },
    {
        "id": "3f1cb6f.d64444a",
        "type": "link out",
        "z": "30c7e5fd.18228a",
        "name": "Vacuum Errors",
        "links": [
            "259dc6d8.29a85a",
            "3c513bc.a5aa8c4",
            "58dfbc1f.ec9674",
            "66e43dcb.363604",
            "b5c2d8b0.9a59d8",
            "d7669edc.b8c1",
            "d88ae7ad.72c5b8"
        ],
        "x": 535,
        "y": 1320,
        "wires": []
    },
    {
        "id": "cfafe662.267d28",
        "type": "comment",
        "z": "30c7e5fd.18228a",
        "name": "Vacuum Error Notifications",
        "info": "",
        "x": 190,
        "y": 1280,
        "wires": []
    },
    {
        "id": "9c8b9999.d31c98",
        "type": "server-state-changed",
        "z": "b55ab74c.698a88",
        "name": "Nap Time Enabled",
        "server": "144427d5.6c9f18",
        "version": 1,
        "entityidfilter": "input_boolean.nap_time",
        "entityidfiltertype": "exact",
        "outputinitially": false,
        "state_type": "str",
        "haltifstate": "on",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "outputs": 2,
        "output_only_on_state_change": true,
        "x": 170,
        "y": 560,
        "wires": [
            [
                "19189187.276f5e",
                "ad3b692b.fbf3a8",
                "3c66d6b3.02d35a"
            ],
            [
                "80ebe21a.18d31",
                "1ae9577f.444509"
            ]
        ]
    },
    {
        "id": "f650f317.57b12",
        "type": "api-current-state",
        "z": "b55ab74c.698a88",
        "name": "Nap Time Check",
        "server": "144427d5.6c9f18",
        "version": 1,
        "outputs": 2,
        "halt_if": "on",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "override_topic": false,
        "entity_id": "input_boolean.nap_time",
        "state_type": "str",
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "blockInputOverrides": true,
        "x": 970,
        "y": 640,
        "wires": [
            [
                "19189187.276f5e"
            ],
            []
        ]
    },
    {
        "id": "ad3b692b.fbf3a8",
        "type": "delay",
        "z": "b55ab74c.698a88",
        "name": "Delay 30s",
        "pauseType": "delay",
        "timeout": "90",
        "timeoutUnits": "minutes",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "x": 400,
        "y": 740,
        "wires": [
            [
                "61c52e16.ec04d"
            ]
        ]
    },
    {
        "id": "61c52e16.ec04d",
        "type": "api-call-service",
        "z": "b55ab74c.698a88",
        "name": "Auto Disable Nap Time",
        "server": "144427d5.6c9f18",
        "service_domain": "switch",
        "service": "turn_off",
        "data": "{\"entity_id\":\"input_boolean.nap_time\"}",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 730,
        "y": 740,
        "wires": [
            []
        ]
    },
    {
        "id": "aed7fd4c.32e2a",
        "type": "mqtt in",
        "z": "3e9522c6.d11e1e",
        "name": "Camera Events",
        "topic": "dahua/#",
        "qos": "2",
        "datatype": "auto",
        "broker": "1f84a57d.10775b",
        "x": 160,
        "y": 640,
        "wires": [
            [
                "1e51317b.9ff15f",
                "777a88d3.69f618"
            ]
        ]
    },
    {
        "id": "1e51317b.9ff15f",
        "type": "switch",
        "z": "3e9522c6.d11e1e",
        "name": "Router",
        "property": "topic",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "dahua/VideoMotion/side-180",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "dahua/VideoMotion/front-180",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "dahua/CrossLineDetection/side-180",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "dahua/CrossLineDetection/side-180",
                "vt": "str"
            }
        ],
        "checkall": "false",
        "repair": false,
        "outputs": 4,
        "x": 360,
        "y": 640,
        "wires": [
            [
                "17e0e29.827bc1d"
            ],
            [
                "17e0e29.827bc1d"
            ],
            [
                "17e0e29.827bc1d"
            ],
            [
                "17e0e29.827bc1d"
            ]
        ]
    },
    {
        "id": "28c6085.17df4f8",
        "type": "inject",
        "z": "f5c459c0.3bf568",
        "name": "",
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 380,
        "y": 100,
        "wires": [
            [
                "e0dfbcd6.94fc5"
            ]
        ]
    },
    {
        "id": "5dcab7a1.0efda8",
        "type": "api-call-service",
        "z": "b55ab74c.698a88",
        "name": "Turn Off Nap Time",
        "server": "144427d5.6c9f18",
        "service_domain": "input_boolean",
        "service": "turn_off",
        "data": "{\"entity_id\":\"input_boolean.nap_time\"}",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": true,
        "x": 690,
        "y": 400,
        "wires": [
            [
                "c6b3de1.b08082"
            ]
        ]
    },
    {
        "id": "f6ab6bfc.8c7ab8",
        "type": "stoptimer",
        "z": "38894af.7ca61b6",
        "duration": "20",
        "units": "Minute",
        "payloadtype": "num",
        "payloadval": "0",
        "name": "20m Timer",
        "x": 770,
        "y": 700,
        "wires": [
            [
                "53322bd0.9ade94",
                "3cac9dc5.f192f2"
            ],
            []
        ]
    },
    {
        "id": "a4f5259.feac0d8",
        "type": "stoptimer",
        "z": "38894af.7ca61b6",
        "duration": "20",
        "units": "Minute",
        "payloadtype": "num",
        "payloadval": "0",
        "name": "20m Timer",
        "x": 770,
        "y": 740,
        "wires": [
            [
                "53322bd0.9ade94",
                "3cac9dc5.f192f2"
            ],
            []
        ]
    },
    {
        "id": "70969071.357a8",
        "type": "server-state-changed",
        "z": "38894af.7ca61b6",
        "name": "Garage Opened",
        "server": "144427d5.6c9f18",
        "version": 1,
        "entityidfilter": "cover.garage",
        "entityidfiltertype": "substring",
        "outputinitially": false,
        "state_type": "str",
        "haltifstate": "on",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "outputs": 2,
        "output_only_on_state_change": true,
        "x": 340,
        "y": 620,
        "wires": [
            [
                "27fb2179.a7237e",
                "a7dd324a.6bbbc"
            ],
            []
        ]
    },
    {
        "id": "81533b8b.417b48",
        "type": "server-state-changed",
        "z": "38894af.7ca61b6",
        "name": "Garage Closed",
        "server": "144427d5.6c9f18",
        "version": 1,
        "entityidfilter": "cover.garage",
        "entityidfiltertype": "substring",
        "outputinitially": false,
        "state_type": "str",
        "haltifstate": "off",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "outputs": 2,
        "output_only_on_state_change": true,
        "x": 120,
        "y": 740,
        "wires": [
            [
                "ba818cf8.be274"
            ],
            []
        ]
    },
    {
        "id": "3f4c08bf.d21c48",
        "type": "server-state-changed",
        "z": "38894af.7ca61b6",
        "name": "Garage Opened",
        "server": "144427d5.6c9f18",
        "version": 1,
        "entityidfilter": "cover.garage",
        "entityidfiltertype": "substring",
        "outputinitially": false,
        "state_type": "str",
        "haltifstate": "open",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "outputs": 2,
        "output_only_on_state_change": true,
        "x": 140,
        "y": 2620,
        "wires": [
            [
                "1e2c6b1a.f80635"
            ],
            []
        ]
    },
    {
        "id": "78da0843.c742b8",
        "type": "server-state-changed",
        "z": "cb6f2b8f.2124b8",
        "name": "Alydia Home",
        "server": "144427d5.6c9f18",
        "version": 1,
        "entityidfilter": "person.alydia",
        "entityidfiltertype": "exact",
        "outputinitially": false,
        "state_type": "str",
        "haltifstate": "home",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "outputs": 2,
        "output_only_on_state_change": true,
        "x": 150,
        "y": 1720,
        "wires": [
            [
                "75ef658b.4e201c"
            ],
            []
        ]
    },
    {
        "id": "3ca899f9.e71b96",
        "type": "server-state-changed",
        "z": "cb6f2b8f.2124b8",
        "name": "Matt Home",
        "server": "144427d5.6c9f18",
        "version": 1,
        "entityidfilter": "person.matt",
        "entityidfiltertype": "exact",
        "outputinitially": false,
        "state_type": "str",
        "haltifstate": "home",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "outputs": 2,
        "output_only_on_state_change": true,
        "x": 160,
        "y": 1820,
        "wires": [
            [
                "23fdf962.e3eef6"
            ],
            []
        ]
    },
    {
        "id": "3137cf5b.9167c",
        "type": "api-current-state",
        "z": "cb6f2b8f.2124b8",
        "name": "Matt Is Home",
        "server": "144427d5.6c9f18",
        "version": 1,
        "outputs": 2,
        "halt_if": "home",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "override_topic": false,
        "entity_id": "person.matt",
        "state_type": "str",
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "blockInputOverrides": false,
        "x": 620,
        "y": 1740,
        "wires": [
            [
                "7234a4b8.ffdaec"
            ],
            []
        ]
    },
    {
        "id": "9aaa8fe4.12ea4",
        "type": "api-call-service",
        "z": "cb6f2b8f.2124b8",
        "name": "Open Garage Door",
        "server": "144427d5.6c9f18",
        "service_domain": "cover",
        "service": "open_cover",
        "data": "{\"entity_id\":\"cover.garage_1\"}",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 1170,
        "y": 2000,
        "wires": [
            []
        ]
    },
    {
        "id": "4e5f6182.e6fa7",
        "type": "api-current-state",
        "z": "cb6f2b8f.2124b8",
        "name": "Alydia Is Home",
        "server": "144427d5.6c9f18",
        "version": 1,
        "outputs": 2,
        "halt_if": "home",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "override_topic": false,
        "entity_id": "person.alydia",
        "state_type": "str",
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "blockInputOverrides": false,
        "x": 620,
        "y": 1840,
        "wires": [
            [
                "7234a4b8.ffdaec"
            ],
            []
        ]
    },
    {
        "id": "8a80ff7a.c3276",
        "type": "comment",
        "z": "cb6f2b8f.2124b8",
        "name": "Auto Open Garage on Arrival",
        "info": "",
        "x": 160,
        "y": 1680,
        "wires": []
    },
    {
        "id": "98acc3c5.ebcf1",
        "type": "server-state-changed",
        "z": "cb6f2b8f.2124b8",
        "name": "Away Mode Enabled",
        "server": "144427d5.6c9f18",
        "version": 1,
        "entityidfilter": "input_boolean.away_mode",
        "entityidfiltertype": "exact",
        "outputinitially": false,
        "state_type": "str",
        "haltifstate": "on",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "outputs": 2,
        "output_only_on_state_change": true,
        "x": 130,
        "y": 1920,
        "wires": [
            [],
            [
                "76c56268.1f586c"
            ]
        ]
    },
    {
        "id": "71c7cb5c.b89764",
        "type": "or-gate",
        "z": "cb6f2b8f.2124b8",
        "name": "One Inside Boundary",
        "rules": [
            {
                "t": "true",
                "propertyType": "msg",
                "property": "location.inarea",
                "topic": "owntracks/alydia/iphone"
            },
            {
                "t": "true",
                "propertyType": "msg",
                "property": "location.inarea",
                "topic": "owntracks/matt/iphone"
            }
        ],
        "outputTopic": "disable_extended_away",
        "gateType": "or",
        "emitOnlyIfTrue": true,
        "x": 680,
        "y": 1200,
        "wires": [
            [
                "50eb3ecc.3739"
            ]
        ]
    },
    {
        "id": "50eb3ecc.3739",
        "type": "api-current-state",
        "z": "cb6f2b8f.2124b8",
        "name": "Extended Away Eanbled?",
        "server": "144427d5.6c9f18",
        "version": 1,
        "outputs": 2,
        "halt_if": "on",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "override_topic": true,
        "entity_id": "input_boolean.extended_away_mode",
        "state_type": "str",
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "blockInputOverrides": false,
        "x": 950,
        "y": 1200,
        "wires": [
            [
                "ad4b446b.4c9a48",
                "7a4afce1.eceb54"
            ],
            []
        ]
    },
    {
        "id": "69ac16b4.bbc3e8",
        "type": "delay",
        "z": "30c7e5fd.18228a",
        "name": "",
        "pauseType": "delay",
        "timeout": "5",
        "timeoutUnits": "minutes",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "x": 400,
        "y": 460,
        "wires": [
            [
                "4c0ed444.e556ac"
            ]
        ]
    },
    {
        "id": "4c0ed444.e556ac",
        "type": "api-current-state",
        "z": "30c7e5fd.18228a",
        "name": "Sleep Mode Still Off",
        "server": "144427d5.6c9f18",
        "version": 1,
        "outputs": 2,
        "halt_if": "off",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "override_topic": false,
        "entity_id": "input_boolean.sleep_mode",
        "state_type": "str",
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "blockInputOverrides": false,
        "x": 600,
        "y": 460,
        "wires": [
            [
                "3ba27f68.c873b"
            ],
            []
        ]
    },
    {
        "id": "ca3e8118.7264e",
        "type": "api-call-service",
        "z": "38894af.7ca61b6",
        "name": "Close Garage Doors",
        "server": "144427d5.6c9f18",
        "service_domain": "cover",
        "service": "close_cover",
        "data": "{\"entity_id\":\"cover.garage_1, cover.garage_2\"}",
        "mergecontext": "",
        "output_location": "payload",
        "output_location_type": "msg",
        "mustacheAltTags": false,
        "x": 1200,
        "y": 1160,
        "wires": [
            []
        ]
    },
    {
        "id": "821c9a44.468658",
        "type": "link in",
        "z": "30c7e5fd.18228a",
        "name": "Portal In - Sound Machine On",
        "links": [
            "4b0d0947.978688"
        ],
        "x": 355,
        "y": 520,
        "wires": [
            [
                "cce04ec4.43a16"
            ]
        ]
    },
    {
        "id": "4b0d0947.978688",
        "type": "link out",
        "z": "38894af.7ca61b6",
        "name": "",
        "links": [
            "821c9a44.468658"
        ],
        "x": 1115,
        "y": 1400,
        "wires": []
    },
    {
        "id": "b1146ea0.db685",
        "type": "switch",
        "z": "38894af.7ca61b6",
        "name": "Unlocked Doors Found",
        "property": "payload",
        "propertyType": "msg",
        "rules": [
            {
                "t": "neq",
                "v": "I was able to secure all doors. Good night.",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "I was able to secure all doors. Good night.",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 1210,
        "y": 1360,
        "wires": [
            [
                "2d8a718d.93454e"
            ],
            [
                "4b0d0947.978688",
                "2d8a718d.93454e"
            ]
        ]
    },
    {
        "id": "cce04ec4.43a16",
        "type": "delay",
        "z": "30c7e5fd.18228a",
        "name": "",
        "pauseType": "delay",
        "timeout": "5",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "x": 460,
        "y": 520,
        "wires": [
            [
                "9b071567.e41698"
            ]
        ]
    },
    {
        "id": "d339389a.418648",
        "type": "api-call-service",
        "z": "38894af.7ca61b6",
        "name": "Close Garage Doors",
        "server": "144427d5.6c9f18",
        "service_domain": "cover",
        "service": "close_cover",
        "data": "{\"entity_id\":\"cover.garage_1, cover.garage_2\"}",
        "mergecontext": "",
        "output_location": "payload",
        "output_location_type": "msg",
        "mustacheAltTags": false,
        "x": 440,
        "y": 1440,
        "wires": [
            []
        ]
    },
    {
        "id": "ca4c3dcc.1aa25",
        "type": "comment",
        "z": "38894af.7ca61b6",
        "name": "Garage Opened Notification",
        "info": "",
        "x": 180,
        "y": 2520,
        "wires": []
    },
    {
        "id": "c7570fce.7c716",
        "type": "server-state-changed",
        "z": "38894af.7ca61b6",
        "name": "Gate Opened",
        "server": "144427d5.6c9f18",
        "version": 1,
        "entityidfilter": "gate_state",
        "entityidfiltertype": "substring",
        "outputinitially": false,
        "state_type": "str",
        "haltifstate": "Open",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "outputs": 2,
        "output_only_on_state_change": true,
        "x": 150,
        "y": 2660,
        "wires": [
            [
                "1e2c6b1a.f80635"
            ],
            []
        ]
    },
    {
        "id": "b2243d7b.9aa5f",
        "type": "link out",
        "z": "38894af.7ca61b6",
        "name": "Gate Notifications",
        "links": [
            "259dc6d8.29a85a",
            "58dfbc1f.ec9674"
        ],
        "x": 695,
        "y": 2640,
        "wires": []
    },
    {
        "id": "210306a9.bf1a0a",
        "type": "function",
        "z": "38894af.7ca61b6",
        "name": "Build Notification",
        "func": "return {\n    payload: {\n        data: {\n            title: \"Security Notification\",\n            message: msg.doorName + ' has been opened.',\n            data: {\n                \"thread-id\": 'gate-garage-activity'\n            }\n        }\n    }\n};",
        "outputs": 1,
        "noerr": 0,
        "x": 570,
        "y": 2640,
        "wires": [
            [
                "b2243d7b.9aa5f"
            ]
        ]
    },
    {
        "id": "1e2c6b1a.f80635",
        "type": "function",
        "z": "38894af.7ca61b6",
        "name": "Door Namer",
        "func": "var doorNames = {\n    'binary_sensor.front_door_state': 'Front Door',\n    'binary_sensor.back_door_state': 'Back Door',\n    'binary_sensor.side_door_state': 'Side Door',\n    'binary_sensor.south_gate_state': 'South Gate',\n    'binary_sensor.north_gate_state': 'North Gate',\n    'cover.garage_1': 'Main Garage',\n    'cover.garage_2': 'Garage 2'\n}\n\nif(doorNames.hasOwnProperty(msg.topic)) {\n    msg.doorName = doorNames[msg.topic]\n}\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 370,
        "y": 2640,
        "wires": [
            [
                "210306a9.bf1a0a"
            ]
        ]
    },
    {
        "id": "ecf28bef.d69f38",
        "type": "server-state-changed",
        "z": "38894af.7ca61b6",
        "name": "Garage Opened",
        "server": "144427d5.6c9f18",
        "version": 1,
        "entityidfilter": "cover.garage",
        "entityidfiltertype": "substring",
        "outputinitially": false,
        "state_type": "str",
        "haltifstate": "on",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "outputs": 2,
        "output_only_on_state_change": true,
        "x": 140,
        "y": 400,
        "wires": [
            [
                "2c12f67c.414c5a"
            ],
            []
        ]
    },
    {
        "id": "75a848da.3ea538",
        "type": "server-state-changed",
        "z": "38894af.7ca61b6",
        "name": "Garage Opened",
        "server": "144427d5.6c9f18",
        "version": 1,
        "entityidfilter": "cover.garage",
        "entityidfiltertype": "substring",
        "outputinitially": false,
        "state_type": "str",
        "haltifstate": "on",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "outputs": 2,
        "output_only_on_state_change": true,
        "x": 120,
        "y": 920,
        "wires": [
            [
                "fd815c5c.72ed2"
            ],
            []
        ]
    },
    {
        "id": "75ef658b.4e201c",
        "type": "api-get-history",
        "z": "cb6f2b8f.2124b8",
        "name": "Alydia History Last 5m",
        "server": "144427d5.6c9f18",
        "startdate": "",
        "enddate": "",
        "entityid": "person.alydia",
        "entityidtype": "is",
        "useRelativeTime": true,
        "relativeTime": "5m",
        "flatten": true,
        "output_type": "array",
        "output_location_type": "msg",
        "output_location": "payload",
        "x": 360,
        "y": 1720,
        "wires": [
            [
                "e71123d0.a994a"
            ]
        ]
    },
    {
        "id": "e71123d0.a994a",
        "type": "function",
        "z": "cb6f2b8f.2124b8",
        "name": "Was Away From Home",
        "func": "if(msg.payload.length === 1 && msg.payload[0].state !== \"home\") {\n    return msg;\n}\n",
        "outputs": 1,
        "noerr": 0,
        "x": 380,
        "y": 1760,
        "wires": [
            [
                "3137cf5b.9167c"
            ]
        ]
    },
    {
        "id": "23fdf962.e3eef6",
        "type": "api-get-history",
        "z": "cb6f2b8f.2124b8",
        "name": "Matt History Last 5m",
        "server": "144427d5.6c9f18",
        "startdate": "",
        "enddate": "",
        "entityid": "person.matt",
        "entityidtype": "is",
        "useRelativeTime": true,
        "relativeTime": "5m",
        "flatten": true,
        "output_type": "array",
        "output_location_type": "msg",
        "output_location": "payload",
        "x": 360,
        "y": 1820,
        "wires": [
            [
                "feaed074.8622a"
            ]
        ]
    },
    {
        "id": "feaed074.8622a",
        "type": "function",
        "z": "cb6f2b8f.2124b8",
        "name": "Was Away From Home",
        "func": "if(msg.payload.length === 1 && msg.payload[0].state !== \"home\") {\n    return msg;\n}\n",
        "outputs": 1,
        "noerr": 0,
        "x": 380,
        "y": 1860,
        "wires": [
            [
                "4e5f6182.e6fa7"
            ]
        ]
    },
    {
        "id": "c6540f54.6c2d1",
        "type": "function",
        "z": "cb6f2b8f.2124b8",
        "name": "Away Mode Enabled Last 5 Min",
        "func": "if(msg.payload.length === 1 && msg.payload[0].state === \"on\") {\n    return msg;\n}\n",
        "outputs": 1,
        "noerr": 0,
        "x": 410,
        "y": 1960,
        "wires": [
            [
                "7234a4b8.ffdaec"
            ]
        ]
    },
    {
        "id": "76c56268.1f586c",
        "type": "api-get-history",
        "z": "cb6f2b8f.2124b8",
        "name": "Away Mode Last 5m",
        "server": "144427d5.6c9f18",
        "startdate": "",
        "enddate": "",
        "entityid": "input_boolean.away_mode",
        "entityidtype": "is",
        "useRelativeTime": true,
        "relativeTime": "5m",
        "flatten": true,
        "output_type": "array",
        "output_location_type": "msg",
        "output_location": "payload",
        "x": 360,
        "y": 1920,
        "wires": [
            [
                "c6540f54.6c2d1"
            ]
        ]
    },
    {
        "id": "62effac5.0c4a84",
        "type": "mqtt in",
        "z": "5e603fa3.deb16",
        "name": "Office LED State",
        "topic": "streamdeck/office/led",
        "qos": "0",
        "datatype": "auto",
        "broker": "1f84a57d.10775b",
        "x": 120,
        "y": 220,
        "wires": [
            [
                "30d3ccca.e7b7c4"
            ]
        ]
    },
    {
        "id": "30d3ccca.e7b7c4",
        "type": "api-call-service",
        "z": "5e603fa3.deb16",
        "name": "Office LED Toggle",
        "server": "144427d5.6c9f18",
        "service_domain": "light",
        "service": "toggle",
        "data": "{\"entity_id\":\"light.office_led\"}",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 370,
        "y": 220,
        "wires": [
            []
        ]
    },
    {
        "id": "e8c80c99.9c6f6",
        "type": "mqtt in",
        "z": "5e603fa3.deb16",
        "name": "Office TV",
        "topic": "streamdeck/office/tv",
        "qos": "0",
        "datatype": "auto",
        "broker": "1f84a57d.10775b",
        "x": 140,
        "y": 280,
        "wires": [
            [
                "b7626d09.7ffba"
            ]
        ]
    },
    {
        "id": "b7626d09.7ffba",
        "type": "api-call-service",
        "z": "5e603fa3.deb16",
        "name": "Office TV Toggle",
        "server": "144427d5.6c9f18",
        "service_domain": "media_player",
        "service": "toggle",
        "data": "{\"entity_id\":\"media_player.office_tv\"}",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 360,
        "y": 280,
        "wires": [
            []
        ]
    },
    {
        "id": "83a1a6ac.a0f508",
        "type": "api-call-service",
        "z": "5e603fa3.deb16",
        "name": "Office TV Off",
        "server": "144427d5.6c9f18",
        "service_domain": "media_player",
        "service": "turn_off",
        "data": "{\"entity_id\":\"media_player.office_tv\"}",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 350,
        "y": 140,
        "wires": [
            []
        ]
    },
    {
        "id": "3b45660f.39b07a",
        "type": "mqtt in",
        "z": "5e603fa3.deb16",
        "name": "All Off",
        "topic": "streamdeck/office",
        "qos": "0",
        "datatype": "auto",
        "broker": "1f84a57d.10775b",
        "x": 150,
        "y": 100,
        "wires": [
            [
                "83a1a6ac.a0f508",
                "6e2ddef7.149e7"
            ]
        ]
    },
    {
        "id": "6e2ddef7.149e7",
        "type": "api-call-service",
        "z": "5e603fa3.deb16",
        "name": "Office Lights Off",
        "server": "144427d5.6c9f18",
        "service_domain": "light",
        "service": "turn_off",
        "data": "{\"entity_id\":\"light.office_light, light.office_led\"}",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 360,
        "y": 100,
        "wires": [
            []
        ]
    },
    {
        "id": "77b953db.fc9edc",
        "type": "mqtt in",
        "z": "5e603fa3.deb16",
        "name": "Camera To Office TV",
        "topic": "streamdeck/office/cameraToTV/#",
        "qos": "0",
        "datatype": "auto",
        "broker": "1f84a57d.10775b",
        "x": 790,
        "y": 100,
        "wires": [
            [
                "81fd2049.ede4c"
            ]
        ]
    },
    {
        "id": "5a36ac80.8f6404",
        "type": "function",
        "z": "3e9522c6.d11e1e",
        "name": "StreamDeck Action to Camera/Display Mapper",
        "func": "var map = {\n    \"streamdeck/office/cameraToTV/backdoor\": {camera: \"camera.back_door_live\", display: \"media_player.office_chromecast\"},\n    \"streamdeck/office/cameraToTV/frontdoor\": {camera: \"camera.front_door_live\", display: \"media_player.office_chromecast\"},\n    \"streamdeck/office/cameraToTV/sidedoor\": {camera: \"camera.side_entry_live\", display: \"media_player.office_chromecast\"},\n    \"streamdeck/office/cameraToTV/girlsroom\": {camera: \"camera.girl_s_room\", display: \"media_player.office_chromecast\"},\n    \"streamdeck/office/cameraToTV/frontyard\": {camera: \"camera.qvr_front_180\", display: \"media_player.office_chromecast\"},\n    \"streamdeck/office/cameraToTV/sideyard\": {camera: \"camera.qvr_side_180\", display: \"media_player.office_chromecast\"},\n\n    \n    \"streamdeck/livingroom/cameraToTV/backdoor\": {camera: \"camera.back_door_live\", display: \"media_player.living_room_chromecast\"},\n    \"streamdeck/livingroom/cameraToTV/frontdoor\": {camera: \"camera.front_door_live\", display: \"media_player.living_room_chromecast\"},\n    \"streamdeck/livingroom/cameraToTV/sidedoor\": {camera: \"camera.side_entry_live\", display: \"media_player.living_room_chromecast\"},\n    \"streamdeck/livingroom/cameraToTV/girlsroom\": {camera: \"camera.girl_s_room\", display: \"media_player.living_room_chromecast\"},\n}\n\nmsg.payload = {\n    entity_id: map[msg.topic].camera,\n}\n\nmsg.display = map[msg.topic].display;\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 640,
        "y": 420,
        "wires": [
            [
                "78310c2b.3a5c44",
                "c4a2d32.dbba33"
            ]
        ]
    },
    {
        "id": "4b2bad84.8f2bf4",
        "type": "link in",
        "z": "3e9522c6.d11e1e",
        "name": "StreamDeck - Camera To TV",
        "links": [
            "81fd2049.ede4c"
        ],
        "x": 395,
        "y": 420,
        "wires": [
            [
                "5a36ac80.8f6404"
            ]
        ]
    },
    {
        "id": "81fd2049.ede4c",
        "type": "link out",
        "z": "5e603fa3.deb16",
        "name": "StreamDeck - Actions",
        "links": [
            "4b2bad84.8f2bf4"
        ],
        "x": 995,
        "y": 100,
        "wires": []
    },
    {
        "id": "c4a2d32.dbba33",
        "type": "debug",
        "z": "3e9522c6.d11e1e",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "x": 520,
        "y": 500,
        "wires": []
    },
    {
        "id": "c91403e2.bee9",
        "type": "mqtt in",
        "z": "5e603fa3.deb16",
        "name": "Camera To Living Room TV",
        "topic": "streamdeck/livingroom/cameraToTV/#",
        "qos": "0",
        "datatype": "auto",
        "broker": "1f84a57d.10775b",
        "x": 770,
        "y": 160,
        "wires": [
            [
                "81fd2049.ede4c"
            ]
        ]
    },
    {
        "id": "fc431b9.32a0fe8",
        "type": "comment",
        "z": "5e603fa3.deb16",
        "name": "Office Page",
        "info": "",
        "x": 130,
        "y": 40,
        "wires": []
    },
    {
        "id": "ca4e5b6d.708318",
        "type": "comment",
        "z": "5e603fa3.deb16",
        "name": "Camera Actions",
        "info": "",
        "x": 740,
        "y": 60,
        "wires": []
    },
    {
        "id": "bcc86526.8728c8",
        "type": "comment",
        "z": "5e603fa3.deb16",
        "name": "Living Room Page",
        "info": "",
        "x": 110,
        "y": 960,
        "wires": []
    },
    {
        "id": "4eefa37c.a86bdc",
        "type": "mqtt in",
        "z": "5e603fa3.deb16",
        "name": "All Off",
        "topic": "streamdeck/livingroom",
        "qos": "0",
        "datatype": "auto",
        "broker": "1f84a57d.10775b",
        "x": 170,
        "y": 1020,
        "wires": [
            [
                "b5937a52.5b5e48",
                "a441aca1.11a7d"
            ]
        ]
    },
    {
        "id": "b5937a52.5b5e48",
        "type": "api-call-service",
        "z": "5e603fa3.deb16",
        "name": "Living Room TV Off",
        "server": "144427d5.6c9f18",
        "service_domain": "media_player",
        "service": "turn_off",
        "data": "{\"entity_id\":\"media_player.living_room_tv\"}",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 390,
        "y": 1020,
        "wires": [
            []
        ]
    },
    {
        "id": "fac66cff.c0c6d",
        "type": "mqtt in",
        "z": "5e603fa3.deb16",
        "name": "All Living Room Lights",
        "topic": "streamdeck/livingroom/lights",
        "qos": "0",
        "datatype": "auto",
        "broker": "1f84a57d.10775b",
        "x": 120,
        "y": 1240,
        "wires": [
            [
                "fa74a6b9.8bdbf8"
            ]
        ]
    },
    {
        "id": "fa74a6b9.8bdbf8",
        "type": "api-call-service",
        "z": "5e603fa3.deb16",
        "name": "All Living Room Lights",
        "server": "144427d5.6c9f18",
        "service_domain": "light",
        "service": "turn_off",
        "data": "{\"entity_id\":\"light.livingroom_can_lights, light.living_room_chandelier\"}",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 380,
        "y": 1240,
        "wires": [
            []
        ]
    },
    {
        "id": "f7417c9.ef7f78",
        "type": "api-call-service",
        "z": "5e603fa3.deb16",
        "name": "Light Turn On Service",
        "server": "144427d5.6c9f18",
        "service_domain": "light",
        "service": "turn_on",
        "data": "",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 980,
        "y": 1440,
        "wires": [
            []
        ]
    },
    {
        "id": "3936bcee.9db5b4",
        "type": "mqtt in",
        "z": "5e603fa3.deb16",
        "name": "Chandelier",
        "topic": "streamdeck/livingroom/chandelier",
        "qos": "0",
        "datatype": "auto",
        "broker": "1f84a57d.10775b",
        "x": 140,
        "y": 1320,
        "wires": [
            [
                "21415d76.e5dd52"
            ]
        ]
    },
    {
        "id": "41cb1c5.a06a4e4",
        "type": "function",
        "z": "5e603fa3.deb16",
        "name": "Increase Brightness",
        "func": "function newBrightness(current_brightness) {\n    newBrightnessPct = (current_brightness / 256 + 0.03) * 100\n    return Math.max(0, Math.min(100, Math.round(newBrightnessPct)))\n}\n\nnewMsg = {\n    payload: {\n        \"data\": {\n            \"entity_id\": msg.topic,\n            \"brightness_pct\": newBrightness(msg.data.attributes.brightness)\n        }\n    }\n}\nreturn newMsg;",
        "outputs": 1,
        "noerr": 0,
        "x": 680,
        "y": 1300,
        "wires": [
            [
                "f7417c9.ef7f78"
            ]
        ]
    },
    {
        "id": "797907d3.b6dc38",
        "type": "api-current-state",
        "z": "5e603fa3.deb16",
        "name": "Chandelier",
        "server": "144427d5.6c9f18",
        "version": 1,
        "outputs": 1,
        "halt_if": "",
        "halt_if_type": "str",
        "halt_if_compare": "does_not_include",
        "override_topic": true,
        "entity_id": "light.living_room_chandelier",
        "state_type": "str",
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "blockInputOverrides": true,
        "x": 450,
        "y": 1300,
        "wires": [
            [
                "41cb1c5.a06a4e4"
            ]
        ]
    },
    {
        "id": "95da7aa5.952f48",
        "type": "api-current-state",
        "z": "5e603fa3.deb16",
        "name": "Chandelier",
        "server": "144427d5.6c9f18",
        "version": 1,
        "outputs": 1,
        "halt_if": "",
        "halt_if_type": "str",
        "halt_if_compare": "does_not_include",
        "override_topic": true,
        "entity_id": "light.living_room_chandelier",
        "state_type": "str",
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "blockInputOverrides": true,
        "x": 450,
        "y": 1360,
        "wires": [
            [
                "13c0aca8.de16a3"
            ]
        ]
    },
    {
        "id": "13c0aca8.de16a3",
        "type": "function",
        "z": "5e603fa3.deb16",
        "name": "Decrease Brightness",
        "func": "function newBrightness(current_brightness) {\n    newBrightnessPct = (current_brightness / 256 - 0.03) * 100\n    return Math.max(0, Math.min(100, Math.round(newBrightnessPct)))\n}\n\nnewMsg = {\n    payload: {\n        \"data\": {\n            \"entity_id\": msg.topic,\n            \"brightness_pct\": newBrightness(msg.data.attributes.brightness)\n        }\n    }\n}\nreturn newMsg;",
        "outputs": 1,
        "noerr": 0,
        "x": 680,
        "y": 1360,
        "wires": [
            [
                "f7417c9.ef7f78"
            ]
        ]
    },
    {
        "id": "67fe6705.03de08",
        "type": "api-call-service",
        "z": "5e603fa3.deb16",
        "name": "Chandelier Toggle",
        "server": "144427d5.6c9f18",
        "service_domain": "light",
        "service": "toggle",
        "data": "{\"entity_id\":\"light.living_room_chandelier\"}",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 470,
        "y": 1420,
        "wires": [
            []
        ]
    },
    {
        "id": "21415d76.e5dd52",
        "type": "switch",
        "z": "5e603fa3.deb16",
        "name": "Event Router",
        "property": "payload",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "up",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "down",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "toggle",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 3,
        "x": 210,
        "y": 1380,
        "wires": [
            [
                "797907d3.b6dc38"
            ],
            [
                "95da7aa5.952f48"
            ],
            [
                "67fe6705.03de08"
            ]
        ]
    },
    {
        "id": "4d7ee9ad.e978e8",
        "type": "mqtt in",
        "z": "5e603fa3.deb16",
        "name": "Can Lights",
        "topic": "streamdeck/livingroom/canlights",
        "qos": "0",
        "datatype": "auto",
        "broker": "1f84a57d.10775b",
        "x": 140,
        "y": 1540,
        "wires": [
            [
                "8d32975f.900788"
            ]
        ]
    },
    {
        "id": "8d32975f.900788",
        "type": "switch",
        "z": "5e603fa3.deb16",
        "name": "Event Router",
        "property": "payload",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "up",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "down",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "toggle",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 3,
        "x": 210,
        "y": 1600,
        "wires": [
            [
                "5d5e573a.c73538"
            ],
            [
                "6b87e778.6b1678"
            ],
            [
                "dbdadfda.2b0ee"
            ]
        ]
    },
    {
        "id": "5d5e573a.c73538",
        "type": "api-current-state",
        "z": "5e603fa3.deb16",
        "name": "Can Lights",
        "server": "144427d5.6c9f18",
        "version": 1,
        "outputs": 1,
        "halt_if": "",
        "halt_if_type": "str",
        "halt_if_compare": "does_not_include",
        "override_topic": true,
        "entity_id": "light.livingroom_can_lights",
        "state_type": "str",
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "blockInputOverrides": true,
        "x": 450,
        "y": 1520,
        "wires": [
            [
                "4cf32dfa.0fa764"
            ]
        ]
    },
    {
        "id": "6b87e778.6b1678",
        "type": "api-current-state",
        "z": "5e603fa3.deb16",
        "name": "Can Lights",
        "server": "144427d5.6c9f18",
        "version": 1,
        "outputs": 1,
        "halt_if": "",
        "halt_if_type": "str",
        "halt_if_compare": "does_not_include",
        "override_topic": true,
        "entity_id": "light.livingroom_can_lights",
        "state_type": "str",
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "blockInputOverrides": true,
        "x": 450,
        "y": 1580,
        "wires": [
            [
                "db294c98.26c12"
            ]
        ]
    },
    {
        "id": "dbdadfda.2b0ee",
        "type": "api-call-service",
        "z": "5e603fa3.deb16",
        "name": "Can Lights Toggle",
        "server": "144427d5.6c9f18",
        "service_domain": "light",
        "service": "toggle",
        "data": "{\"entity_id\":\"light.livingroom_can_lights\"}",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 470,
        "y": 1640,
        "wires": [
            []
        ]
    },
    {
        "id": "4cf32dfa.0fa764",
        "type": "function",
        "z": "5e603fa3.deb16",
        "name": "Increase Brightness",
        "func": "function newBrightness(current_brightness) {\n    newBrightnessPct = (current_brightness / 256 + 0.05) * 100\n    return Math.max(0, Math.min(100, Math.round(newBrightnessPct)))\n}\n\nnewMsg = {\n    payload: {\n        \"data\": {\n            \"entity_id\": msg.topic,\n            \"brightness_pct\": newBrightness(msg.data.attributes.brightness)\n        }\n    }\n}\nreturn newMsg;",
        "outputs": 1,
        "noerr": 0,
        "x": 680,
        "y": 1520,
        "wires": [
            [
                "f7417c9.ef7f78"
            ]
        ]
    },
    {
        "id": "db294c98.26c12",
        "type": "function",
        "z": "5e603fa3.deb16",
        "name": "Decrease Brightness",
        "func": "function newBrightness(current_brightness) {\n    newBrightnessPct = (current_brightness / 256 - 0.05) * 100\n    return Math.max(0, Math.min(100, Math.round(newBrightnessPct)))\n}\n\nnewMsg = {\n    payload: {\n        \"data\": {\n            \"entity_id\": msg.topic,\n            \"brightness_pct\": newBrightness(msg.data.attributes.brightness)\n        }\n    }\n}\nreturn newMsg;",
        "outputs": 1,
        "noerr": 0,
        "x": 680,
        "y": 1580,
        "wires": [
            [
                "f7417c9.ef7f78"
            ]
        ]
    },
    {
        "id": "f5869067.4fd86",
        "type": "mqtt in",
        "z": "5e603fa3.deb16",
        "name": "TV",
        "topic": "streamdeck/livingroom/tv",
        "qos": "0",
        "datatype": "auto",
        "broker": "1f84a57d.10775b",
        "x": 150,
        "y": 1740,
        "wires": [
            [
                "bf2e2035.20f89"
            ]
        ]
    },
    {
        "id": "bf2e2035.20f89",
        "type": "switch",
        "z": "5e603fa3.deb16",
        "name": "Event Router",
        "property": "payload",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "volup",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "voldown",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "mute",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "chanup",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "chandown",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "toggle",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 6,
        "x": 210,
        "y": 1840,
        "wires": [
            [
                "aa68a17f.636f6"
            ],
            [
                "4105019d.bc3fc"
            ],
            [
                "f99fa1d8.96964"
            ],
            [
                "c3fb8cee.c5943"
            ],
            [
                "e253e6de.165668"
            ],
            [
                "98c7e65f.04b798"
            ]
        ]
    },
    {
        "id": "aa68a17f.636f6",
        "type": "api-call-service",
        "z": "5e603fa3.deb16",
        "name": "Volume Up",
        "server": "144427d5.6c9f18",
        "service_domain": "media_player",
        "service": "volume_up",
        "data": "{\"entity_id\":\"media_player.living_room_tv\"}",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 450,
        "y": 1740,
        "wires": [
            []
        ]
    },
    {
        "id": "4105019d.bc3fc",
        "type": "api-call-service",
        "z": "5e603fa3.deb16",
        "name": "Volume Down",
        "server": "144427d5.6c9f18",
        "service_domain": "media_player",
        "service": "volume_down",
        "data": "{\"entity_id\":\"media_player.living_room_tv\"}",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 460,
        "y": 1780,
        "wires": [
            []
        ]
    },
    {
        "id": "f99fa1d8.96964",
        "type": "api-call-service",
        "z": "5e603fa3.deb16",
        "name": "Volume Mute",
        "server": "144427d5.6c9f18",
        "service_domain": "media_player",
        "service": "volume_mute",
        "data": "{\"entity_id\":\"media_player.living_room_tv\",\"is_volume_muted\":true}",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 450,
        "y": 1820,
        "wires": [
            []
        ]
    },
    {
        "id": "c3fb8cee.c5943",
        "type": "api-call-service",
        "z": "5e603fa3.deb16",
        "name": "Channel Up",
        "server": "144427d5.6c9f18",
        "service_domain": "media_player",
        "service": "media_next_track",
        "data": "{\"entity_id\":\"media_player.living_room_tv\"}",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 450,
        "y": 1880,
        "wires": [
            []
        ]
    },
    {
        "id": "e253e6de.165668",
        "type": "api-call-service",
        "z": "5e603fa3.deb16",
        "name": "Channel Down",
        "server": "144427d5.6c9f18",
        "service_domain": "media_player",
        "service": "media_previous_track",
        "data": "{\"entity_id\":\"media_player.living_room_tv\"}",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 460,
        "y": 1920,
        "wires": [
            []
        ]
    },
    {
        "id": "98c7e65f.04b798",
        "type": "api-call-service",
        "z": "5e603fa3.deb16",
        "name": "Living Room TV toggle",
        "server": "144427d5.6c9f18",
        "service_domain": "media_player",
        "service": "toggle",
        "data": "{\"entity_id\":\"media_player.living_room_tv\"}",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 480,
        "y": 1960,
        "wires": [
            []
        ]
    },
    {
        "id": "a441aca1.11a7d",
        "type": "api-call-service",
        "z": "5e603fa3.deb16",
        "name": "Light Turn Off Service",
        "server": "144427d5.6c9f18",
        "service_domain": "light",
        "service": "turn_off",
        "data": "{\"entity_id\":\"light.livingroom_can_lights, light.living_room_chandelier\"}",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 400,
        "y": 1060,
        "wires": [
            []
        ]
    },
    {
        "id": "e70cc67b.bb7f58",
        "type": "mqtt in",
        "z": "5e603fa3.deb16",
        "name": "Office LED State",
        "topic": "streamdeck/office/light",
        "qos": "0",
        "datatype": "auto",
        "broker": "1f84a57d.10775b",
        "x": 120,
        "y": 800,
        "wires": [
            [
                "98503351.d974f"
            ]
        ]
    },
    {
        "id": "98503351.d974f",
        "type": "api-call-service",
        "z": "5e603fa3.deb16",
        "name": "Office Light Toggle",
        "server": "144427d5.6c9f18",
        "service_domain": "light",
        "service": "toggle",
        "data": "{\"entity_id\":\"light.office_light\"}",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 370,
        "y": 800,
        "wires": [
            []
        ]
    },
    {
        "id": "6730de3.abb582",
        "type": "mqtt in",
        "z": "5e603fa3.deb16",
        "name": "Office Fan",
        "topic": "streamdeck/office/fan",
        "qos": "0",
        "datatype": "auto",
        "broker": "1f84a57d.10775b",
        "x": 140,
        "y": 760,
        "wires": [
            [
                "712e93b8.5f3a1c"
            ]
        ]
    },
    {
        "id": "712e93b8.5f3a1c",
        "type": "api-call-service",
        "z": "5e603fa3.deb16",
        "name": "Office Light Toggle",
        "server": "144427d5.6c9f18",
        "service_domain": "switch",
        "service": "toggle",
        "data": "{\"entity_id\":\"switch.office_fan\"}",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 370,
        "y": 760,
        "wires": [
            []
        ]
    },
    {
        "id": "f1e2bb2c.f02d38",
        "type": "mqtt in",
        "z": "5e603fa3.deb16",
        "name": "Office TV Channel",
        "topic": "streamdeck/office/tv/channel",
        "qos": "0",
        "datatype": "auto",
        "broker": "1f84a57d.10775b",
        "x": 110,
        "y": 340,
        "wires": [
            [
                "13272e86.7d46f1"
            ]
        ]
    },
    {
        "id": "13272e86.7d46f1",
        "type": "api-call-service",
        "z": "5e603fa3.deb16",
        "name": "Office TV Channel",
        "server": "144427d5.6c9f18",
        "service_domain": "media_player",
        "service": "play_media",
        "data": "{\"entity_id\":\"media_player.office_tv\",\"media_content_id\":\"{{payload}}\",\"media_content_type\":\"channel\"}",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 370,
        "y": 340,
        "wires": [
            []
        ]
    },
    {
        "id": "e7a0a702.99d3c8",
        "type": "api-call-service",
        "z": "5e603fa3.deb16",
        "name": "Living Room TV Channel",
        "server": "144427d5.6c9f18",
        "service_domain": "media_player",
        "service": "play_media",
        "data": "{\"entity_id\":\"media_player.living_room_tv\",\"media_content_id\":\"{{payload}}\",\"media_content_type\":\"channel\"}",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 410,
        "y": 1160,
        "wires": [
            []
        ]
    },
    {
        "id": "42c94f05.3a926",
        "type": "mqtt in",
        "z": "5e603fa3.deb16",
        "name": "Living Room TV Channel",
        "topic": "streamdeck/livingroom/tv/channel",
        "qos": "0",
        "datatype": "auto",
        "broker": "1f84a57d.10775b",
        "x": 110,
        "y": 1160,
        "wires": [
            [
                "e7a0a702.99d3c8"
            ]
        ]
    },
    {
        "id": "cf8e0262.3b6fc",
        "type": "mqtt in",
        "z": "5e603fa3.deb16",
        "name": "Living Room TV Input",
        "topic": "streamdeck/livingroom/tv/input",
        "qos": "0",
        "datatype": "auto",
        "broker": "1f84a57d.10775b",
        "x": 120,
        "y": 1120,
        "wires": [
            [
                "4ea57f8d.b98c4"
            ]
        ]
    },
    {
        "id": "4ea57f8d.b98c4",
        "type": "api-call-service",
        "z": "5e603fa3.deb16",
        "name": "Living Room TV Input",
        "server": "144427d5.6c9f18",
        "service_domain": "media_player",
        "service": "select_source",
        "data": "{\"entity_id\":\"media_player.living_room_tv\",\"source\":\"{{payload}}\"}",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 400,
        "y": 1120,
        "wires": [
            []
        ]
    },
    {
        "id": "2d2b6273.d25d6e",
        "type": "comment",
        "z": "5e603fa3.deb16",
        "name": "Outside Page",
        "info": "",
        "x": 730,
        "y": 320,
        "wires": []
    },
    {
        "id": "311bfa46.d0bb76",
        "type": "mqtt in",
        "z": "5e603fa3.deb16",
        "name": "Backyard Light Toggle",
        "topic": "streamdeck/outside/lights/backyard",
        "qos": "0",
        "datatype": "auto",
        "broker": "1f84a57d.10775b",
        "x": 740,
        "y": 380,
        "wires": [
            [
                "339171d8.91d3de"
            ]
        ]
    },
    {
        "id": "339171d8.91d3de",
        "type": "api-call-service",
        "z": "5e603fa3.deb16",
        "name": "Backyard Light Toggle",
        "server": "144427d5.6c9f18",
        "service_domain": "switch",
        "service": "toggle",
        "data": "{\"entity_id\":\"switch.back_porch_light\"}",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 1000,
        "y": 380,
        "wires": [
            []
        ]
    },
    {
        "id": "7234a4b8.ffdaec",
        "type": "delay",
        "z": "cb6f2b8f.2124b8",
        "name": "",
        "pauseType": "rate",
        "timeout": "5",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "5",
        "rateUnits": "minute",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": true,
        "x": 900,
        "y": 1840,
        "wires": [
            [
                "4208dc0b.b9b244"
            ]
        ]
    },
    {
        "id": "70b46879.79e778",
        "type": "comment",
        "z": "eee3c0c3.7c7bd",
        "name": "Garage Light After Dark",
        "info": "",
        "x": 180,
        "y": 1020,
        "wires": []
    },
    {
        "id": "a8a48ed9.0c3fe",
        "type": "server-state-changed",
        "z": "eee3c0c3.7c7bd",
        "name": "Garage Door Opened",
        "server": "144427d5.6c9f18",
        "version": 1,
        "entityidfilter": "cover.garage_1",
        "entityidfiltertype": "substring",
        "outputinitially": false,
        "state_type": "str",
        "haltifstate": "open",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "outputs": 2,
        "output_only_on_state_change": true,
        "x": 180,
        "y": 1060,
        "wires": [
            [
                "f430949d.d10da8"
            ],
            [
                "83628ea.3aff67"
            ]
        ]
    },
    {
        "id": "83628ea.3aff67",
        "type": "delay",
        "z": "eee3c0c3.7c7bd",
        "name": "",
        "pauseType": "delay",
        "timeout": "5",
        "timeoutUnits": "minutes",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "x": 380,
        "y": 1100,
        "wires": [
            [
                "990a908.4f9917"
            ]
        ]
    },
    {
        "id": "990a908.4f9917",
        "type": "api-call-service",
        "z": "eee3c0c3.7c7bd",
        "name": "Garage Light Off",
        "server": "144427d5.6c9f18",
        "service_domain": "homeassistant",
        "service": "turn_off",
        "data": "{\"entity_id\":\"switch.garage_light\"}",
        "mergecontext": "",
        "output_location": "payload",
        "output_location_type": "msg",
        "mustacheAltTags": false,
        "x": 630,
        "y": 1100,
        "wires": [
            []
        ]
    },
    {
        "id": "c6abc2c3.c3a51",
        "type": "api-call-service",
        "z": "eee3c0c3.7c7bd",
        "name": "Garage Light On",
        "server": "144427d5.6c9f18",
        "service_domain": "homeassistant",
        "service": "turn_on",
        "data": "{\"entity_id\":\"switch.garage_light\"}",
        "mergecontext": "",
        "output_location": "payload",
        "output_location_type": "msg",
        "mustacheAltTags": false,
        "x": 620,
        "y": 1020,
        "wires": [
            []
        ]
    },
    {
        "id": "f430949d.d10da8",
        "type": "time-range-switch",
        "z": "eee3c0c3.7c7bd",
        "name": "",
        "lat": "",
        "lon": "",
        "startTime": "sunset",
        "endTime": "nightEnd",
        "startOffset": 0,
        "endOffset": 0,
        "x": 410,
        "y": 1020,
        "wires": [
            [
                "c6abc2c3.c3a51"
            ],
            []
        ]
    },
    {
        "id": "31e0cf2c.0037b",
        "type": "function",
        "z": "cb6f2b8f.2124b8",
        "name": "Build Notification",
        "func": "\nmsg = {\n    payload: {\n        data: {\n            title: \"Security Notification\",\n            message: \"Opening garage door.\",\n            data: {\n                \"thread-id\": 'gate-garage-activity'\n            }\n        }\n        \n    }\n}\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 1170,
        "y": 1960,
        "wires": [
            [
                "3d25c1a9.3a673e"
            ]
        ]
    },
    {
        "id": "3d25c1a9.3a673e",
        "type": "link out",
        "z": "cb6f2b8f.2124b8",
        "name": "Matt Location Updates",
        "links": [
            "259dc6d8.29a85a",
            "3ba4aeb7.ee1e12"
        ],
        "x": 1435,
        "y": 1980,
        "wires": []
    },
    {
        "id": "ff4a467.3b358b8",
        "type": "mqtt in",
        "z": "5e603fa3.deb16",
        "name": "TV",
        "topic": "streamdeck/office/tv",
        "qos": "0",
        "datatype": "auto",
        "broker": "1f84a57d.10775b",
        "x": 70,
        "y": 460,
        "wires": [
            [
                "acd79dd0.becd8"
            ]
        ]
    },
    {
        "id": "acd79dd0.becd8",
        "type": "switch",
        "z": "5e603fa3.deb16",
        "name": "Event Router",
        "property": "payload",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "volup",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "voldown",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "mute",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "chanup",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "chandown",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "toggle",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 6,
        "x": 130,
        "y": 560,
        "wires": [
            [
                "2b759f11.82789"
            ],
            [
                "589e51bf.1f82f"
            ],
            [
                "b3108982.43ed08"
            ],
            [
                "2ec3278b.6c5188"
            ],
            [
                "fd7a4ac1.55da08"
            ],
            [
                "124a0784.d3bc48"
            ]
        ]
    },
    {
        "id": "2b759f11.82789",
        "type": "api-call-service",
        "z": "5e603fa3.deb16",
        "name": "Volume Up",
        "server": "144427d5.6c9f18",
        "service_domain": "media_player",
        "service": "volume_up",
        "data": "{\"entity_id\":\"media_player.living_room_tv\"}",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 370,
        "y": 460,
        "wires": [
            []
        ]
    },
    {
        "id": "589e51bf.1f82f",
        "type": "api-call-service",
        "z": "5e603fa3.deb16",
        "name": "Volume Down",
        "server": "144427d5.6c9f18",
        "service_domain": "media_player",
        "service": "volume_down",
        "data": "{\"entity_id\":\"media_player.living_room_tv\"}",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 380,
        "y": 500,
        "wires": [
            []
        ]
    },
    {
        "id": "b3108982.43ed08",
        "type": "api-call-service",
        "z": "5e603fa3.deb16",
        "name": "Volume Mute",
        "server": "144427d5.6c9f18",
        "service_domain": "media_player",
        "service": "volume_mute",
        "data": "{\"entity_id\":\"media_player.living_room_tv\",\"is_volume_muted\":true}",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 370,
        "y": 540,
        "wires": [
            []
        ]
    },
    {
        "id": "2ec3278b.6c5188",
        "type": "api-call-service",
        "z": "5e603fa3.deb16",
        "name": "Channel Up",
        "server": "144427d5.6c9f18",
        "service_domain": "media_player",
        "service": "media_next_track",
        "data": "{\"entity_id\":\"media_player.living_room_tv\"}",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 370,
        "y": 600,
        "wires": [
            []
        ]
    },
    {
        "id": "fd7a4ac1.55da08",
        "type": "api-call-service",
        "z": "5e603fa3.deb16",
        "name": "Channel Down",
        "server": "144427d5.6c9f18",
        "service_domain": "media_player",
        "service": "media_previous_track",
        "data": "{\"entity_id\":\"media_player.living_room_tv\"}",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 380,
        "y": 640,
        "wires": [
            []
        ]
    },
    {
        "id": "124a0784.d3bc48",
        "type": "api-call-service",
        "z": "5e603fa3.deb16",
        "name": "Living Room TV toggle",
        "server": "144427d5.6c9f18",
        "service_domain": "media_player",
        "service": "toggle",
        "data": "{\"entity_id\":\"media_player.living_room_tv\"}",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 400,
        "y": 680,
        "wires": [
            []
        ]
    },
    {
        "id": "daa28dd0.2db9",
        "type": "mqtt in",
        "z": "5e603fa3.deb16",
        "name": "Office TV Input",
        "topic": "streamdeck/office/tv/input",
        "qos": "0",
        "datatype": "auto",
        "broker": "1f84a57d.10775b",
        "x": 120,
        "y": 380,
        "wires": [
            [
                "62ac1f55.d8802"
            ]
        ]
    },
    {
        "id": "62ac1f55.d8802",
        "type": "api-call-service",
        "z": "5e603fa3.deb16",
        "name": "Office TV Input",
        "server": "144427d5.6c9f18",
        "service_domain": "media_player",
        "service": "select_source",
        "data": "{\"entity_id\":\"media_player.office_tv\",\"source\":\"{{payload}}\"}",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 360,
        "y": 380,
        "wires": [
            []
        ]
    },
    {
        "id": "3a6fcf4f.b6e8c",
        "type": "debug",
        "z": "3e9522c6.d11e1e",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "x": 1160,
        "y": 480,
        "wires": []
    },
    {
        "id": "896bdb8a.f0b3d8",
        "type": "server-state-changed",
        "z": "eee3c0c3.7c7bd",
        "name": "Alydia Out of Bed",
        "server": "144427d5.6c9f18",
        "version": 1,
        "entityidfilter": "sensor.bed_alydia",
        "entityidfiltertype": "exact",
        "outputinitially": true,
        "state_type": "str",
        "haltifstate": "Unoccupied",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "outputs": 2,
        "output_only_on_state_change": true,
        "x": 130,
        "y": 1780,
        "wires": [
            [
                "f2f976fe.8aaf98"
            ],
            [
                "45851e40.86d37"
            ]
        ]
    },
    {
        "id": "2e31ea71.e471d6",
        "type": "api-call-service",
        "z": "eee3c0c3.7c7bd",
        "name": "Change Office Light",
        "server": "144427d5.6c9f18",
        "service_domain": "light",
        "service": "turn_on",
        "data": "{\"entity_id\":\"light.office_led\",\"rgb_color\":[255,0,0]}",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 680,
        "y": 1720,
        "wires": [
            []
        ]
    },
    {
        "id": "f855c166.71a9c",
        "type": "api-call-service",
        "z": "eee3c0c3.7c7bd",
        "name": "Change Office Light",
        "server": "144427d5.6c9f18",
        "service_domain": "light",
        "service": "turn_on",
        "data": "{\"entity_id\":\"light.office_led\",\"rgb_color\":[0,0,255]}",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 740,
        "y": 1860,
        "wires": [
            []
        ]
    },
    {
        "id": "f2f976fe.8aaf98",
        "type": "api-current-state",
        "z": "eee3c0c3.7c7bd",
        "name": "Matt Out of Bed",
        "server": "144427d5.6c9f18",
        "version": 1,
        "outputs": 2,
        "halt_if": "Unoccupied",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "override_topic": false,
        "entity_id": "sensor.bed_matt",
        "state_type": "str",
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "blockInputOverrides": false,
        "x": 300,
        "y": 1680,
        "wires": [
            [
                "6e7adf0d.f094d"
            ],
            []
        ]
    },
    {
        "id": "45851e40.86d37",
        "type": "api-current-state",
        "z": "eee3c0c3.7c7bd",
        "name": "Matt Out of Bed",
        "server": "144427d5.6c9f18",
        "version": 1,
        "outputs": 2,
        "halt_if": "Unoccupied",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "override_topic": false,
        "entity_id": "sensor.bed_matt",
        "state_type": "str",
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "blockInputOverrides": false,
        "x": 300,
        "y": 1900,
        "wires": [
            [
                "c39d6e84.ca4a8"
            ],
            []
        ]
    },
    {
        "id": "c39d6e84.ca4a8",
        "type": "api-current-state",
        "z": "eee3c0c3.7c7bd",
        "name": "Office LED is On",
        "server": "144427d5.6c9f18",
        "version": 1,
        "outputs": 2,
        "halt_if": "on",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "override_topic": false,
        "entity_id": "light.office_led",
        "state_type": "str",
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "blockInputOverrides": false,
        "x": 460,
        "y": 1820,
        "wires": [
            [
                "f855c166.71a9c",
                "406e1756.ab3098"
            ],
            []
        ]
    },
    {
        "id": "6e7adf0d.f094d",
        "type": "api-current-state",
        "z": "eee3c0c3.7c7bd",
        "name": "Office LED is On",
        "server": "144427d5.6c9f18",
        "version": 1,
        "outputs": 2,
        "halt_if": "on",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "override_topic": false,
        "entity_id": "light.office_led",
        "state_type": "str",
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "blockInputOverrides": false,
        "x": 460,
        "y": 1760,
        "wires": [
            [
                "2e31ea71.e471d6",
                "406e1756.ab3098"
            ],
            []
        ]
    },
    {
        "id": "8c9dc1a.4e1934",
        "type": "server-state-changed",
        "z": "76250bd8.6dba94",
        "name": "Alexa Handler - Vacuum Breakfast Area",
        "server": "144427d5.6c9f18",
        "version": 1,
        "entityidfilter": "input_boolean.alexa_handler_vacuum_breakfast_area",
        "entityidfiltertype": "exact",
        "outputinitially": false,
        "state_type": "str",
        "haltifstate": "on",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "outputs": 2,
        "output_only_on_state_change": false,
        "x": 230,
        "y": 820,
        "wires": [
            [
                "88274a34.a7d1e8",
                "aea9aed6.968d6"
            ],
            []
        ]
    },
    {
        "id": "88274a34.a7d1e8",
        "type": "api-call-service",
        "z": "76250bd8.6dba94",
        "name": "Vacuum Breakfast Area",
        "server": "144427d5.6c9f18",
        "service_domain": "vacuum",
        "service": "send_command",
        "data": "{\"entity_id\":\"vacuum.rockrobo\",\"command\":\"zoned_cleanup\",\"params\":{\"zone_ids\":[\"Breakfast Area\"]}}",
        "mergecontext": "",
        "output_location": "payload",
        "output_location_type": "msg",
        "mustacheAltTags": false,
        "x": 650,
        "y": 820,
        "wires": [
            []
        ]
    },
    {
        "id": "caffabef.fc2018",
        "type": "server-state-changed",
        "z": "76250bd8.6dba94",
        "name": "Alexa Handler - Vacuum Return to Base",
        "server": "144427d5.6c9f18",
        "version": 1,
        "entityidfilter": "input_boolean.alexa_handler_vacuum_return_to_base",
        "entityidfiltertype": "exact",
        "outputinitially": false,
        "state_type": "str",
        "haltifstate": "on",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "outputs": 2,
        "output_only_on_state_change": false,
        "x": 230,
        "y": 740,
        "wires": [
            [
                "de069662.63ca78",
                "aea9aed6.968d6"
            ],
            []
        ]
    },
    {
        "id": "de069662.63ca78",
        "type": "api-call-service",
        "z": "76250bd8.6dba94",
        "name": "Vacuum Return to Base",
        "server": "144427d5.6c9f18",
        "service_domain": "vacuum",
        "service": "return_to_base",
        "data": "{\"entity_id\":\"vacuum.rockrobo\"}",
        "mergecontext": "",
        "output_location": "payload",
        "output_location_type": "msg",
        "mustacheAltTags": false,
        "x": 650,
        "y": 740,
        "wires": [
            []
        ]
    },
    {
        "id": "aea9aed6.968d6",
        "type": "debug",
        "z": "76250bd8.6dba94",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "x": 520,
        "y": 680,
        "wires": []
    },
    {
        "id": "6dd7c692.bb1578",
        "type": "time-range-switch",
        "z": "cb6f2b8f.2124b8",
        "name": "",
        "lat": "",
        "lon": "",
        "startTime": "08:00",
        "endTime": "22:00",
        "startOffset": 0,
        "endOffset": 0,
        "x": 890,
        "y": 2020,
        "wires": [
            [
                "31e0cf2c.0037b",
                "9aaa8fe4.12ea4"
            ],
            []
        ]
    },
    {
        "id": "4e29dc95.9fd824",
        "type": "ha-wait-until",
        "z": "30c7e5fd.18228a",
        "name": "Both In Bed or 1m",
        "server": "144427d5.6c9f18",
        "outputs": 2,
        "entityId": "sensor.bed_both",
        "property": "state",
        "comparator": "is",
        "value": "Occupied",
        "valueType": "str",
        "timeout": "60",
        "timeoutUnits": "seconds",
        "entityLocation": "",
        "entityLocationType": "none",
        "checkCurrentState": true,
        "x": 430,
        "y": 580,
        "wires": [
            [
                "8fee7b97.e85098"
            ],
            [
                "8fee7b97.e85098"
            ]
        ]
    },
    {
        "id": "8e831977.0b0cd8",
        "type": "ha-wait-until",
        "z": "30c7e5fd.18228a",
        "name": "Both In Bed",
        "server": "144427d5.6c9f18",
        "outputs": 2,
        "entityId": "sensor.bed_both",
        "property": "state",
        "comparator": "is",
        "value": "Occupied",
        "valueType": "str",
        "timeout": "120",
        "timeoutUnits": "minutes",
        "entityLocation": "",
        "entityLocationType": "none",
        "checkCurrentState": true,
        "x": 590,
        "y": 740,
        "wires": [
            [
                "10377e32.1eeb62"
            ],
            []
        ]
    },
    {
        "id": "d4ff4793.7e2c58",
        "type": "api-current-state",
        "z": "30c7e5fd.18228a",
        "name": "Both Home",
        "server": "144427d5.6c9f18",
        "version": 1,
        "outputs": 2,
        "halt_if": "home",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "override_topic": false,
        "entity_id": "group.all_people",
        "state_type": "str",
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "blockInputOverrides": false,
        "x": 410,
        "y": 780,
        "wires": [
            [
                "8e831977.0b0cd8"
            ],
            [
                "10377e32.1eeb62"
            ]
        ]
    },
    {
        "id": "73b50161.3dcd3",
        "type": "server-state-changed",
        "z": "30c7e5fd.18228a",
        "name": "Guest Mode",
        "server": "144427d5.6c9f18",
        "version": 1,
        "entityidfilter": "input_boolean.guest_mode",
        "entityidfiltertype": "substring",
        "outputinitially": false,
        "state_type": "str",
        "haltifstate": "on",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "outputs": 2,
        "output_only_on_state_change": false,
        "x": 510,
        "y": 280,
        "wires": [
            [
                "8e8c59ef.f3a308"
            ],
            [
                "b6da15fc.bcfbb8"
            ]
        ]
    },
    {
        "id": "d362ddd0.35ceb",
        "type": "function",
        "z": "30c7e5fd.18228a",
        "name": "Guest While Away",
        "func": "return {\n    payload: {\n        data: {\n            title: \"Bypassing Ecobee Away\",\n            message: \"Guests have arrived.\"\n        }\n    }\n};",
        "outputs": 1,
        "noerr": 0,
        "x": 1090,
        "y": 340,
        "wires": [
            [
                "7e577921.85b078"
            ]
        ]
    },
    {
        "id": "a6c3dd55.b764e",
        "type": "function",
        "z": "30c7e5fd.18228a",
        "name": "Guest Leaves While Away",
        "func": "return {\n    payload: {\n        data: {\n            title: \"Resuming Ecobee Away\",\n            message: \"Guests have left.\"\n        }\n    }\n};",
        "outputs": 1,
        "noerr": 0,
        "x": 1070,
        "y": 280,
        "wires": [
            [
                "7e577921.85b078"
            ]
        ]
    },
    {
        "id": "9bfbc6cd.32c688",
        "type": "comment",
        "z": "30c7e5fd.18228a",
        "name": "Handle Climate for Guests While Away",
        "info": "",
        "x": 690,
        "y": 220,
        "wires": []
    },
    {
        "id": "b6da15fc.bcfbb8",
        "type": "api-current-state",
        "z": "30c7e5fd.18228a",
        "name": "Extended Away Enabled",
        "server": "144427d5.6c9f18",
        "version": "1",
        "outputs": 2,
        "halt_if": "on",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "override_topic": false,
        "entity_id": "input_boolean.extended_away_mode",
        "state_type": "str",
        "state_location": "",
        "override_payload": "none",
        "entity_location": "data",
        "override_data": "msg",
        "blockInputOverrides": false,
        "x": 750,
        "y": 260,
        "wires": [
            [
                "a6c3dd55.b764e",
                "d15821ae.44ebd"
            ],
            []
        ]
    },
    {
        "id": "8e8c59ef.f3a308",
        "type": "api-current-state",
        "z": "30c7e5fd.18228a",
        "name": "Extended Away Enabled",
        "server": "144427d5.6c9f18",
        "version": "1",
        "outputs": 2,
        "halt_if": "on",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "override_topic": false,
        "entity_id": "input_boolean.extended_away_mode",
        "state_type": "str",
        "state_location": "",
        "override_payload": "none",
        "entity_location": "data",
        "override_data": "msg",
        "blockInputOverrides": false,
        "x": 750,
        "y": 300,
        "wires": [
            [
                "d362ddd0.35ceb",
                "e70c9ec7.f71ee"
            ],
            []
        ]
    },
    {
        "id": "406e1756.ab3098",
        "type": "delay",
        "z": "eee3c0c3.7c7bd",
        "name": "",
        "pauseType": "delay",
        "timeout": "5",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "x": 700,
        "y": 1800,
        "wires": [
            [
                "f855c166.71a9c"
            ]
        ]
    },
    {
        "id": "5014d01f.3a489",
        "type": "api-current-state",
        "z": "97047d3e.e8278",
        "name": "Block if Guest Mode",
        "server": "144427d5.6c9f18",
        "version": 1,
        "outputs": 2,
        "halt_if": "on",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "override_topic": false,
        "entity_id": "input_boolean.guest_mode",
        "state_type": "str",
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "blockInputOverrides": false,
        "x": 1600,
        "y": 200,
        "wires": [
            [
                "5623456b.fc134c"
            ],
            []
        ]
    },
    {
        "id": "c956d629.113138",
        "type": "server-state-changed",
        "z": "97047d3e.e8278",
        "name": "Guest Mode",
        "server": "144427d5.6c9f18",
        "version": 1,
        "entityidfilter": "input_boolean.guest_mode",
        "entityidfiltertype": "exact",
        "outputinitially": true,
        "state_type": "str",
        "haltifstate": "on",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "outputs": 2,
        "output_only_on_state_change": true,
        "x": 230,
        "y": 420,
        "wires": [
            [
                "e8f6c812.eacb88"
            ],
            [
                "483667d2.3534a8"
            ]
        ]
    },
    {
        "id": "e8f6c812.eacb88",
        "type": "template",
        "z": "97047d3e.e8278",
        "name": "Stop",
        "field": "payload",
        "fieldType": "msg",
        "format": "handlebars",
        "syntax": "mustache",
        "template": "stop",
        "output": "str",
        "x": 450,
        "y": 420,
        "wires": [
            [
                "38d09349.53b57c",
                "dbefdafa.3f9cf8",
                "e37dd587.8c1ba8",
                "458a451b.4b1efc",
                "3d25b766.82cee8"
            ]
        ]
    },
    {
        "id": "483667d2.3534a8",
        "type": "api-current-state",
        "z": "97047d3e.e8278",
        "name": "Extended Away",
        "server": "144427d5.6c9f18",
        "version": 1,
        "outputs": 2,
        "halt_if": "on",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "override_topic": false,
        "entity_id": "input_boolean.extended_away_mode",
        "state_type": "str",
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "blockInputOverrides": false,
        "x": 240,
        "y": 480,
        "wires": [
            [
                "86f040c9.42187"
            ],
            []
        ]
    },
    {
        "id": "86f040c9.42187",
        "type": "template",
        "z": "97047d3e.e8278",
        "name": "Auto",
        "field": "payload",
        "fieldType": "msg",
        "format": "handlebars",
        "syntax": "mustache",
        "template": "auto",
        "output": "str",
        "x": 450,
        "y": 480,
        "wires": [
            [
                "38d09349.53b57c",
                "dbefdafa.3f9cf8",
                "e37dd587.8c1ba8",
                "458a451b.4b1efc",
                "3d25b766.82cee8"
            ]
        ]
    },
    {
        "id": "8ce109f3.a90188",
        "type": "weekday",
        "z": "38894af.7ca61b6",
        "name": "isSunday",
        "sun": true,
        "mon": false,
        "tue": false,
        "wed": false,
        "thu": false,
        "fri": false,
        "sat": false,
        "x": 460,
        "y": 980,
        "wires": [
            [
                "5fd1d142.d9448"
            ],
            [
                "8d8206b1.6ffa18"
            ]
        ]
    },
    {
        "id": "5fd1d142.d9448",
        "type": "api-current-state",
        "z": "38894af.7ca61b6",
        "name": "Matt - Still In Bed",
        "server": "144427d5.6c9f18",
        "version": 1,
        "outputs": 2,
        "halt_if": "Occupied",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "override_topic": false,
        "entity_id": "sensor.bed_matt",
        "state_type": "str",
        "state_location": "",
        "override_payload": "none",
        "entity_location": "",
        "override_data": "none",
        "blockInputOverrides": false,
        "x": 530,
        "y": 1040,
        "wires": [
            [
                "8d8206b1.6ffa18"
            ],
            []
        ]
    },
    {
        "id": "729d8fb5.5e302",
        "type": "api-current-state",
        "z": "30c7e5fd.18228a",
        "name": "Alydia @ Murray Residence",
        "server": "144427d5.6c9f18",
        "version": 1,
        "outputs": 2,
        "halt_if": "Murray Residence",
        "halt_if_type": "str",
        "halt_if_compare": "is_not",
        "override_topic": false,
        "entity_id": "person.alydia",
        "state_type": "str",
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "blockInputOverrides": false,
        "x": 1020,
        "y": 140,
        "wires": [
            [],
            [
                "f90b8924.13d0d8"
            ]
        ]
    },
    {
        "id": "f90b8924.13d0d8",
        "type": "api-current-state",
        "z": "30c7e5fd.18228a",
        "name": "Matt @ Murray Residence",
        "server": "144427d5.6c9f18",
        "version": 1,
        "outputs": 2,
        "halt_if": "Murray Residence",
        "halt_if_type": "str",
        "halt_if_compare": "is_not",
        "override_topic": false,
        "entity_id": "person.matt",
        "state_type": "str",
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "blockInputOverrides": false,
        "x": 1030,
        "y": 180,
        "wires": [
            [],
            [
                "ea54b02e.6a60a"
            ]
        ]
    },
    {
        "id": "4208dc0b.b9b244",
        "type": "api-current-state",
        "z": "cb6f2b8f.2124b8",
        "name": "Garage Closed",
        "server": "144427d5.6c9f18",
        "version": 1,
        "outputs": 2,
        "halt_if": "closed",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "override_topic": false,
        "entity_id": "cover.garage_1",
        "state_type": "str",
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "blockInputOverrides": true,
        "x": 900,
        "y": 1940,
        "wires": [
            [
                "6dd7c692.bb1578"
            ],
            []
        ]
    },
    {
        "id": "8f4b53e5.d1798",
        "type": "http in",
        "z": "3e9522c6.d11e1e",
        "name": "AI Motion Trigger Endpoint",
        "url": "/camera/:camera",
        "method": "get",
        "upload": false,
        "swaggerDoc": "",
        "x": 190,
        "y": 1260,
        "wires": [
            [
                "69a3dfa0.b37df",
                "332a772f.f16228",
                "2fa7a160.497c6e"
            ]
        ]
    },
    {
        "id": "9e9e036.d373b",
        "type": "comment",
        "z": "3e9522c6.d11e1e",
        "name": "AI Verified Events",
        "info": "Trigger HD camera to record events that have been verified by AI object detection.",
        "x": 140,
        "y": 1220,
        "wires": []
    },
    {
        "id": "2da5d35b.d0abfc",
        "type": "http request",
        "z": "3e9522c6.d11e1e",
        "name": "Trigger BI Camera",
        "method": "GET",
        "ret": "txt",
        "paytoqs": "ignore",
        "url": "http://10.7.9.5:81/admin?camera={{{payload}}}&trigger",
        "tls": "",
        "persist": false,
        "proxy": "",
        "authType": "basic",
        "x": 930,
        "y": 900,
        "wires": [
            [
                "ebce8ff.799477"
            ]
        ],
        "info": "Triggers specified BI camera."
    },
    {
        "id": "69a3dfa0.b37df",
        "type": "http response",
        "z": "3e9522c6.d11e1e",
        "name": "200 Response",
        "statusCode": "200",
        "headers": {},
        "x": 520,
        "y": 1300,
        "wires": []
    },
    {
        "id": "689e7a63.b7e574",
        "type": "map-map",
        "z": "3e9522c6.d11e1e",
        "name": "Map Doorbird Event to BI SD Camera ",
        "config": "b903277.dd21ad8",
        "in": "event_type",
        "inType": "msg",
        "inLhsOrRhs": "lhs",
        "out": "payload",
        "outType": "msg",
        "outLhsOrRhs": "rhs",
        "caseInsensitive": true,
        "forwardIfNoMatch": false,
        "defaultIfNoMatch": "Unknown: {{{event_type}}}",
        "x": 530,
        "y": 900,
        "wires": [
            [
                "2da5d35b.d0abfc"
            ]
        ]
    },
    {
        "id": "332a772f.f16228",
        "type": "map-map",
        "z": "3e9522c6.d11e1e",
        "name": "SD to HD Camera Mapping",
        "config": "aef2d8f0.e21398",
        "in": "req.params.camera",
        "inType": "msg",
        "inLhsOrRhs": "lhs",
        "out": "payload",
        "outType": "msg",
        "outLhsOrRhs": "rhs",
        "caseInsensitive": true,
        "forwardIfNoMatch": false,
        "defaultIfNoMatch": "Unknown: {{{req.params.camera}}}",
        "x": 660,
        "y": 1260,
        "wires": [
            [
                "2da5d35b.d0abfc"
            ]
        ]
    },
    {
        "id": "17e0e29.827bc1d",
        "type": "string",
        "z": "3e9522c6.d11e1e",
        "name": "Pluck Camera",
        "methods": [
            {
                "name": "getRightMost",
                "params": [
                    {
                        "type": "str",
                        "value": "/"
                    }
                ]
            }
        ],
        "prop": "topic",
        "propout": "payload",
        "object": "msg",
        "objectout": "msg",
        "x": 560,
        "y": 660,
        "wires": [
            [
                "ef96c5ab.917078"
            ]
        ]
    },
    {
        "id": "ef96c5ab.917078",
        "type": "map-map",
        "z": "3e9522c6.d11e1e",
        "name": "Dahua Event to BI SD Camera Mapping",
        "config": "ba88bc3e.93fb6",
        "in": "payload",
        "inType": "msg",
        "inLhsOrRhs": "lhs",
        "out": "payload",
        "outType": "msg",
        "outLhsOrRhs": "rhs",
        "caseInsensitive": true,
        "forwardIfNoMatch": false,
        "defaultIfNoMatch": "Unknown: {{{payload}}}",
        "x": 640,
        "y": 700,
        "wires": [
            [
                "2da5d35b.d0abfc",
                "ff7fba48.b66c18"
            ]
        ]
    },
    {
        "id": "32957084.5331f",
        "type": "api-current-state",
        "z": "cb6f2b8f.2124b8",
        "name": "Flag Check",
        "server": "144427d5.6c9f18",
        "version": 1,
        "outputs": 2,
        "halt_if": "true",
        "halt_if_type": "bool",
        "halt_if_compare": "is",
        "override_topic": false,
        "entity_id": "input_boolean.flag_auto_sleep_mode_on_bed_occupancy",
        "state_type": "habool",
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "blockInputOverrides": false,
        "x": 450,
        "y": 720,
        "wires": [
            [
                "49b9a993.3c8bc8"
            ],
            []
        ]
    },
    {
        "id": "974bdd3.0655d2",
        "type": "server-state-changed",
        "z": "cb6f2b8f.2124b8",
        "name": "Bed Occupancy Sleep Mode Flag",
        "server": "144427d5.6c9f18",
        "version": 1,
        "entityidfilter": "input_boolean.flag_auto_sleep_mode_on_bed_occupancy",
        "entityidfiltertype": "exact",
        "outputinitially": false,
        "state_type": "str",
        "haltifstate": "on",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "outputs": 2,
        "output_only_on_state_change": true,
        "x": 180,
        "y": 520,
        "wires": [
            [
                "82df15db.b92d38"
            ],
            []
        ]
    },
    {
        "id": "d0c99bf5.7885d8",
        "type": "comment",
        "z": "cb6f2b8f.2124b8",
        "name": "Sleep Mode Flag Change",
        "info": "If sleep mode activation via bed occupancy flag is changed, we should check bed status and auto-enable sleep mode if conditions are met.",
        "x": 150,
        "y": 480,
        "wires": []
    },
    {
        "id": "82df15db.b92d38",
        "type": "delay",
        "z": "cb6f2b8f.2124b8",
        "name": "",
        "pauseType": "delay",
        "timeout": "1",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "x": 420,
        "y": 560,
        "wires": [
            [
                "6170f9fa.a46ca8"
            ]
        ]
    },
    {
        "id": "484d95d6.b8c6cc",
        "type": "debug",
        "z": "38894af.7ca61b6",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "x": 1090,
        "y": 1000,
        "wires": []
    },
    {
        "id": "12fef867.b75418",
        "type": "time-range-switch",
        "z": "cb6f2b8f.2124b8",
        "name": "isBedtime?",
        "lat": "",
        "lon": "",
        "startTime": "22:00",
        "endTime": "7:00",
        "startOffset": 0,
        "endOffset": 0,
        "x": 430,
        "y": 800,
        "wires": [
            [
                "32957084.5331f"
            ],
            []
        ]
    },
    {
        "id": "cf6e8412.106348",
        "type": "api-current-state",
        "z": "cb6f2b8f.2124b8",
        "name": "Flag Check",
        "server": "144427d5.6c9f18",
        "version": 1,
        "outputs": 2,
        "halt_if": "true",
        "halt_if_type": "bool",
        "halt_if_compare": "is",
        "override_topic": false,
        "entity_id": "input_boolean.flag_auto_sleep_mode_on_bed_occupancy",
        "state_type": "habool",
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "blockInputOverrides": false,
        "x": 430,
        "y": 860,
        "wires": [
            [
                "f9aadbef.28b4b8"
            ],
            []
        ]
    },
    {
        "id": "f7417213.1e0df",
        "type": "link in",
        "z": "90be6c3f.6407",
        "name": "Push Notification - Matt [CRITICAL]",
        "links": [
            "5e9d1b86.e677f4",
            "9fc4d89a.e1ae38",
            "ce926406.6f9738",
            "f087f08a.0264e",
            "d920bf48.d8d85"
        ],
        "x": 255,
        "y": 300,
        "wires": [
            [
                "8645bfc9.fc36c"
            ]
        ]
    },
    {
        "id": "8645bfc9.fc36c",
        "type": "change",
        "z": "90be6c3f.6407",
        "name": "Critical Notification",
        "rules": [
            {
                "t": "set",
                "p": "payload.data.data.push.sound.name",
                "pt": "msg",
                "to": "Suspense.caf",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "payload.data.data.push.sound.critical",
                "pt": "msg",
                "to": "1",
                "tot": "num"
            },
            {
                "t": "set",
                "p": "payload.data.data.push.sound.volume",
                "pt": "msg",
                "to": "0.7",
                "tot": "num"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 410,
        "y": 300,
        "wires": [
            [
                "5a78366b.a02858"
            ]
        ]
    },
    {
        "id": "9e715568.8c04c8",
        "type": "weekday",
        "z": "38894af.7ca61b6",
        "name": "isSunday",
        "sun": true,
        "mon": false,
        "tue": false,
        "wed": false,
        "thu": false,
        "fri": false,
        "sat": false,
        "x": 780,
        "y": 1020,
        "wires": [
            [
                "1458d802.643ff8"
            ],
            []
        ]
    },
    {
        "id": "8a95cb55.f41528",
        "type": "inject",
        "z": "38894af.7ca61b6",
        "name": "",
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 720,
        "y": 1080,
        "wires": [
            [
                "9e715568.8c04c8"
            ]
        ]
    },
    {
        "id": "1458d802.643ff8",
        "type": "debug",
        "z": "38894af.7ca61b6",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "x": 880,
        "y": 1080,
        "wires": []
    },
    {
        "id": "c6b3de1.b08082",
        "type": "delay",
        "z": "b55ab74c.698a88",
        "name": "Delay 5s",
        "pauseType": "delay",
        "timeout": "5",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "x": 980,
        "y": 420,
        "wires": [
            [
                "19189187.276f5e"
            ]
        ]
    },
    {
        "id": "ebce8ff.799477",
        "type": "file",
        "z": "3e9522c6.d11e1e",
        "name": "",
        "filename": "bi-triggers.txt",
        "appendNewline": true,
        "createDir": false,
        "overwriteFile": "false",
        "encoding": "none",
        "x": 1240,
        "y": 900,
        "wires": [
            []
        ]
    },
    {
        "id": "d28375b.5b2fe88",
        "type": "change",
        "z": "90be6c3f.6407",
        "name": "Critical Notification",
        "rules": [
            {
                "t": "set",
                "p": "payload.data.data.push.sound.name",
                "pt": "msg",
                "to": "Suspense.caf",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "payload.data.data.push.sound.critical",
                "pt": "msg",
                "to": "1",
                "tot": "num"
            },
            {
                "t": "set",
                "p": "payload.data.data.push.sound.volume",
                "pt": "msg",
                "to": ".7",
                "tot": "num"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 410,
        "y": 380,
        "wires": [
            [
                "c781ecd5.f4ab4"
            ]
        ]
    },
    {
        "id": "f60c4926.bc1918",
        "type": "link in",
        "z": "90be6c3f.6407",
        "name": "Push Notification - Alydia [CRITICAL]",
        "links": [
            "5e9d1b86.e677f4",
            "9fc4d89a.e1ae38",
            "ce926406.6f9738",
            "f087f08a.0264e"
        ],
        "x": 255,
        "y": 380,
        "wires": [
            [
                "d28375b.5b2fe88"
            ]
        ]
    },
    {
        "id": "fc3569e1.6f0268",
        "type": "alexa-remote-init",
        "z": "2061740e.e5207c",
        "name": "",
        "account": "1c211dcc.d61fd2",
        "option": "initialise",
        "x": 340,
        "y": 640,
        "wires": [
            [
                "22b385be.4d637a"
            ]
        ]
    },
    {
        "id": "26c0ac3.44c7a54",
        "type": "inject",
        "z": "2061740e.e5207c",
        "name": "",
        "props": [
            {
                "p": "payload",
                "v": "",
                "vt": "date"
            },
            {
                "p": "topic",
                "v": "",
                "vt": "string"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 220,
        "y": 760,
        "wires": [
            [
                "1a557803.5049e8"
            ]
        ]
    },
    {
        "id": "8432de75.e5425",
        "type": "alexa-remote-routine",
        "z": "2061740e.e5207c",
        "name": "",
        "account": "1c211dcc.d61fd2",
        "routineNode": {
            "type": "speak",
            "payload": {
                "type": "ssml",
                "text": {
                    "type": "ssml",
                    "value": "<speak>\t<voice name=\"Ivy\">\t <amazon:emotion name=\"excited\" intensity=\"high\">\t<emphasis level=\"strong\">Lynley,</emphasis><emphasis>don't you want to be my friend? I promise I'm not <emphasis level=\"strong\">THAT</emphasis> creepy!</emphasis>\t</amazon:emotion>\t</voice>\t\t</speak>"
                },
                "devices": [
                    "G090P30874620FQM"
                ]
            }
        },
        "x": 400,
        "y": 700,
        "wires": [
            [
                "22b385be.4d637a"
            ]
        ]
    },
    {
        "id": "a55f7ed.7a1ff8",
        "type": "inject",
        "z": "2061740e.e5207c",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "43200",
        "crontab": "",
        "once": true,
        "onceDelay": "1",
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 170,
        "y": 640,
        "wires": [
            [
                "fc3569e1.6f0268"
            ]
        ]
    },
    {
        "id": "95d34970.d787f8",
        "type": "alexa-remote-routine",
        "z": "90be6c3f.6407",
        "name": "Kitchen",
        "account": "1c211dcc.d61fd2",
        "routineNode": {
            "type": "speakAtVolume",
            "payload": {
                "type": "announcement",
                "text": {
                    "type": "msg",
                    "value": "payload.data.message"
                },
                "volume": {
                    "type": "num",
                    "value": "60"
                },
                "mode": "set",
                "devices": [
                    "G2A0QU0574250M4A"
                ]
            }
        },
        "x": 420,
        "y": 660,
        "wires": [
            []
        ]
    },
    {
        "id": "29489496.5079dc",
        "type": "alexa-remote-routine",
        "z": "90be6c3f.6407",
        "name": "Playroom",
        "account": "1c211dcc.d61fd2",
        "routineNode": {
            "type": "speakAtVolume",
            "payload": {
                "type": "announcement",
                "text": {
                    "type": "msg",
                    "value": "payload.data.message"
                },
                "volume": {
                    "type": "num",
                    "value": "60"
                },
                "mode": "set",
                "devices": [
                    "G090P30874620FQM"
                ]
            }
        },
        "x": 420,
        "y": 560,
        "wires": [
            []
        ]
    },
    {
        "id": "8d6f3712.ad8788",
        "type": "alexa-remote-routine",
        "z": "90be6c3f.6407",
        "name": "Matt's Office",
        "account": "1c211dcc.d61fd2",
        "routineNode": {
            "type": "speakAtVolume",
            "payload": {
                "type": "announcement",
                "text": {
                    "type": "msg",
                    "value": "payload.data.message"
                },
                "volume": {
                    "type": "num",
                    "value": "70"
                },
                "mode": "set",
                "devices": [
                    "G090L911815211KT"
                ]
            }
        },
        "x": 410,
        "y": 500,
        "wires": [
            []
        ]
    },
    {
        "id": "f770cf38.c47f2",
        "type": "alexa-remote-routine",
        "z": "90be6c3f.6407",
        "name": "Master Bedroom",
        "account": "1c211dcc.d61fd2",
        "routineNode": {
            "type": "speakAtVolume",
            "payload": {
                "type": "announcement",
                "text": {
                    "type": "msg",
                    "value": "payload.data.message"
                },
                "volume": {
                    "type": "num",
                    "value": "60"
                },
                "mode": "set",
                "devices": [
                    "G090L91181530GXK"
                ]
            }
        },
        "x": 430,
        "y": 420,
        "wires": [
            []
        ]
    },
    {
        "id": "bc9ef461.5004b8",
        "type": "alexa-remote-routine",
        "z": "90be6c3f.6407",
        "name": "Girl's Room",
        "account": "1c211dcc.d61fd2",
        "routineNode": {
            "type": "speakAtVolume",
            "payload": {
                "type": "announcement",
                "text": {
                    "type": "msg",
                    "value": "payload.data.message"
                },
                "volume": {
                    "type": "num",
                    "value": "60"
                },
                "mode": "set",
                "devices": [
                    "G090L9118152121X"
                ]
            }
        },
        "x": 410,
        "y": 720,
        "wires": [
            []
        ]
    },
    {
        "id": "1a557803.5049e8",
        "type": "alexa-remote-other",
        "z": "2061740e.e5207c",
        "name": "",
        "account": "1c211dcc.d61fd2",
        "config": {
            "option": "checkAuthentication"
        },
        "x": 480,
        "y": 760,
        "wires": [
            [
                "22b385be.4d637a"
            ]
        ]
    },
    {
        "id": "7a39ba02.e01a34",
        "type": "function",
        "z": "90be6c3f.6407",
        "name": "Build Notification",
        "func": "return {\n    payload: {\n        data: {\n            title: \"Alexa TTS Auth Failure\",\n            message: \"TTS notifications may not work. Touch to reauthenticate.\",\n            data: {\n                url: 'http://10.7.7.100:3456'\n            }\n        }\n    }\n};",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 770,
        "y": 1340,
        "wires": [
            [
                "3e1a676b.172da8"
            ]
        ]
    },
    {
        "id": "3e1a676b.172da8",
        "type": "link out",
        "z": "90be6c3f.6407",
        "name": "Alexa Auth Notifications",
        "links": [
            "259dc6d8.29a85a",
            "58dfbc1f.ec9674"
        ],
        "x": 955,
        "y": 1380,
        "wires": []
    },
    {
        "id": "20b4d0e.239443",
        "type": "inject",
        "z": "90be6c3f.6407",
        "name": "Daily @ 9PM",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": "10",
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 190,
        "y": 1340,
        "wires": [
            [
                "d23733d1.b64a7"
            ]
        ]
    },
    {
        "id": "d23733d1.b64a7",
        "type": "alexa-remote-other",
        "z": "90be6c3f.6407",
        "name": "",
        "account": "1c211dcc.d61fd2",
        "config": {
            "option": "checkAuthentication"
        },
        "x": 400,
        "y": 1300,
        "wires": [
            [
                "72a270b3.68de4",
                "4d7309af.58d098"
            ]
        ]
    },
    {
        "id": "61bd0fd3.5b1b7",
        "type": "alexa-remote-init",
        "z": "90be6c3f.6407",
        "name": "",
        "account": "1c211dcc.d61fd2",
        "option": "initialise",
        "x": 740,
        "y": 1460,
        "wires": [
            []
        ]
    },
    {
        "id": "6a65e6b8.9c5308",
        "type": "api-call-service",
        "z": "3e9522c6.d11e1e",
        "name": "Show Camera on Requested Display",
        "server": "144427d5.6c9f18",
        "service_domain": "media_player",
        "service": "play_media",
        "data": "{\"media_content_id\":\"http://10.7.9.5:81/ui3.htm?tab=live&cam=TV&maximize=1\",\"media_content_type\":\"image/jpg\",\"media_content_id_old\":\"https://{{base_url}}/api/camera_proxy_stream/{{data.entity_id}}?token={{data.attributes.access_token}}\"}",
        "mergecontext": "",
        "output_location": "payload",
        "output_location_type": "msg",
        "mustacheAltTags": false,
        "x": 1410,
        "y": 160,
        "wires": [
            []
        ]
    },
    {
        "id": "ff7fba48.b66c18",
        "type": "file",
        "z": "3e9522c6.d11e1e",
        "name": "",
        "filename": "camera_events_routed.txt",
        "appendNewline": true,
        "createDir": false,
        "overwriteFile": "false",
        "encoding": "none",
        "x": 1010,
        "y": 620,
        "wires": [
            []
        ]
    },
    {
        "id": "777a88d3.69f618",
        "type": "file",
        "z": "3e9522c6.d11e1e",
        "name": "",
        "filename": "camera_events.txt",
        "appendNewline": true,
        "createDir": false,
        "overwriteFile": "false",
        "encoding": "none",
        "x": 310,
        "y": 720,
        "wires": [
            []
        ]
    },
    {
        "id": "78a2b17d.a78e",
        "type": "delay",
        "z": "b55ab74c.698a88",
        "name": "Delay 5s",
        "pauseType": "delay",
        "timeout": "10",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "x": 680,
        "y": 1060,
        "wires": [
            [
                "f1e6b278.ebbea",
                "a27aeee9.a36d6"
            ]
        ]
    },
    {
        "id": "51ae528b.a3cb9c",
        "type": "comment",
        "z": "b55ab74c.698a88",
        "name": "Kids Sound Machines",
        "info": "",
        "x": 160,
        "y": 1160,
        "wires": []
    },
    {
        "id": "3c66d6b3.02d35a",
        "type": "api-call-service",
        "z": "b55ab74c.698a88",
        "name": "Lynley's Lamp to Yellow (No Loop)",
        "server": "144427d5.6c9f18",
        "service_domain": "light",
        "service": "turn_on",
        "data": "{\"entity_id\":\"light.lynley_s_lamp\",\"rgb_color\":[252,227,3],\"brightness\":10,\"white_value\":0}",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 480,
        "y": 680,
        "wires": [
            []
        ]
    },
    {
        "id": "8d62db22.9db848",
        "type": "inject",
        "z": "b55ab74c.698a88",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 170,
        "y": 400,
        "wires": [
            [
                "80ebe21a.18d31"
            ]
        ]
    },
    {
        "id": "34bd72b9.7ad93e",
        "type": "server-state-changed",
        "z": "b55ab74c.698a88",
        "name": "Nap Time Enabled",
        "server": "144427d5.6c9f18",
        "version": 1,
        "entityidfilter": "input_boolean.nap_time",
        "entityidfiltertype": "exact",
        "outputinitially": false,
        "state_type": "str",
        "haltifstate": "on",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "outputs": 2,
        "output_only_on_state_change": true,
        "x": 170,
        "y": 1200,
        "wires": [
            [
                "f1e6b278.ebbea"
            ],
            [
                "f9357492.c85148"
            ]
        ]
    },
    {
        "id": "f9357492.c85148",
        "type": "api-call-service",
        "z": "b55ab74c.698a88",
        "name": "Sound Machine Off",
        "server": "144427d5.6c9f18",
        "service_domain": "media_player",
        "service": "media_pause",
        "data": "{\"entity_id\":\"media_player.avas_room_sonos,media_player.lynleys_room_sonos,media_player.hudsons_room_sonos\"}",
        "mergecontext": "",
        "output_location": "payload",
        "output_location_type": "msg",
        "mustacheAltTags": false,
        "x": 890,
        "y": 1220,
        "wires": [
            []
        ]
    },
    {
        "id": "f1e6b278.ebbea",
        "type": "api-call-service",
        "z": "b55ab74c.698a88",
        "name": "Sound Machine On",
        "server": "144427d5.6c9f18",
        "service_domain": "media_player",
        "service": "media_play",
        "data": "{\"entity_id\":\"media_player.avas_room_sonos,media_player.lynleys_room_sonos,media_player.hudsons_room_sonos\"}",
        "mergecontext": "",
        "output_location": "payload",
        "output_location_type": "msg",
        "mustacheAltTags": false,
        "x": 890,
        "y": 1180,
        "wires": [
            []
        ]
    },
    {
        "id": "903eab1e.225358",
        "type": "inject",
        "z": "b55ab74c.698a88",
        "name": "Immediate Bedtime",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "STOP",
        "payloadType": "str",
        "x": 450,
        "y": 1120,
        "wires": [
            [
                "a20fcb6f.79b368",
                "78a2b17d.a78e"
            ]
        ]
    },
    {
        "id": "1ae9577f.444509",
        "type": "api-call-service",
        "z": "b55ab74c.698a88",
        "name": "Sound Machine Off",
        "server": "144427d5.6c9f18",
        "service_domain": "media_player",
        "service": "media_pause",
        "data": "{\"entity_id\":\"media_player.avas_room_sonos,media_player.lynleys_room_sonos\"}",
        "mergecontext": "",
        "output_location": "payload",
        "output_location_type": "msg",
        "mustacheAltTags": false,
        "x": 430,
        "y": 800,
        "wires": [
            []
        ]
    },
    {
        "id": "2ccdcb20.d85f24",
        "type": "delay",
        "z": "b55ab74c.698a88",
        "name": "Delay 30m",
        "pauseType": "delay",
        "timeout": "30",
        "timeoutUnits": "minutes",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "x": 190,
        "y": 800,
        "wires": [
            [
                "1ae9577f.444509"
            ]
        ]
    },
    {
        "id": "b067b099.31c58",
        "type": "inject",
        "z": "b55ab74c.698a88",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 220,
        "y": 720,
        "wires": [
            [
                "3c66d6b3.02d35a"
            ]
        ]
    },
    {
        "id": "b6957352.54ced",
        "type": "debug",
        "z": "38894af.7ca61b6",
        "name": "Doorbird Notification Object",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1000,
        "y": 1620,
        "wires": []
    },
    {
        "id": "f8475276.52ff7",
        "type": "gate",
        "z": "3e9522c6.d11e1e",
        "name": "Front Door Gate",
        "controlTopic": "control",
        "defaultState": "closed",
        "openCmd": "open",
        "closeCmd": "close",
        "toggleCmd": "toggle",
        "defaultCmd": "default",
        "statusCmd": "status",
        "persist": false,
        "x": 620,
        "y": 1020,
        "wires": [
            []
        ]
    },
    {
        "id": "80893929.f4ba88",
        "type": "switch",
        "z": "3e9522c6.d11e1e",
        "name": "Router",
        "property": "req.params.camera",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "front-door",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "side-door",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "back-door",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "front-180",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "side-180",
                "vt": "str"
            }
        ],
        "checkall": "false",
        "repair": false,
        "outputs": 5,
        "x": 410,
        "y": 1100,
        "wires": [
            [
                "f8475276.52ff7"
            ],
            [
                "942a0046.6bbe4"
            ],
            [
                "e7b08741.8274a8"
            ],
            [
                "9fe1ce41.3102c"
            ],
            [
                "fa001999.0fe698"
            ]
        ]
    },
    {
        "id": "2479ec7a.c7a794",
        "type": "comment",
        "z": "3e9522c6.d11e1e",
        "name": "Event Trigger Keepalive",
        "info": "Trigger HD camera to record events that have been verified by AI object detection.",
        "x": 160,
        "y": 1040,
        "wires": []
    },
    {
        "id": "942a0046.6bbe4",
        "type": "gate",
        "z": "3e9522c6.d11e1e",
        "name": "Side Door Gate",
        "controlTopic": "control",
        "defaultState": "closed",
        "openCmd": "open",
        "closeCmd": "close",
        "toggleCmd": "toggle",
        "defaultCmd": "default",
        "statusCmd": "status",
        "persist": false,
        "x": 620,
        "y": 1060,
        "wires": [
            []
        ]
    },
    {
        "id": "e7b08741.8274a8",
        "type": "gate",
        "z": "3e9522c6.d11e1e",
        "name": "Back Door Gate",
        "controlTopic": "control",
        "defaultState": "closed",
        "openCmd": "open",
        "closeCmd": "close",
        "toggleCmd": "toggle",
        "defaultCmd": "default",
        "statusCmd": "status",
        "persist": false,
        "x": 620,
        "y": 1100,
        "wires": [
            []
        ]
    },
    {
        "id": "2fa7a160.497c6e",
        "type": "change",
        "z": "3e9522c6.d11e1e",
        "name": "Set Gate Open Message",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "control",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "open",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 210,
        "y": 1100,
        "wires": [
            [
                "80893929.f4ba88"
            ]
        ]
    },
    {
        "id": "9fe1ce41.3102c",
        "type": "gate",
        "z": "3e9522c6.d11e1e",
        "name": "Front 180 Gate",
        "controlTopic": "control",
        "defaultState": "closed",
        "openCmd": "open",
        "closeCmd": "close",
        "toggleCmd": "toggle",
        "defaultCmd": "default",
        "statusCmd": "status",
        "persist": false,
        "x": 620,
        "y": 1140,
        "wires": [
            []
        ]
    },
    {
        "id": "fa001999.0fe698",
        "type": "gate",
        "z": "3e9522c6.d11e1e",
        "name": "Side 180 Gate",
        "controlTopic": "control",
        "defaultState": "closed",
        "openCmd": "open",
        "closeCmd": "close",
        "toggleCmd": "toggle",
        "defaultCmd": "default",
        "statusCmd": "status",
        "persist": false,
        "x": 620,
        "y": 1180,
        "wires": [
            []
        ]
    },
    {
        "id": "feaec061.53fff",
        "type": "http in",
        "z": "2061740e.e5207c",
        "name": "",
        "url": "/test",
        "method": "get",
        "upload": false,
        "swaggerDoc": "",
        "x": 260,
        "y": 1220,
        "wires": [
            [
                "f0962e29.58f0d"
            ]
        ]
    },
    {
        "id": "7fc49da8.207c14",
        "type": "http response",
        "z": "2061740e.e5207c",
        "name": "",
        "statusCode": "200",
        "headers": {},
        "x": 580,
        "y": 1220,
        "wires": []
    },
    {
        "id": "f0962e29.58f0d",
        "type": "change",
        "z": "2061740e.e5207c",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "TESTING 4",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 430,
        "y": 1280,
        "wires": [
            [
                "7fc49da8.207c14"
            ]
        ]
    },
    {
        "id": "4303c0c1.7fcd7",
        "type": "http in",
        "z": "2061740e.e5207c",
        "name": "",
        "url": "/test",
        "method": "post",
        "upload": false,
        "swaggerDoc": "",
        "x": 250,
        "y": 1160,
        "wires": [
            [
                "7fc49da8.207c14",
                "567eb238.7bcaec",
                "d07fe723.bf98f8"
            ]
        ]
    },
    {
        "id": "567eb238.7bcaec",
        "type": "debug",
        "z": "2061740e.e5207c",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 560,
        "y": 1140,
        "wires": []
    },
    {
        "id": "b6a8ab3c.6342e8",
        "type": "link out",
        "z": "2061740e.e5207c",
        "name": "Door Left Open",
        "links": [
            "259dc6d8.29a85a"
        ],
        "x": 785,
        "y": 1100,
        "wires": []
    },
    {
        "id": "d07fe723.bf98f8",
        "type": "function",
        "z": "2061740e.e5207c",
        "name": "Build Notification",
        "func": "return {\n    payload: {\n        data: {\n            title: \"Website Changed!\",\n            message: 'CHECK IT NOW!',\n            data: {\n                push: {\n                    \"thread-id\": 'website-notification' \n                }\n            }\n        }\n    }\n};",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 600,
        "y": 1100,
        "wires": [
            [
                "b6a8ab3c.6342e8"
            ]
        ]
    },
    {
        "id": "8b9b58ff.2286f8",
        "type": "comment",
        "z": "2061740e.e5207c",
        "name": "HD Site Check",
        "info": "",
        "x": 260,
        "y": 1060,
        "wires": []
    },
    {
        "id": "ddc39481.47e4c8",
        "type": "dahua-device",
        "z": "3e9522c6.d11e1e",
        "name": "Backyard PTZ",
        "device": "80abbe6f.032be",
        "x": 150,
        "y": 1480,
        "wires": [
            [
                "2f4f5df9.d493b2"
            ]
        ]
    },
    {
        "id": "490c4db9.f33e64",
        "type": "comment",
        "z": "90be6c3f.6407",
        "name": "Verify Alexa TTS Is Working",
        "info": "",
        "x": 220,
        "y": 1220,
        "wires": []
    },
    {
        "id": "2f4f5df9.d493b2",
        "type": "debug",
        "z": "3e9522c6.d11e1e",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 470,
        "y": 1480,
        "wires": []
    },
    {
        "id": "3086833d.fa780c",
        "type": "dahua-device",
        "z": "3e9522c6.d11e1e",
        "name": "Front180",
        "device": "3083a167.a9471e",
        "x": 160,
        "y": 1400,
        "wires": [
            [
                "2f4f5df9.d493b2"
            ]
        ]
    },
    {
        "id": "529d247f.2d30cc",
        "type": "dahua-device",
        "z": "3e9522c6.d11e1e",
        "name": "Side180",
        "device": "47a7cbf3.98d564",
        "x": 160,
        "y": 1440,
        "wires": [
            [
                "2f4f5df9.d493b2"
            ]
        ]
    },
    {
        "id": "b572f496.1b1078",
        "type": "server-state-changed",
        "z": "3e9522c6.d11e1e",
        "name": "North Gate Opened",
        "server": "144427d5.6c9f18",
        "version": 1,
        "entityidfilter": "binary_sensor.north_gate_state",
        "entityidfiltertype": "exact",
        "outputinitially": false,
        "state_type": "str",
        "haltifstate": "on",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "outputs": 2,
        "output_only_on_state_change": true,
        "x": 190,
        "y": 1640,
        "wires": [
            [
                "a0b0de22.2fef7"
            ],
            []
        ]
    },
    {
        "id": "48ee6c18.f37f64",
        "type": "comment",
        "z": "3e9522c6.d11e1e",
        "name": "Gate Surveilance",
        "info": "",
        "x": 140,
        "y": 1580,
        "wires": []
    },
    {
        "id": "a0b0de22.2fef7",
        "type": "http request",
        "z": "3e9522c6.d11e1e",
        "name": "PTZ to North Gate",
        "method": "GET",
        "ret": "txt",
        "paytoqs": "ignore",
        "url": "http://10.7.9.5:81/admin?camera=backyardptz&preset=4&user=ptzuser&pw=ptzuser",
        "tls": "",
        "persist": false,
        "proxy": "",
        "authType": "",
        "x": 530,
        "y": 1640,
        "wires": [
            []
        ]
    },
    {
        "id": "9269b7b0.c56e18",
        "type": "server-state-changed",
        "z": "3e9522c6.d11e1e",
        "name": "South Gate Opened",
        "server": "144427d5.6c9f18",
        "version": 1,
        "entityidfilter": "binary_sensor.south_gate_state",
        "entityidfiltertype": "exact",
        "outputinitially": false,
        "state_type": "str",
        "haltifstate": "on",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "outputs": 2,
        "output_only_on_state_change": true,
        "x": 190,
        "y": 1700,
        "wires": [
            [
                "ea51c173.fe58a"
            ],
            []
        ]
    },
    {
        "id": "ea51c173.fe58a",
        "type": "http request",
        "z": "3e9522c6.d11e1e",
        "name": "PTZ to South Gate",
        "method": "GET",
        "ret": "txt",
        "paytoqs": "ignore",
        "url": "http://10.7.9.5:81/admin?camera=backyardptz&preset=5&user=ptzuser&pw=ptzuser",
        "tls": "",
        "persist": false,
        "proxy": "",
        "authType": "",
        "x": 530,
        "y": 1700,
        "wires": [
            []
        ]
    },
    {
        "id": "6a138b0f.761604",
        "type": "server-state-changed",
        "z": "3e9522c6.d11e1e",
        "name": "Back Door Opened",
        "server": "144427d5.6c9f18",
        "version": 1,
        "entityidfilter": "binary_sensor.back_door_state",
        "entityidfiltertype": "exact",
        "outputinitially": false,
        "state_type": "str",
        "haltifstate": "on",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "outputs": 2,
        "output_only_on_state_change": true,
        "x": 190,
        "y": 1760,
        "wires": [
            [
                "22b342.bb44ccbe"
            ],
            []
        ]
    },
    {
        "id": "22b342.bb44ccbe",
        "type": "http request",
        "z": "3e9522c6.d11e1e",
        "name": "PTZ to Back Door",
        "method": "GET",
        "ret": "txt",
        "paytoqs": "ignore",
        "url": "http://10.7.9.5:81/admin?camera=backyardptz&preset=7&user=ptzuser&pw=ptzuser",
        "tls": "",
        "persist": false,
        "proxy": "",
        "authType": "",
        "x": 530,
        "y": 1760,
        "wires": [
            []
        ]
    },
    {
        "id": "d920bf48.d8d85",
        "type": "link out",
        "z": "b55ab74c.698a88",
        "name": "Sneaky Kid Warning",
        "links": [
            "3ba4aeb7.ee1e12",
            "d7669edc.b8c1",
            "d88ae7ad.72c5b8",
            "f7417213.1e0df"
        ],
        "x": 1035,
        "y": 1660,
        "wires": []
    },
    {
        "id": "3c682059.e48f5",
        "type": "function",
        "z": "b55ab74c.698a88",
        "name": "Sneaky Child Messages",
        "func": "var bedtimeMessages = [\n    'The playroom TV has been turned on.  Somebody thinks they are sneaky.'\n]\n\nreturn {\n    payload: {\n        data: {\n            message: bedtimeMessages[Math.floor(Math.random()*bedtimeMessages.length)],\n            data: {\n                \"thread-id\": 'sneaky-child'\n            }\n        }\n    }\n}",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 810,
        "y": 1660,
        "wires": [
            [
                "d920bf48.d8d85"
            ]
        ]
    },
    {
        "id": "c95992d1.63065",
        "type": "server-state-changed",
        "z": "b55ab74c.698a88",
        "name": "Playroom TV",
        "server": "144427d5.6c9f18",
        "version": 1,
        "entityidfilter": "media_player.playroom_tv",
        "entityidfiltertype": "exact",
        "outputinitially": true,
        "state_type": "str",
        "haltifstate": "on",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "outputs": 2,
        "output_only_on_state_change": true,
        "x": 110,
        "y": 1660,
        "wires": [
            [
                "2813218f.7af15e"
            ],
            []
        ]
    },
    {
        "id": "2813218f.7af15e",
        "type": "api-current-state",
        "z": "b55ab74c.698a88",
        "name": "Kids Sleep Mode Enabled",
        "server": "144427d5.6c9f18",
        "version": 1,
        "outputs": 2,
        "halt_if": "on",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "override_topic": false,
        "entity_id": "input_boolean.kids_sleep_mode",
        "state_type": "str",
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "blockInputOverrides": false,
        "x": 350,
        "y": 1660,
        "wires": [
            [
                "533cdd1e.4105f4"
            ],
            []
        ]
    },
    {
        "id": "533cdd1e.4105f4",
        "type": "time-range-switch",
        "z": "b55ab74c.698a88",
        "name": "Time Filter",
        "lat": "35.6145N",
        "lon": "88.8139W",
        "startTime": "5:30",
        "endTime": "20:00",
        "startOffset": 0,
        "endOffset": 0,
        "x": 570,
        "y": 1660,
        "wires": [
            [],
            [
                "3c682059.e48f5"
            ]
        ]
    },
    {
        "id": "4c4c3a55.072d64",
        "type": "comment",
        "z": "b55ab74c.698a88",
        "name": "Sneaky Kid TV Warning",
        "info": "",
        "x": 140,
        "y": 1600,
        "wires": []
    },
    {
        "id": "4d7309af.58d098",
        "type": "debug",
        "z": "90be6c3f.6407",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 530,
        "y": 1460,
        "wires": []
    },
    {
        "id": "72a270b3.68de4",
        "type": "function",
        "z": "90be6c3f.6407",
        "name": "",
        "func": "newMsg = {\n    payload: msg,\n    test: 123\n}\n\nreturn newMsg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 340,
        "y": 1420,
        "wires": [
            [
                "bc61e3f0.c7d72",
                "4d7309af.58d098"
            ]
        ]
    },
    {
        "id": "bc61e3f0.c7d72",
        "type": "switch",
        "z": "90be6c3f.6407",
        "name": "AuthFailed?",
        "property": "payload",
        "propertyType": "msg",
        "rules": [
            {
                "t": "cont",
                "v": "not initialised",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 550,
        "y": 1400,
        "wires": [
            [
                "7a39ba02.e01a34",
                "61bd0fd3.5b1b7",
                "4d7309af.58d098"
            ]
        ]
    },
    {
        "id": "c5f55684.5b1fd8",
        "type": "debug",
        "z": "eee3c0c3.7c7bd",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 690,
        "y": 460,
        "wires": []
    },
    {
        "id": "a7dd324a.6bbbc",
        "type": "debug",
        "z": "38894af.7ca61b6",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 550,
        "y": 700,
        "wires": []
    },
    {
        "id": "2c12f67c.414c5a",
        "type": "api-current-state",
        "z": "38894af.7ca61b6",
        "name": "Away Mode Enabled",
        "server": "144427d5.6c9f18",
        "version": 1,
        "outputs": 2,
        "halt_if": "on",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "override_topic": false,
        "entity_id": "input_boolean.away_mode",
        "state_type": "str",
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "blockInputOverrides": false,
        "x": 360,
        "y": 360,
        "wires": [
            [
                "e18b65fc.e57fd8"
            ],
            []
        ]
    },
    {
        "id": "a27aeee9.a36d6",
        "type": "api-call-service",
        "z": "b55ab74c.698a88",
        "name": "Stair Light Off",
        "server": "144427d5.6c9f18",
        "service_domain": "light",
        "service": "turn_off",
        "data": "{\"entity_id\":\"switch.stair_light\"}",
        "mergecontext": "",
        "output_location": "payload",
        "output_location_type": "msg",
        "mustacheAltTags": false,
        "x": 880,
        "y": 1140,
        "wires": [
            []
        ]
    },
    {
        "id": "25b30fb4.e5f2b",
        "type": "stoptimer",
        "z": "30c7e5fd.18228a",
        "duration": "2",
        "units": "Hour",
        "payloadtype": "num",
        "payloadval": "0",
        "name": "Delay 2h",
        "x": 660,
        "y": 140,
        "wires": [
            [
                "d15821ae.44ebd",
                "729d8fb5.5e302"
            ],
            []
        ]
    },
    {
        "id": "e19c2df5.632db",
        "type": "server-state-changed",
        "z": "820ee3ba.213ee",
        "name": "Playroom Source Selector",
        "server": "144427d5.6c9f18",
        "version": 1,
        "entityidfilter": "input_select.playroom_hdmi_source",
        "entityidfiltertype": "exact",
        "outputinitially": false,
        "state_type": "str",
        "haltifstate": "",
        "halt_if_type": "str",
        "halt_if_compare": "is_not",
        "outputs": 1,
        "output_only_on_state_change": true,
        "x": 170,
        "y": 120,
        "wires": [
            [
                "208034f6.8cd32c"
            ]
        ]
    },
    {
        "id": "dcfc2cf1.371e1",
        "type": "debug",
        "z": "820ee3ba.213ee",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 990,
        "y": 140,
        "wires": []
    },
    {
        "id": "208034f6.8cd32c",
        "type": "switch",
        "z": "820ee3ba.213ee",
        "name": "Source",
        "property": "payload",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "Surveillance",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "Tivo",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 400,
        "y": 120,
        "wires": [
            [
                "85a972b.a75549"
            ],
            [
                "2e5e621.8aaab9e"
            ]
        ]
    },
    {
        "id": "3c569553.5427ca",
        "type": "http request",
        "z": "820ee3ba.213ee",
        "name": "",
        "method": "POST",
        "ret": "txt",
        "paytoqs": "body",
        "url": "http://10.7.8.86/video.set",
        "tls": "",
        "persist": false,
        "proxy": "",
        "authType": "",
        "x": 830,
        "y": 140,
        "wires": [
            [
                "dcfc2cf1.371e1"
            ]
        ]
    },
    {
        "id": "85a972b.a75549",
        "type": "change",
        "z": "820ee3ba.213ee",
        "name": "Playroom TV | HDMI 1",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "#video_d out1 matrix=1#",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 620,
        "y": 120,
        "wires": [
            [
                "3c569553.5427ca"
            ]
        ]
    },
    {
        "id": "2e5e621.8aaab9e",
        "type": "change",
        "z": "820ee3ba.213ee",
        "name": "Playroom TV | HDMI 2",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "#video_d out1 matrix=2#",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 620,
        "y": 160,
        "wires": [
            [
                "3c569553.5427ca"
            ]
        ]
    },
    {
        "id": "6145f721.0e5288",
        "type": "change",
        "z": "820ee3ba.213ee",
        "name": "Save Current State",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "#group8 exe=1#",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 610,
        "y": 300,
        "wires": [
            [
                "3c569553.5427ca"
            ]
        ]
    },
    {
        "id": "5d9614bb.ec486c",
        "type": "change",
        "z": "820ee3ba.213ee",
        "name": "Recall Saved State",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "#group8 exe=2#",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 610,
        "y": 380,
        "wires": [
            [
                "3c569553.5427ca"
            ]
        ]
    },
    {
        "id": "2a65adb8.104992",
        "type": "inject",
        "z": "820ee3ba.213ee",
        "name": "Every 5s",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "5",
        "crontab": "",
        "once": true,
        "onceDelay": "1",
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 150,
        "y": 660,
        "wires": [
            [
                "dc50e4e1.ee1508"
            ]
        ]
    },
    {
        "id": "dc50e4e1.ee1508",
        "type": "http request",
        "z": "820ee3ba.213ee",
        "name": "",
        "method": "GET",
        "ret": "txt",
        "paytoqs": "body",
        "url": "http://10.7.8.86/all_dat.get1631845863506",
        "tls": "",
        "persist": false,
        "proxy": "",
        "authType": "",
        "x": 390,
        "y": 660,
        "wires": [
            [
                "c0359218.fcd45"
            ]
        ]
    },
    {
        "id": "c0359218.fcd45",
        "type": "function",
        "z": "820ee3ba.213ee",
        "name": "",
        "func": "var o = msg.payload\n\nvar sw_info = o.split(\";\").slice(0,48); \t\t//存放8组运行消息\nvar edid_info = o.split(\";\").slice(48,88);  \t\t//存放5组x8 EDID具体信息 共计40个EDID信息\nvar port_name = o.split(\";\").slice(88,112);     //存放3组x8 端口名字\t    共计24个\nvar source_name = o.split(\";\").slice(112,120);\t//存放1组x8 场景的名字    共计8个\nvar login_info = o.split(\";\").slice(120,136);   //存放8组x2 用户名和密码  共计16,但只有前5组共计10个有效\n\nvar input_info = o.split(\";\").slice(136,144);   //存放input端输入端口的信息      用于判断设备拔插\nvar hdmi_info = o.split(\";\").slice(144,152);\t//存放输出HDMI 端输入端口的信息  用于判断设备拔插\nvar hdbt_info = o.split(\";\").slice(152,160);\n\nvar port_names={\n    \n    audio: [\n        port_name[0].split(\":\")[1],\n        port_name[1].split(\":\")[1],\n        port_name[2].split(\":\")[1],\n        port_name[3].split(\":\")[1],\n        port_name[4].split(\":\")[1],\n        port_name[5].split(\":\")[1],\n        port_name[6].split(\":\")[1],\n        port_name[7].split(\":\")[1]\n    ],\n    input: [\n        port_name[8].split(\":\")[1],\n        port_name[9].split(\":\")[1],\n        port_name[10].split(\":\")[1],\n        port_name[11].split(\":\")[1],\n        port_name[12].split(\":\")[1],\n        port_name[13].split(\":\")[1],\n        port_name[14].split(\":\")[1],\n        port_name[15].split(\":\")[1],\n    ],\n    output: [\n        port_name[16].split(\":\")[1],\n        port_name[17].split(\":\")[1],\n        port_name[18].split(\":\")[1],\n        port_name[19].split(\":\")[1],\n        port_name[20].split(\":\")[1],\n        port_name[21].split(\":\")[1],\n        port_name[22].split(\":\")[1],\n        port_name[23].split(\":\")[1]\n    ]\n};\n\nreturn [{sw_info, edid_info, port_names, source_name, input_info, hdmi_info, hdbt_info}];",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 600,
        "y": 660,
        "wires": [
            [
                "dcfc2cf1.371e1"
            ]
        ]
    },
    {
        "id": "83ce9bde.00ca48",
        "type": "map-map",
        "z": "820ee3ba.213ee",
        "name": "HDMI Input Map",
        "config": "ef753f0c.2417a",
        "in": "payload",
        "inType": "msg",
        "inLhsOrRhs": "lhs",
        "out": "payload",
        "outType": "msg",
        "outLhsOrRhs": "rhs",
        "caseInsensitive": true,
        "forwardIfNoMatch": true,
        "defaultIfNoMatch": "Unknown: {{{payload}}}",
        "x": 510,
        "y": 540,
        "wires": [
            []
        ]
    },
    {
        "id": "2c84871d.3f1998",
        "type": "map-map",
        "z": "820ee3ba.213ee",
        "name": "HDMI Output Map",
        "config": "c590c3b8.f74cd",
        "in": "payload",
        "inType": "msg",
        "inLhsOrRhs": "lhs",
        "out": "payload",
        "outType": "msg",
        "outLhsOrRhs": "rhs",
        "caseInsensitive": true,
        "forwardIfNoMatch": true,
        "defaultIfNoMatch": "Unknown: {{{payload}}}",
        "x": 510,
        "y": 500,
        "wires": [
            []
        ]
    },
    {
        "id": "8190df0f.def86",
        "type": "map-switch",
        "z": "820ee3ba.213ee",
        "name": "HDBT Output Router",
        "config": "c590c3b8.f74cd",
        "outLhsOrRhs": "rhs",
        "in": "payload",
        "inType": "msg",
        "inLhsOrRhs": "lhs",
        "caseInsensitive": false,
        "switchValues": [],
        "outputs": 0,
        "x": 920,
        "y": 600,
        "wires": []
    },
    {
        "id": "b877a1ce.9ef79",
        "type": "map-switch",
        "z": "820ee3ba.213ee",
        "name": "",
        "config": "c590c3b8.f74cd",
        "outLhsOrRhs": "rhs",
        "in": "payload",
        "inType": "msg",
        "inLhsOrRhs": "lhs",
        "caseInsensitive": true,
        "switchValues": [],
        "outputs": 0,
        "x": 920,
        "y": 500,
        "wires": []
    }
]